{"version":3,"sources":["color_picker.js","text_splitter.js","infrastructure/functions.js","infrastructure/widgets.js","Markdown.js","Common.js","Message.js","Config.js","cache.js","flows_api.js","Attention.js","UserAction.js","Flows.js","Title.js","Sidebar.js","PressureHelper.js","App.js","registerServiceWorker.js","index.js"],"names":["ColorPicker","this","names","current_h","Math","random","name","is_tmp","toLowerCase","PID_RE","URL_PID_RE","NICKNAME_RE","URL_RE","TAG_RE","split_text","txt","rules","forEach","rule","regex","concat","apply","map","part","content","split","seg","test","filter","get_json","res","ok","text","then","t","JSON","parse","e","console","error","trace","log","SyntaxError","substr","length","Error","status","statusText","NAMES","pad2","x","format_time","time","getMonth","getDate","getHours","getMinutes","getSeconds","chinese_format","buildFormatter","chineseStrings","Time","props","Date","stamp","className","date","formatter","title","toLocaleString","timeZone","hour12","short","TitleLine","LoginPopupSelf","state","loading_status","input_token_ref","React","createRef","tar","ref","preventDefault","href","current","value","alert","target","referrerPolicy","placeholder","onClick","setThuhole","type","disabled","on_close","Component","LoginPopup","popup_show","on_popup_bound","on_popup","bind","on_close_bound","setState","children","token_callback","md","MarkdownIt","html","linkify","breaks","inline","highlight","str","lang","hljs","getLanguage","__","utils","escapeHtml","use","MarkdownItKaTeX","throwOnError","errorColor","API_BASE","process","API_BASE_2","STORAGE_BASE","ColoredSpan","style","colors","normalize_url","url","stop_loading","parentNode","classList","remove","HighlightedMarkdown","processInstructions","shouldProcessNode","node","processNode","index","currentLevel","HeadingTag","key","src","attribs","alt","startsWith","onError","onLoad","rel","parent","originalText","data","search_param","search_kws","s","push","RegExp","replace","join","splitted","Fragment","idx","p","show_pid","URL","pathname","endsWith","searchParams","get","is_video","controls","is_audio","substring","color_picker","HtmlToReact","ProcessNodeDefinitions","processDefaultNode","parser","Parser","rawMd","renderedMarkdown","render","parseWithInstructions","window","TEXTAREA_BACKUP","SafeTextarea","on_change_bound","on_change","on_keydown_bound","on_keydown","clear","area_ref","change_callback","submit_callback","on_submit","id","event","ctrlKey","altKey","focus","onChange","onKeyDown","maxLength","pwa_prompt_event","PromotionBar","is_ios","navigator","userAgent","matchMedia","matches","standalone","prompt","addEventListener","ClickHandler","moved","init_y","init_x","on_begin_bound","on_begin","on_move_bound","on_move","on_end_bound","on_end","MOVE_THRESHOLD","last_fire","touches","screenY","screenX","abs","do_callback","callback","onTouchStart","onMouseDown","onTouchMove","onMouseMove","PureComponent","MessageViewer","msg","input_suf_ref","load","fetch","headers","token","json","start_time","salt","tmp_token","catch","err","tt","localStorage","location","reload","do_set_token","timestamp","user","detail","BUILTIN_IMGS","DEFAULT_CONFIG","background_img","background_color","pressure","easter_egg","color_scheme","block_tmp","block_cw","block_words_v4","whitelist_cw","load_config","loaded_config","config","Object","assign","keys","undefined","save_config","need_load","stringify","bgimg_style","img","color","background","backgroundImage","encodeURI","backgroundColor","backgroundSize","ConfigBackground","save_changes","img_select","indexOf","on_select","on_change_img","on_change_color","ConfigColorScheme","ConfigTextArea","sift","description","display","ConfigSwitch","switch","val","checked","ConfigUI","save_changes_bound","chg","confirm","reset_settings","array","v","string","Cache","db","added_items_since_maintenance","encrypt","decrypt","open_req","indexedDB","open","onerror","onupgradeneeded","result","createObjectStore","keyPath","createIndex","unique","onsuccess","setTimeout","maintenance","pid","o","i","new_key","charCodeAt","String","fromCharCode","c","target_version","parseInt","Promise","resolve","reject","store","transaction","objectStore","get_req","data_str","version","last_access","put","delete","warn","req","count_req","count","openKeyCursor","cur","primaryKey","continue","deleteDatabase","cache","hole_cache","handle_response","response","a","notify","code","parse_replies","replies","sort","b","cid","info","name_id","r","gen_name","_display_color","variant","API","load_replies","cache_version","load_replies_with_cache","cached","set_attention","attention","URLSearchParams","append","method","body","report","reason","should_hide","block","del","note","update_cw","cw","get_list","page","submode","get_search","keyword","encodeURIComponent","get_single","get_attention","add_vote","vote","get_multi","pids","set_title","save_attentions","saved_attentions","REPOSITORY","EMAIL","TokenCtx","createContext","set_value","InfoSidebar","show_sidebar","serviceWorker","getRegistrations","registrations","registration","unregister","LoginForm","custom_title","TITLE","auto_block_rank","AUTO_BLCOK","FormData","j","rank","copy","Consumer","copy_token","update_title","width","min","max","list","update_auto_block","do_popup","ReplyForm","preview","use_title","on_use_title_change_bound","on_use_title_change","global_keypress_handler_bound","global_keypress_handler","tagName","document","removeEventListener","includes","unshift","on_complete","onSubmit","toggle_preview","PostForm","upload_progress_text","is_loading","file_name","file_type","CW_BACKUP","allow_search","AS_BACKUP","has_poll","POLL_BACKUP","poll_options","on_allow_search_change_bound","on_allow_search_change","on_cw_change_bound","on_cw_change","on_poll_option_change_bound","on_poll_option_change","opt","do_post","splice","f","files","xh","XMLHttpRequest","upload","upload_progress","upload_complete","upload_error","upload_abort","setRequestHeader","send","path","new_text","set","loaded","total","toFixed","responseText","update_text_after_upload","on_file_change","option","CLICKABLE_TAGS","audio","QUOTE_BLACKLIST","LATEST_POST_ID","check_block","some","word","can_del","load_single_meta","title_elem","single","reply","deletion_detect","Reply","do_filter_name","do_delete","do_report","do_block","author","replyText","has_block_words","author_title","dangerous_user","blocked_count","FlowItem","likenum","is_quote","do_edit_cw","img_clickable","do_vote","copy_link","is_reported","hot_score","poll","question","answers","onVote","customStyles","theme","noStorage","latest_reply","FlowSidebar","error_msg","filter_name","rev","syncState","sync_state","reply_ref","prev","update_count","set_variant","prev_info","curr","prevState","forceCheck","closest","should_text","replies_to_show","slice","reverse","replies_cnt","main_thread_elem","show_reply_bar","set_filter_name","make_do_delete","toggle_rev","toggle_attention","float","is_blocked","offset","height","overflow","once","FlowItemRow","needFold","mode","comments","reply_status","reply_error","hl_rules","parts","quote_id","FlowItemQuote","FlowChunk","ind","hiddenIfInvisible","Flow","toUpperCase","by_c","submode_names","get_submode_names","set_submode","search_text","SubFlow","loaded_pages","chunks","local_attention_text","on_scroll_bound","on_scroll","failed","max_id","comment_json","finished","use_search","use_regex","match","regex_search","toString","post","every","Array","from","Set","scrollHeight","scrollY","innerHeight","load_page","max_len","can_export","should_deletion_detect","gen_export","LocalAttentionEditer","init_text","useState","setText","matchAll","m","flag_re","ControlBar","set_mode","on_keypress_bound","on_keypress","do_refresh_bound","do_refresh","do_attention_bound","do_attention","hash","decodeURIComponent","lastIndexOf","flag_res","exec","scrollTo","onKeyPress","Title","Sidebar","do_close_bound","do_close","do_back_bound","do_back","contents","stack","cur_title","onTouchEnd","click","PressureHelper","level","fired","esc_interval","clearInterval","Pressure","change","force","do_fire","end","polyfill","only","preventSelect","repeat","THRESHOLD","setInterval","new_level","pad","left","right","top","bottom","DeprecatedAlert","App","override","update_color_scheme","add","addListener","listen_darkmode","default","light","dark","sidebar_stack","flow_render_key","show_sidebar_bound","set_mode_bound","on_pressure_bound","on_pressure","ns","position","pop","Provider","isLocalhost","Boolean","hostname","registerValidSW","swUrl","register","onupdatefound","installingWorker","installing","onstatechange","controller","ReactDOM","getElementById","ready","checkValidServiceWorker"],"mappings":"keAIaA,EAAb,WACE,aAAe,oBACbC,KAAKC,MAAQ,GACbD,KAAKE,UAAYC,KAAKC,SAH1B,gDAMMC,GAAuB,IAAjBC,EAAgB,wDAExB,OADAD,EAAOA,EAAKE,cACRD,EAAe,CAAC,kBAAmB,mBAC1B,iBAATD,EAAsB,CAAC,kBAAmB,oBAEzCL,KAAKC,MAAMI,KACdL,KAAKE,WAdoB,iBAezBF,KAAKE,WAAa,EAClBF,KAAKC,MAAMI,GAAQ,CAAC,OAAD,OACO,IAAjBL,KAAKE,UADK,6BAEO,IAAjBF,KAAKE,UAFK,iBAKdF,KAAKC,MAAMI,QAnBtB,KCFaG,EAAS,mEAGTC,EAAa,wFACbC,EAAc,mYACdC,EAAS,0KAETC,EAAS,iCAEf,SAASC,EAAWC,EAAKC,GAuB9B,OAnBAD,EAAM,CAAC,CAAC,KAAMA,IACdC,EAAMC,SAAQ,SAACC,GAAU,IAAD,cACFA,EADE,GACjBZ,EADiB,KACXa,EADW,KAEtBJ,EAAM,GAAGK,OAAOC,MACd,GACAN,EAAIO,KAAI,SAACC,GAAU,IAAD,cACMA,EADN,GACXL,EADW,KACLM,EADK,KAEhB,OAAIN,EAEK,CAACK,GAEDC,EACJC,MAAMN,GACNG,KAAI,SAACI,GAAD,OAAUP,EAAMQ,KAAKD,GAAO,CAACpB,EAAMoB,GAAO,CAAC,KAAMA,MACrDE,QAAO,mCAAEtB,EAAF,KAAQoB,EAAR,YAA0B,OAATpB,GAAiBoB,YAK7CX,E,mEClCF,SAASc,EAASC,GACvB,OAAKA,EAAIC,GAOFD,EAAIE,OAAOC,MAAK,SAACC,GACtB,IACE,OAAOC,KAAKC,MAAMF,GAClB,MAAOG,GAIP,MAHAC,QAAQC,MAAM,oBACdD,QAAQE,MAAMH,GACdC,QAAQG,IAAIP,GACN,IAAIQ,YAAY,oBAAsBR,EAAES,OAAO,EAAG,SAbnDb,EAAIE,OAAOC,MAAK,SAACC,GAGtB,MAFAI,QAAQG,IAAI,SAAUX,GACtBI,EAAIA,EAAEU,OAAS,IAAMV,EAAI,GACnBW,MAAM,GAAD,OAAIf,EAAIgB,OAAR,YAAkBhB,EAAIiB,WAAtB,YAAoCb,OAiCrD,IAAMc,EAAQ,CACZ,QACA,MACA,QACA,OACA,MACA,UACA,QACA,OACA,WACA,QACA,OACA,QACA,WACA,SACA,SACA,OACA,QACA,UACA,QACA,SACA,MACA,SACA,SACA,SACA,UACA,QCpDF,SAASC,EAAKC,GACZ,OAAOA,EAAI,GAAK,IAAMA,EAAI,GAAKA,EAE1B,SAASC,EAAYC,GAC1B,MAAM,GAAN,OAAUA,EAAKC,WAAa,EAA5B,YAAiCJ,EAC/BG,EAAKE,WADP,YAEKF,EAAKG,WAFV,YAEwBN,EAAKG,EAAKI,cAFlC,YAEmDP,EAAKG,EAAKK,eAE/D,IAAMC,EAAiBC,IAAeC,KAC/B,SAASC,EAAKC,GACnB,IAAMV,EAAO,IAAIW,KAAmB,IAAdD,EAAME,OAC5B,OACE,0BAAMC,UAAW,YACf,kBAAC,IAAD,CACEC,KAAMd,EACNe,UAAWT,EACXU,MAAOhB,EAAKiB,eAAe,QAAS,CAClCC,SAAU,gBACVC,QAAQ,MANd,OAUIT,EAAMU,MAA4B,KAApBrB,EAAYC,IAK3B,SAASqB,EAAUX,GACxB,OACE,uBAAGG,UAAU,uCACX,0BAAMA,UAAU,iBAAiBH,EAAM9B,O,IAevC0C,E,kDACJ,WAAYZ,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACXC,eAAgB,QAGlB,EAAKC,gBAAkBC,IAAMC,YANZ,E,uDASR1C,EAAG2C,EAAKC,GACjB3C,QAAQG,IAAIuC,GACZ3C,EAAE6C,iBACFF,EAAIG,KAAO,2BAA6BF,EAAIG,QAAQC,MACpD/C,QAAQG,IAAIuC,GACZM,MAAM,mE,+BAGE,IAAD,OACP,OACE,6BACE,yBAAKrB,UAAU,+BACf,yBAAKA,UAAU,uBACb,2BACE,yGAEF,2BACE,uBAAGkB,KAAM,kDAAwDI,OAAO,SACtEC,eAAe,UAEf,0BAAMvB,UAAU,oBAHlB,qBAOF,2BACE,2BAAOgB,IAAKhF,KAAK4E,gBAAiBY,YAAY,6BAC9C,6BACA,uBACEN,KAAK,oBACLI,OAAO,SACPG,QAAS,SAACrD,GACR,EAAKsD,WAAWtD,EAAGA,EAAEkD,OAAQ,EAAKV,mBAGpC,0BAAMZ,UAAU,oBAPlB,4BAWF,2BACE,wGACA,6BACA,uBAAGkB,KAAK,oBAAoBI,OAAO,UACjC,0BAAMtB,UAAU,oBADlB,uCAKF,2BACE,4BAAQ2B,KAAK,SAASC,UAAQ,GAC5B,0BAAM5B,UAAU,oBADlB,wBAKF,2BACE,4BAAQ2B,KAAK,SAASC,UAAQ,GAC5B,0BAAM5B,UAAU,oBADlB,yDAKF,6BACA,2BACE,4BAAQyB,QAASzF,KAAK6D,MAAMgC,UAA5B,iBAEF,6BACA,yBAAK7B,UAAU,4BACb,4CACA,4BACE,4BACG,IADH,4rBAIA,4BACG,IADH,6iBAE2G,KAE3G,uH,GApFe8B,aA6FhBC,EAAb,kDACE,WAAYlC,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACXsB,YAAY,GAEd,EAAKC,eAAiB,EAAKC,SAASC,KAAd,gBACtB,EAAKC,eAAiB,EAAKP,SAASM,KAAd,gBANL,EADrB,uDAWInG,KAAKqG,SAAS,CACZL,YAAY,MAZlB,iCAgBIhG,KAAKqG,SAAS,CACZL,YAAY,MAjBlB,+BAsBI,OACE,oCACGhG,KAAK6D,MAAMyC,SAAStG,KAAKiG,gBACzBjG,KAAK0E,MAAMsB,YACV,kBAAC,EAAD,CACEO,eAAgBvG,KAAK6D,MAAM0C,eAC3BV,SAAU7F,KAAKoG,sBA5B3B,GAAgCN,a,6EC9I5BU,G,qBAAK,IAAIC,IAAW,CACtBC,MAAM,EACNC,SAAS,EACTC,QAAQ,EACRC,QAAQ,EACRC,UALsB,SAKZC,EAAKC,GACb,GAAIA,GAAQC,IAAKC,YAAYF,GAC3B,IACE,MACE,2BACAC,IAAKH,UAAUE,EAAMD,GAAK,GAAM3B,MAChC,gBAEF,MAAO+B,IAEX,MACE,2BAA6BX,EAAGY,MAAMC,WAAWN,GAAO,mBAG3DO,IAAIC,IAAiB,CACtBC,cAAc,EACdC,WAAY,aCbDC,EAAQ,UAAMC,uCAAN,WACRC,EAAU,UAAMD,uCAAN,WACVE,GAAY,UAAMF,yCA0DxB,SAASG,GAAYjE,GAC1B,OACE,0BACEG,UAAU,eACV+D,MAAO,CACL,8BAA+BlE,EAAMmE,OAAO,GAC5C,6BAA8BnE,EAAMmE,OAAO,KAG5CnE,EAAMyC,UAKb,SAAS2B,GAAcC,GACrB,MAAO,eAAexG,KAAKwG,GAAOA,EAAM,UAAYA,EAGtD,SAASC,GAAa/F,GACpBA,EAAEkD,OAAO8C,WAAWC,UAAUC,OAAO,WAIhC,IAAMC,GAAb,uKAEI,IDrEYxG,ECqEN8B,EAAQ7D,KAAK6D,MAEb2E,EAAsB,CAC1B,CACEC,kBAAmB,SAACC,GAAD,MAAU,cAAchH,KAAKgH,EAAKrI,OACrDsI,YAFF,SAEcD,EAAMpC,EAAUsC,GAC1B,IAAIC,GAAgBH,EAAKrI,KAAK,GAC1BwI,EAAe,IAAGA,EAAe,GACrC,IAAMC,EAAU,WAAOD,GACvB,OAAO,kBAACC,EAAD,CAAYC,IAAKH,GAAQtC,KAGpC,CACEmC,kBAAmB,SAACC,GAAD,MAAwB,QAAdA,EAAKrI,MAClCsI,YAFF,SAEcD,EAAME,GAChB,OACE,0BAAM5E,UAAU,4BACd,yBACEgF,IAAKf,GAAcS,EAAKO,QAAQD,KAChCE,IAAKR,EAAKQ,IACVlF,UAAU,UACVuB,eACEsC,IAAgBa,EAAKO,QAAQD,IAAIG,WAAWtB,IACxC,SACA,cAENuB,QAASjB,GACTkB,OAAQlB,QAMlB,CACEM,kBAAmB,SAACC,GAAD,MAAwB,MAAdA,EAAKrI,MAClCsI,YAFF,SAEcD,EAAMpC,EAAUsC,GAC1B,OACE,uBACE1D,KAAM+C,GAAcS,EAAKO,QAAQ/D,MACjCI,OAAO,SACPgE,IAAI,YACJ/D,eACEsC,IAAgBa,EAAKO,QAAQ/D,KAAKiE,WAAWtB,IACzC,SACA,cAEN7D,UAAU,WACV+E,IAAKH,GAEJtC,EACD,0BAAMtC,UAAU,yBAKxB,CACEyE,kBADF,SACoBC,GAChB,MACgB,SAAdA,EAAK/C,MAAmB+C,EAAKa,QAA+B,MAArBb,EAAKa,OAAOlJ,MAGvDsI,YANF,SAMcD,EAAMpC,EAAUsC,GAC1B,IAAMY,EAAed,EAAKe,KACtB1I,EAAQ,CACV,CAAC,UAAWN,GACZ,CAAC,MAAOE,GACR,CAAC,MAAOH,GACR,CAAC,MAAOI,GACR,CAAC,WAAYF,IAEf,GAAImD,EAAM6F,aAAc,CACtB,IAAIC,EAAa9F,EAAM6F,aAAalI,MAAM,KAAKG,QAAO,SAACiI,GAAD,QAASA,KAC/D7I,EAAM8I,KAAK,CACT,SACA,IAAIC,OAAJ,WACMH,EACDtI,KAAI,SAACuI,GAAD,OAAOA,EAAEG,QAAQ,sBAAuB,WAC5CC,KAAK,KAHV,KAIE,OAIN,IAAMC,EAAWpJ,EAAW2I,EAAczI,GAE1C,OACE,kBAAC,IAAMmJ,SAAP,CAAgBnB,IAAKH,GAClBqB,EAAS5I,KAAI,WAAY8I,GAAS,IAAD,mBAAlBlJ,EAAkB,KAAZmJ,EAAY,KAChC,OACE,0BAAMrB,IAAKoB,GACC,YAATlJ,EACC,0BACE+C,UAAU,eACVG,MAAOiG,EACP3E,QAAS,SAACrD,GACRA,EAAE6C,iBACFpB,EAAMwG,SAASD,EAAE5I,MAAM,MAAM,MAG9B4I,GAEQ,QAATnJ,EACF,oCACE,uBACEiE,KAAM+C,GAAcmC,GACpBpG,UAAU,WACVsB,OAAO,SACPgE,IAAI,WACJ/D,eACEsC,IAAgBuC,EAAEjB,WAAWtB,IACzB,SACA,eAGLuC,EACD,0BAAMpG,UAAU,uBA9L1C,SAAkB4F,GAChB,IACE,IAAI1B,EAAM,IAAIoC,IAAIV,GAClB,OACE1B,EAAIqC,SAASC,SAAS,SACtBtC,EAAIqC,SAASC,SAAS,UACrBtC,EAAIuC,aAAaC,IAAI,aAAe,IAAIvB,WAAW,UAEtD,MAAO/G,GACP,OAAO,GA4LcuI,CAASP,IACR,2BAAOpG,UAAU,YAAYgF,IAAKoB,EAAGQ,UAAQ,IAzLvE,SAAkBhB,GAChB,IACE,IAAI1B,EAAM,IAAIoC,IAAIV,GAClB,OACE1B,EAAIqC,SAASC,SAAS,UACrBtC,EAAIuC,aAAaC,IAAI,aAAe,IAAIvB,WAAW,UAEtD,MAAO/G,GACP,OAAO,GAmLcyI,CAAST,IACR,2BAAOpG,UAAU,YAAYgF,IAAKoB,EAAGQ,UAAQ,KAGtC,QAAT3J,EACF,uBACEiE,KAAM,IAAMkF,EACZ3E,QAAS,SAACrD,GACRA,EAAE6C,iBACFpB,EAAMwG,SAASD,EAAEU,UAAU,MAG5BV,GAEQ,aAATnJ,EACF,kBAAC6G,GAAD,CAAaE,OAAQnE,EAAMkH,aAAaL,IAAIN,IACzCA,GAEQ,WAATnJ,EACF,0BAAM+C,UAAU,0BAA0BoG,GAC/B,QAATnJ,EACF,uBAAGiE,KAAMkF,GAAIA,GAEbA,SAShB,CACE3B,kBAAmB,kBAAM,GACzBE,YA7JgB,IAAIqC,IAAYC,uBAAuBpG,KA6J9BqG,qBAGvBC,EAAS,IAAIH,IAAYI,OAC3BC,EAAQxH,EAAM9B,KACZuJ,GDxOMvJ,ECwOsBsJ,EDxOb7E,EAAG+E,OAAOxJ,ICyO/B,OACEoJ,EAAOK,sBACLF,GACA,SAAC5C,GAAD,MAAwB,WAAdA,EAAK/C,OACf6C,IACG,SA3KX,GAAyC1C,aAgLzC2F,OAAOC,gBAAkB,GAElB,IAAMC,GAAb,kDACE,WAAY9H,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACX3C,KAAM,IAER,EAAK6J,gBAAkB,EAAKC,UAAU1F,KAAf,gBACvB,EAAK2F,iBAAmB,EAAKC,WAAW5F,KAAhB,gBACxB,EAAK6F,MAAQ,EAAKA,MAAM7F,KAAX,gBACb,EAAK8F,SAAWpH,IAAMC,YACtB,EAAKoH,gBAAkBrI,EAAMgI,WAAc,aAC3C,EAAKM,gBAAkBtI,EAAMuI,WAAc,aAV1B,EADrB,gEAcuB,IAAD,OAClBpM,KAAKqG,SACH,CACEtE,KAAM0J,OAAOC,gBAAgB1L,KAAK6D,MAAMwI,KAAO,KAEjD,WACE,EAAKH,gBAAgB,EAAKxH,MAAM3C,WApBxC,6CA0BI0J,OAAOC,gBAAgB1L,KAAK6D,MAAMwI,IAAMrM,KAAK0E,MAAM3C,KACnD/B,KAAKkM,gBAAgBlM,KAAK0E,MAAM3C,QA3BpC,gCA8BYuK,GACRtM,KAAKqG,SAAS,CACZtE,KAAMuK,EAAMhH,OAAOF,QAErBpF,KAAKkM,gBAAgBI,EAAMhH,OAAOF,SAlCtC,iCAoCakH,GACS,UAAdA,EAAMvD,KAAmBuD,EAAMC,UAAYD,EAAME,SACnDF,EAAMrH,iBACNjF,KAAKmM,qBAvCX,8BA4CInM,KAAKqG,SAAS,CACZtE,KAAM,OA7CZ,0BAgDMA,GACF/B,KAAKkM,gBAAgBnK,GACrB/B,KAAKqG,SAAS,CACZtE,KAAMA,MAnDZ,4BAuDI,OAAO/B,KAAK0E,MAAM3C,OAvDtB,8BA0DI/B,KAAKiM,SAAS9G,QAAQsH,UA1D1B,+BA8DI,OACE,8BACEzH,IAAKhF,KAAKiM,SACVS,SAAU1M,KAAK4L,gBACfxG,MAAOpF,KAAK0E,MAAM3C,KAClB4K,UAAW3M,KAAK8L,iBAChBc,UAAU,aApElB,GAAkC9G,aA0E9B+G,GAAmB,KAMhB,SAASC,GAAajJ,GAC3B,IAAIkJ,EAAS,oBAAoBrL,KAAK+J,OAAOuB,UAAUC,WAKvD,OAHExB,OAAOyB,WAAW,8BAA8BC,SAChD1B,OAAOuB,UAAUI,WAEM,KAErBL,EAEMC,UAAUI,WAKd,KAJF,yBAAKpJ,UAAU,qBACb,0BAAMA,UAAU,oBADlB,yCAEsB,mEAFtB,uBAOK6I,GACL,yBAAK7I,UAAU,qBACb,0BAAMA,UAAU,oBADlB,4CAEgB,IACd,2BACE,uBACEyB,QAAS,WACHoH,IAAkBA,GAAiBQ,WAF3C,mCAOG,IAXP,sBAcE,KAtCR5B,OAAO6B,iBAAiB,uBAAuB,SAAClL,GAC9CC,QAAQG,IAAI,uCACZqK,GAAmBzK,KAuCd,I,GAAMmL,GAAb,kDACE,WAAY1J,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACX8I,OAAO,EACPC,OAAQ,EACRC,OAAQ,GAEV,EAAKC,eAAiB,EAAKC,SAASzH,KAAd,gBACtB,EAAK0H,cAAgB,EAAKC,QAAQ3H,KAAb,gBACrB,EAAK4H,aAAe,EAAKC,OAAO7H,KAAZ,gBAEpB,EAAK8H,eAAiB,EACtB,EAAKC,UAAY,EAZA,EADrB,qDAgBW9L,GAEPpC,KAAKqG,SAAS,CACZmH,OAAO,EACPC,QAASrL,EAAE+L,QAAU/L,EAAE+L,QAAQ,GAAK/L,GAAGgM,QACvCV,QAAStL,EAAE+L,QAAU/L,EAAE+L,QAAQ,GAAK/L,GAAGiM,YArB7C,8BAwBUjM,GACDpC,KAAK0E,MAAM8I,OAEZrN,KAAKmO,KAAKlM,EAAE+L,QAAU/L,EAAE+L,QAAQ,GAAK/L,GAAGgM,QAAUpO,KAAK0E,MAAM+I,QAC7DtN,KAAKmO,KAAKlM,EAAE+L,QAAU/L,EAAE+L,QAAQ,GAAK/L,GAAGiM,QAAUrO,KAAK0E,MAAMgJ,QAEpD1N,KAAKiO,gBACdjO,KAAKqG,SAAS,CACZmH,OAAO,MAhCjB,6BAoCSlB,GAEAtM,KAAK0E,MAAM8I,OAAOxN,KAAKuO,YAAYjC,GACxCtM,KAAKqG,SAAS,CACZmH,OAAO,MAxCb,kCA4CclB,GACNtM,KAAKkO,UAAY,KAAO,IAAIpK,OAChC9D,KAAKkO,WAAa,IAAIpK,KACtB9D,KAAK6D,MAAM2K,SAASlC,MA/CxB,+BAmDI,OACE,yBACEmC,aAAczO,KAAK2N,eACnBe,YAAa1O,KAAK2N,eAClBgB,YAAa3O,KAAK6N,cAClBe,YAAa5O,KAAK6N,cAClBpI,QAASzF,KAAK+N,cAEb/N,KAAK6D,MAAMyC,cA3DpB,GAAkCuI,iB,6BCnYrBC,I,OAAb,kDACE,WAAYjL,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACXC,eAAgB,OAChBoK,IAAK,IAEP,EAAKC,cAAgBnK,IAAMC,YANV,EADrB,gEAWI9E,KAAKiP,SAXT,6BAcU,IAAD,OAC6B,YAA9BjP,KAAK0E,MAAMC,gBACf3E,KAAKqG,SACH,CACE1B,eAAgB,YAElB,WACEuK,MAAMxH,EAAW,aAAc,CAC7ByH,QAAS,CAAE,aAAc,EAAKtL,MAAMuL,SAEnCpN,KAAKJ,GACLI,MAAK,SAACqN,GACL,EAAKhJ,SAAS,CACZ1B,eAAgB,OAChBoK,IAAKM,EAAK5F,KACV6F,WAAYD,EAAKC,WACjBC,KAAMF,EAAKE,KACXC,UAAWH,EAAKG,eAGnBC,OAAM,SAACC,GACNrN,QAAQC,MAAMoN,GACdrK,MAAM,GAAKqK,GACX,EAAKrJ,SAAS,CACZ1B,eAAgB,mBAtC9B,qCA8CI,GAAkC,YAA9B3E,KAAK0E,MAAMC,eACf,GAAK3E,KAAKgP,cAAc7J,QAAQC,MAAhC,CAIA,IAAIuK,EAAK3P,KAAK0E,MAAM8K,UAAY,IAAMxP,KAAKgP,cAAc7J,QAAQC,MACjE/C,QAAQG,IAAImN,GACZC,aAAY,MAAYD,EACxBtK,MAAM,sHACNoG,OAAOoE,SAASC,cAPdzK,MAAM,gDAhDZ,+BA0DY,IAAD,OACP,MAAkC,YAA9BrF,KAAK0E,MAAMC,eACN,uBAAGX,UAAU,eAAb,kCAC8B,WAA9BhE,KAAK0E,MAAMC,eAEhB,yBAAKX,UAAU,eACb,uBACEyB,QAAS,WACP,EAAKwJ,SAFT,6BASiC,SAA9BjP,KAAK0E,MAAMC,eAEhB,oCACE,6BACA,mEACS,kBAACf,EAAD,CAAMG,MAAO/D,KAAK0E,MAAM4K,WAAY/K,OAAO,KAEpD,iDACM,2BAAIvE,KAAK0E,MAAM6K,OAErB,6BACA,6BACE,+DACA,yBAAKvL,UAAU,iBAAiBhE,KAAK0E,MAAM8K,UAA3C,MACA,2BACE7J,KAAK,OACL3B,UAAU,YACVgB,IAAKhF,KAAKgP,cACVxJ,YAAY,iCACZoH,UAAW,KAEb,4BACEjH,KAAK,SACLC,SAAwC,YAA9B5F,KAAK0E,MAAMC,eACrBc,QAAS,SAACrD,GAAD,OAAO,EAAK2N,iBAHvB,iBAQD/P,KAAK0E,MAAMqK,IAAI1N,KAAI,SAAC0N,GAAD,OAClB,yBAAK/K,UAAU,MAAM+E,IAAKgG,EAAIpJ,KAAOoJ,EAAIiB,WACvC,yBAAKhM,UAAU,cACb,kBAACJ,EAAD,CAAMG,MAAOgL,EAAIiB,UAAWzL,OAAO,IADrC,YAGE,2BAAIwK,EAAIpJ,MAHV,OAKE,0BAAM3B,UAAU,mBAAmB+K,EAAIkB,OAEzC,yBAAKjM,UAAU,eACb,6BAAM+K,EAAImB,cAMV,SAtHhB,GAAmCrB,kBCF7BsB,I,OAAY,IAChB,yEACE,mDACF,+CAAgD,sBAHhC,wFAKd,4BALc,eAMhB,2EACE,wCAPc,eAQhB,8EACE,wCATc,eAUhB,+EACE,4CAXc,eAYhB,+EACE,4BAbc,eAchB,wEACE,kCAfc,eAgBhB,yEACE,wCAjBc,IAoBZC,GAAiB,CACrBC,eACE,mEACFC,iBAAkB,UAClBC,UAAU,EACVC,YAAY,EACZC,aAAc,UACdC,WAAW,EACXC,SAAU,CAAC,MAAO,QAClBC,eAAgB,CAAC,qBAAO,0CACxBC,aAAc,IAGT,SAASC,KACd,IACIC,EADAC,EAASC,OAAOC,OAAO,GAAId,IAE/B,IACEW,EAAgB7O,KAAKC,MAAMyN,aAAY,aAAmB,MAC1D,MAAOxN,GACPiD,MAAM,qGAAuBjD,UACtBwN,aAAY,YACnBmB,EAAgB,GAIlBE,OAAOE,KAAKJ,GAAe/P,SAAQ,SAAC+H,QACdqI,IAAhBJ,EAAOjI,KAAoBiI,EAAOjI,GAAOgI,EAAchI,OAGzDgI,EAAa,iBACfC,EAAM,eAAqBD,EAAa,eAAmB5P,OACzD6P,EAAM,iBAIV3O,QAAQG,IAAI,gBAAiBwO,GAC7BvF,OAAOuF,OAASA,EAGX,SAASK,KAA+B,IAAnBC,IAAkB,yDAC5C1B,aAAY,YAAkB1N,KAAKqP,UAAU9F,OAAOuF,QAChDM,GAAWR,KAGV,SAASU,GAAYC,EAAKC,GAG/B,YAFYN,IAARK,IAAmBA,EAAMhG,OAAOuF,OAAOX,qBAC7Be,IAAVM,IAAqBA,EAAQjG,OAAOuF,OAAOV,kBACxC,CACLqB,WAAY,4BACZC,gBAAyB,OAARH,EAAe,QAAU,QAAUI,UAAUJ,GAAO,KACrEK,gBAAiBJ,EACjBK,eAAgB,S,IAIdC,G,kDACJ,WAAYnO,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACX+M,IAAKhG,OAAOuF,OAAOX,eACnBqB,MAAOjG,OAAOuF,OAAOV,kBAJN,E,2DASjBtQ,KAAK6D,MAAM2K,SAAS,CAClB6B,eAAgBrQ,KAAK0E,MAAM+M,IAC3BnB,iBAAkBtQ,KAAK0E,MAAMgN,U,gCAIvBtP,GACR,IAAIgD,EAAQhD,EAAEkD,OAAOF,MACrBpF,KAAKqG,SACH,CACEoL,IAAe,YAAVrM,EAAsB,GAAe,YAAVA,EAAsB,KAAOA,GAE/DpF,KAAKiS,aAAa9L,KAAKnG,S,oCAGboC,GACZpC,KAAKqG,SACH,CACEoL,IAAKrP,EAAEkD,OAAOF,OAEhBpF,KAAKiS,aAAa9L,KAAKnG,S,sCAGXoC,GACdpC,KAAKqG,SACH,CACEqL,MAAOtP,EAAEkD,OAAOF,OAElBpF,KAAKiS,aAAa9L,KAAKnG,S,+BAKzB,IAAIkS,EACiB,OAAnBlS,KAAK0E,MAAM+M,IACP,WACuD,IAAvDR,OAAOE,KAAKhB,IAAcgC,QAAQnS,KAAK0E,MAAM+M,KAC7C,UACAzR,KAAK0E,MAAM+M,IACjB,OACE,6BACE,2BACE,6DACA,4BACEzN,UAAU,gBACVoB,MAAO8M,EACPxF,SAAU1M,KAAKoS,UAAUjM,KAAKnG,OAE7BiR,OAAOE,KAAKhB,IAAc9O,KAAI,SAAC0H,GAAD,OAC7B,4BAAQA,IAAKA,EAAK3D,MAAO2D,GACtBoH,GAAapH,OAGlB,4BAAQ3D,MAAM,WAAd,oDACA,4BAAQA,MAAM,WAAd,yCAbJ,OAgBE,kDAhBF,OAiBkB,YAAf8M,GACC,2BACEvM,KAAK,MACLH,YAAY,2BACZJ,MAAOpF,KAAK0E,MAAM+M,IAClB/E,SAAU1M,KAAKqS,cAAclM,KAAKnG,QAGtB,YAAfkS,GACC,2BACEvM,KAAK,QACLP,MAAOpF,KAAK0E,MAAMgN,MAClBhF,SAAU1M,KAAKsS,gBAAgBnM,KAAKnG,SAI1C,yBACEgE,UAAU,aACV+D,MAAOyJ,GAAYxR,KAAK0E,MAAM+M,IAAKzR,KAAK0E,MAAMgN,c,GAtFzB7C,iBA6FzB0D,G,kDACJ,WAAY1O,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACX+L,aAAchF,OAAOuF,OAAOP,cAHb,E,2DAQjBzQ,KAAK6D,MAAM2K,SAAS,CAClBiC,aAAczQ,KAAK0E,MAAM+L,iB,gCAInBrO,GACR,IAAIgD,EAAQhD,EAAEkD,OAAOF,MACrBpF,KAAKqG,SACH,CACEoK,aAAcrL,GAEhBpF,KAAKiS,aAAa9L,KAAKnG,S,+BAKzB,OACE,6BACE,2BACE,6DACA,4BACEgE,UAAU,gBACVoB,MAAOpF,KAAK0E,MAAM+L,aAClB/D,SAAU1M,KAAKoS,UAAUjM,KAAKnG,OAE9B,4BAAQoF,MAAM,WAAd,4BACA,4BAAQA,MAAM,SAAd,wCACA,4BAAQA,MAAM,QAAd,yCATJ,OAWQ,iDAER,uBAAGpB,UAAU,sBAAb,mJ,GAxCwB6K,iBAgD1B2D,G,kDACJ,WAAY3O,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAL,eACGb,EAAMwI,GAAKZ,OAAOuF,OAAOnN,EAAMwI,KAHjB,E,2DAQjBrM,KAAK6D,MAAM2K,SAAX,eACGxO,KAAK6D,MAAMwI,GAAKrM,KAAK6D,MAAM4O,KAAKzS,KAAK0E,MAAM1E,KAAK6D,MAAMwI,S,gCAIjDjK,GACR,IAAIgD,EAAQpF,KAAK6D,MAAM1B,MAAMC,EAAEkD,OAAOF,OACtCpF,KAAKqG,SAAL,eAEKrG,KAAK6D,MAAMwI,GAAKjH,GAEnBpF,KAAKiS,aAAa9L,KAAKnG,S,+BAKzB,OACE,6BACE,+BACE,2BACE,2BAAIA,KAAK6D,MAAMxD,MADjB,OACgC,mCAASL,KAAK6D,MAAMwI,KAEpD,uBAAGrI,UAAU,sBAAsBhE,KAAK6D,MAAM6O,aAC9C,8BACErS,KAAM,UAAYL,KAAK6D,MAAMwI,GAC7BA,GAAE,0BAAqBrM,KAAK6D,MAAMwI,IAClCrI,UAAU,kBACVoB,MAAOpF,KAAK6D,MAAM8O,QAAQ3S,KAAK0E,MAAM1E,KAAK6D,MAAMwI,KAChDK,SAAU1M,KAAK6L,UAAU1F,KAAKnG,c,GArCb6O,iBA6CvB+D,G,kDACJ,WAAY/O,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACXmO,OAAQpH,OAAOuF,OAAO,EAAKnN,MAAMwI,KAHlB,E,sDAOTjK,GAAI,IAAD,OACP0Q,EAAM1Q,EAAEkD,OAAOyN,QACnB/S,KAAKqG,SACH,CACEwM,OAAQC,IAEV,WACE,EAAKjP,MAAM2K,SAAX,eACG,EAAK3K,MAAMwI,GAAKyG,S,+BAOvB,OACE,6BACE,2BACE,+BACE,2BACEzS,KAAM,UAAYL,KAAK6D,MAAMwI,GAC7B1G,KAAK,WACLoN,QAAS/S,KAAK0E,MAAMmO,OACpBnG,SAAU1M,KAAK6L,UAAU1F,KAAKnG,QALlC,OAOQ,2BAAIA,KAAK6D,MAAMxD,MAPvB,OAQQ,mCAASL,KAAK6D,MAAMwI,MAG9B,uBAAGrI,UAAU,sBAAsBhE,KAAK6D,MAAM6O,kB,GArC3B7D,iBA2CdmE,GAAb,kDACE,WAAYnP,GAAQ,IAAD,8BACjB,cAAMA,IACDoP,mBAAqB,EAAKhB,aAAa9L,KAAlB,gBAFT,EADrB,yDAMe+M,GACX7Q,QAAQG,IAAI0Q,GACZjC,OAAOE,KAAK+B,GAAKlS,SAAQ,SAAC+H,GACxB0C,OAAOuF,OAAOjI,GAAOmK,EAAInK,MAE3BsI,IAAY,KAXhB,uCAeQ5F,OAAO0H,QAAQ,gDACjB1H,OAAOuF,OAAS,GAChBK,KACA5F,OAAOoE,SAASC,YAlBtB,+BAuBI,OACE,6BACE,yBAAK9L,UAAU,wBACb,wHAEE,uBAAGyB,QAASzF,KAAKoT,eAAejN,KAAKnG,OAArC,4BAFF,UAIA,2BACE,oFACY,IACV,uBACEyF,QAAS,WACPgG,OAAOoE,SAASC,WAFpB,4BAMK,IARP,8BAaJ,yBAAK9L,UAAU,OACb,kBAAC,GAAD,CACEqI,GAAG,aACHmC,SAAUxO,KAAKiT,qBAEjB,6BACA,kBAAC,GAAD,CACE5G,GAAG,eACHmC,SAAUxO,KAAKiT,qBAEjB,6BACA,kBAAC,GAAD,CACEzE,SAAUxO,KAAKiT,mBACf5G,GAAG,YACHhM,KAAK,uCACLqS,YAAY,uEAEd,6BACA,kBAAC,GAAD,CACErG,GAAG,WACHmC,SAAUxO,KAAKiT,mBACf5S,KAAK,yDACLqS,YACE,2KAEFC,QAAS,SAACU,GAAD,OAAWA,EAAMrJ,KAAK,OAC/ByI,KAAM,SAACY,GAAD,OAAWA,EAAM1R,QAAO,SAAC2R,GAAD,OAAOA,MACrCnR,MAAO,SAACoR,GAAD,OAAYA,EAAO/R,MAAM,SAElC,6BACA,kBAAC,GAAD,CACE6K,GAAG,iBACHmC,SAAUxO,KAAKiT,mBACf5S,KAAK,iCACLqS,YAAa,iIACbC,QAAS,SAACU,GAAD,OAAWA,EAAMrJ,KAAK,OAC/ByI,KAAM,SAACY,GAAD,OAAWA,EAAM1R,QAAO,SAAC2R,GAAD,OAAOA,MACrCnR,MAAO,SAACoR,GAAD,OAAYA,EAAO/R,MAAM,SAElC,6BACA,kBAAC,GAAD,CACE6K,GAAG,eACHmC,SAAUxO,KAAKiT,mBACf5S,KAAK,yDACLqS,YACE,0NAEFC,QAAS,SAACU,GAAD,OAAWA,EAAMrJ,KAAK,OAC/ByI,KAAM,SAACY,GAAD,OAAWA,EAAM1R,QAAO,SAAC2R,GAAD,OAAOA,MACrCnR,MAAO,SAACoR,GAAD,OAAYA,EAAO/R,MAAM,SAElC,6BACA,kBAAC,GAAD,CACEgN,SAAUxO,KAAKiT,mBACf5G,GAAG,WACHhM,KAAK,2BACLqS,YAAY,kKAEd,6BACA,kBAAC,GAAD,CACElE,SAAUxO,KAAKiT,mBACf5G,GAAG,aACHhM,KAAK,2BACLqS,YAAY,iEAEd,6BACA,0GAEE,uBACExN,KAAK,8DACLI,OAAO,UAFT,SAFF,gCA9GV,GAA8BuJ,iBC7SxB2E,G,WACJ,aAAe,IAAD,2BACZxT,KAAKyT,GAAK,KACVzT,KAAK0T,8BAAgC,EACrC1T,KAAK2T,QAAU3T,KAAK2T,QAAQxN,KAAKnG,MACjCA,KAAK4T,QAAU5T,KAAK4T,QAAQzN,KAAKnG,MACjC,IAAM6T,EAAWC,UAAUC,KAbJ,gBACN,GAajBF,EAASG,QAAU3R,QAAQC,MAAM6D,KAAK9D,SACtCwR,EAASI,gBAAkB,SAAC3H,GAC1BjK,QAAQG,IAAI,4BACD8J,EAAMhH,OAAO4O,OACPC,kBAAkB,UAAW,CAC5CC,QAAS,QAELC,YAAY,cAAe,cAAe,CAAEC,QAAQ,KAE5DT,EAASU,UAAY,SAACjI,GACpBjK,QAAQG,IAAI,2BACZ,EAAKiR,GAAKnH,EAAMhH,OAAO4O,OACvBM,WAAW,EAAKC,YAAYtO,KAAK,GAAO,I,oDAKpCuO,EAAKjL,GAGX,IAFA,IAAIG,EAAI1H,KAAKqP,UAAU9H,GACnBkL,EAAI,GACCC,EAAI,EAAG7L,GA7BJ,GA6BqB2L,GAAO,IAAKE,EAAIhL,EAAEjH,OAAQiS,IAAK,CAC9D,IACIC,GAAW9L,EADPa,EAAEkL,WAAWF,GACK,GAAM,IAChCD,GAAKI,OAAOC,aAAajM,EAAMa,EAAEkL,WAAWF,IAC5C7L,EAAM8L,EAER,OAAOF,I,8BAIDD,EAAK9K,GACX,IAAI+K,EAAI,GACR,GAAiB,kBAAN/K,EAAoB,OAAO,KAEtC,IAAK,IAAIgL,EAAI,EAAG7L,GA3CJ,GA2CqB2L,GAAO,IAAKE,EAAIhL,EAAEjH,OAAQiS,IAAK,CAC9D,IAAIK,EAAIlM,EAAMa,EAAEkL,WAAWF,GAC3BD,GAAKI,OAAOC,aAAaC,GACzBlM,GAAOA,EAAOkM,EAAI,GAAM,IAG1B,IACE,OAAO/S,KAAKC,MAAMwS,GAClB,MAAOvS,GAGP,OAFAC,QAAQC,MAAM,kBACdD,QAAQE,MAAMH,GACP,Q,0BAIPsS,EAAKQ,GAAiB,IAAD,OAEvB,OADAR,EAAMS,SAAST,GACR,IAAIU,SAAQ,SAACC,EAASC,GAC3B,IAAK,EAAK7B,GAAI,OAAO4B,EAAQ,MAC7B,IACME,EADK,EAAK9B,GAAG+B,YAAY,CAAC,WAAY,aAC3BC,YAAY,WACvBC,EAAUH,EAAM7K,IAAIgK,GAC1BgB,EAAQnB,UAAY,WAClB,IAAI1S,EAAM6T,EAAQxB,OAClB,GAAKrS,GAAQA,EAAI8T,SAGV,GAAIT,IAAmBrT,EAAI+T,QAAS,CAGzC/T,EAAIgU,aAAe,IAAI/R,KACvByR,EAAMO,IAAIjU,GACV,IAAI4H,EAAO,EAAKmK,QAAQc,EAAK7S,EAAI8T,UACjCN,EAAQ5L,QAGRpH,QAAQG,IACN,wBACAkS,EACA,QACA7S,EAAI+T,QACJ,SACAV,GAEFK,EAAMQ,OAAOrB,GACbW,EAAQ,WAnBRA,EAAQ,OAsBZK,EAAQ1B,QAAU,SAAC5R,GACjBC,QAAQ2T,KAAK,uCACb3T,QAAQC,MAAMF,GACdiT,EAAQ,Y,0BAKVX,EAAKQ,EAAgBzL,GAAO,IAAD,OAE7B,OADAiL,EAAMS,SAAST,GACR,IAAIU,SAAQ,SAACC,EAASC,GAC3B,IAAK,EAAK7B,GAAI,OAAO4B,IACV,EAAK5B,GAAG+B,YAAY,CAAC,WAAY,aAC3BC,YAAY,WACvBK,IAAI,CACRpB,IAAKA,EACLkB,QAASV,EACTS,SAAU,EAAKhC,QAAQe,EAAKjL,GAC5BoM,aAAc,IAAI/R,OAhHD,QAmHb,EAAK4P,+BACTc,WAAW,EAAKC,YAAYtO,KAAK,GAAO,Q,6BAIvCuO,GAAM,IAAD,OAEV,OADAA,EAAMS,SAAST,GACR,IAAIU,SAAQ,SAACC,EAASC,GAC3B,IAAK,EAAK7B,GAAI,OAAO4B,IACrB,IAEIY,EAFO,EAAKxC,GAAG+B,YAAY,CAAC,WAAY,aAC3BC,YAAY,WACbM,OAAOrB,GACvBrS,QAAQG,IAAI,uBAAwBkS,GACpCuB,EAAIjC,QAAU,WAEZ,OADA3R,QAAQ2T,KAAK,+BAAgCtB,GACtCW,KAETY,EAAI1B,UAAY,kBAAMc,U,oCAIX,IAAD,OACZ,GAAKrV,KAAKyT,GAAV,CACA,IACM8B,EADKvV,KAAKyT,GAAG+B,YAAY,CAAC,WAAY,aAC3BC,YAAY,WACzBS,EAAYX,EAAMY,QACtBD,EAAU3B,UAAY,WACpB,IAAI4B,EAAQD,EAAUhC,OAClBiC,EA9IgB,KA+IlB9T,QAAQG,IAAI,+BAAgC2T,GAC5CZ,EAAM3M,MAAM,eAAewN,gBAAgB7B,UAAY,SAACnS,GACtD,IAAIiU,EAAMjU,EAAEkD,OAAO4O,OACfmC,IAEFd,EAAMQ,OAAOM,EAAIC,cACXH,EArJQ,KAqJmBE,EAAIE,cAIzClU,QAAQG,IAAI,0CAA2C2T,GAEzD,EAAKzC,8BAAgC,GAEvCwC,EAAUlC,QAAU3R,QAAQC,MAAM6D,KAAK9D,Y,8BAIlCrC,KAAKyT,KACVK,UAAU0C,eArKa,iBAsKvBnU,QAAQG,IAAI,gC,KAIT,SAASiU,KAEd,OADKhL,OAAOiL,aAAYjL,OAAOiL,WAAa,IAAIlD,IACzC/H,OAAOiL,WCtKhB,IAEMC,GAAe,uCAAG,WAAOC,GAAP,6BAAAC,EAAA,6DAAiBC,EAAjB,yCACLlV,EAASgV,GADJ,UAEJ,KADdvH,EADkB,QAEb0H,KAFa,qBAGhB1H,EAAKN,IAHW,qBAId+H,EAJc,iBAKhBzR,MAAMgK,EAAKN,KALK,8BAOV,IAAInM,MAAMyM,EAAKN,KAPL,sCAUZ,IAAInM,MAAMV,KAAKqP,UAAUlC,IAVb,iCAafA,GAbe,4CAAH,sDAgBR2H,GAAgB,SAACC,EAASlM,GAAV,OAC3BkM,EACGC,MAAK,SAACL,EAAGM,GAAJ,OAAUhC,SAAS0B,EAAEO,IAAK,IAAMjC,SAASgC,EAAEC,IAAK,OACrD/V,KAAI,SAACgW,GAIJ,OAHAA,EAAKhX,KPuCJ,SAAkBiX,GACvB,GAAe,GAAXA,EAAc,MAAO,eAEzB,IAAIC,EAAID,EACJjX,EAAO,GACX,GAEEA,GAAQ,IAAM0C,GADdwU,GAAK,GACmB,IACxBA,EAAIpC,SAASoC,EAAI,UACVA,GAET,OAAOlX,EAAKqC,OAAO,GOlDH8U,CAASH,EAAKC,SAC1BD,EAAKI,eAAiB1M,EAAaL,IAAI2M,EAAKhX,KAAMgX,EAAK/W,QACvD+W,EAAKK,QAAU,GACRL,MAGAM,GAAM,CACjBC,aAAa,WAAD,4BAAE,WAAOlD,EAAKtF,EAAOrE,EAAc8M,GAAjC,iBAAAhB,EAAA,6DACZnC,EAAMS,SAAST,GADH,SAESxF,MAAMxH,EAAW,mBAAqBgN,EAAK,CAC9DvF,QAAS,CACP,aAAcC,KAJN,cAERwH,EAFQ,gBAOKD,GAAgBC,GAPrB,cAORvH,EAPQ,OAUZoH,KAAQX,IAAIpB,EAAKmD,EAAexI,GAChCA,EAAK5F,KAAOuN,GAAc3H,EAAK5F,KAAMsB,GAXzB,kBAYLsE,GAZK,4CAAF,yDAAC,GAebyI,wBAAwB,WAAD,4BAAE,WAAOpD,EAAKtF,EAAOrE,EAAc8M,GAAjC,eAAAhB,EAAA,6DACvBnC,EAAMS,SAAST,GADQ,SAEN+B,KAAQ/L,IAAIgK,EAAKmD,GAFX,YAEnBxI,EAFmB,+BAMrBA,EAAK5F,KAAOuN,GAAc3H,EAAK5F,KAAMsB,GANhB,kBAOd,CAAEtB,KAAM4F,EAAM0I,QAAQ,IAPR,wBAURJ,GAAIC,aAAalD,EAAKtF,EAAOrE,EAAc8M,GAVnC,eAUrBxI,EAVqB,yBAWd,CAAE5F,KAAM4F,EAAM0I,QAAS1I,IAXT,4CAAF,yDAAC,GAexB2I,cAAc,WAAD,4BAAE,WAAOtD,EAAKuD,EAAW7I,GAAvB,iBAAAyH,EAAA,6DACTpN,EAAO,IAAIyO,iBACVC,OAAO,MAAOzD,GACnBjL,EAAK0O,OAAO,SAAUF,EAAY,IAAM,KAH3B,SAIQ/I,MAAMxH,EAAW,aAAc,CAClD0Q,OAAQ,OACRjJ,QAAS,CACP,eAAgB,oCAChB,aAAcC,GAEhBiJ,KAAM5O,IAVK,cAITmN,EAJS,OAabH,KAAQV,OAAOrB,GAbF,kBAcNiC,GAAgBC,GAAU,IAdpB,2CAAF,uDAAC,GAiBd0B,OAAO,WAAD,4BAAE,WAAO5D,EAAK6D,EAAQC,EAAapJ,GAAjC,iBAAAyH,EAAA,6DACFpN,EAAO,IAAIyO,gBAAgB,CAC7B,CAAC,MAAOxD,GACR,CAAC,SAAU6D,KAETC,GACF/O,EAAK0O,OAAO,cAAe,GANvB,SAQejJ,MAAMxH,EAAW,UAAW,CAC/C0Q,OAAQ,OACRjJ,QAAS,CACP,eAAgB,oCAChB,aAAcC,GAEhBiJ,KAAM5O,IAdF,cAQFmN,EARE,yBAgBCD,GAAgBC,GAAU,IAhB3B,2CAAF,yDAAC,GAmBP6B,MAAM,WAAD,4BAAE,WAAO9S,EAAM0G,EAAI+C,GAAjB,iBAAAyH,EAAA,6DACDpN,EAAO,IAAIyO,gBAAgB,CAC7B,CAAC,OAAQvS,GACT,CAAC,KAAM0G,KAHJ,SAKgB6C,MAAMxH,EAAW,SAAU,CAC9C0Q,OAAQ,OACRjJ,QAAS,CACP,eAAgB,oCAChB,aAAcC,GAEhBiJ,KAAM5O,IAXH,cAKDmN,EALC,yBAaED,GAAgBC,GAAU,IAb5B,2CAAF,uDAAC,GAgBN8B,IAAI,WAAD,4BAAE,WAAO/S,EAAM0G,EAAIsM,EAAMvJ,GAAvB,iBAAAyH,EAAA,6DACCpN,EAAO,IAAIyO,iBACVC,OAAO,OAAQxS,GACpB8D,EAAK0O,OAAO,KAAM9L,GAClB5C,EAAK0O,OAAO,OAAQQ,GAJjB,SAKkBzJ,MAAMxH,EAAW,UAAW,CAC/C0Q,OAAQ,OACRjJ,QAAS,CACP,eAAgB,oCAChB,aAAcC,GAEhBiJ,KAAM5O,IAXL,cAKCmN,EALD,yBAaID,GAAgBC,GAAU,IAb9B,2CAAF,yDAAC,GAgBJgC,UAAU,WAAD,4BAAE,WAAOC,EAAIxM,EAAI+C,GAAf,iBAAAyH,EAAA,6DACLpN,EAAO,IAAIyO,iBACVC,OAAO,KAAMU,GAClBpP,EAAK0O,OAAO,MAAO9L,GAHV,SAIY6C,MAAMxH,EAAW,UAAW,CAC/C0Q,OAAQ,OACRjJ,QAAS,CACP,eAAgB,oCAChB,aAAcC,GAEhBiJ,KAAM5O,IAVC,cAILmN,EAJK,yBAYFD,GAAgBC,GAAU,IAZxB,2CAAF,uDAAC,GAeVkC,SAAS,WAAD,4BAAE,WAAOC,EAAM3J,EAAO4J,GAApB,eAAAnC,EAAA,sEACa3H,MAAM,GAAD,OACrBxH,EADqB,sBACCqR,EADD,uBACoBC,GAC5C,CACE7J,QAAS,CAAE,aAAcC,KAJrB,cACJwH,EADI,yBAODD,GAAgBC,IAPf,2CAAF,uDAAC,GAUTqC,WAAW,WAAD,4BAAE,WAAOF,EAAMG,EAAS9J,EAAO4J,GAA7B,eAAAnC,EAAA,sEACW3H,MAAM,GAAD,OACrBxH,EADqB,+BACUsR,EADV,iBAC0BD,EAD1B,qBAC2CI,mBACjED,GAFsB,qBAzJN,IA6JlB,CACE/J,QAAS,CAAE,aAAcC,KANnB,cACNwH,EADM,yBASHD,GAAgBC,IATb,2CAAF,yDAAC,GAYXwC,WAAW,WAAD,4BAAE,WAAO1E,EAAKtF,GAAZ,eAAAyH,EAAA,sEACW3H,MAAMxH,EAAW,eAAiBgN,EAAK,CAC1DvF,QAAS,CAAE,aAAcC,KAFjB,cACNwH,EADM,yBAIHD,GAAgBC,IAJb,2CAAF,qDAAC,GAOXyC,cAAc,WAAD,4BAAE,WAAOjK,GAAP,eAAAyH,EAAA,sEACQ3H,MAAMxH,EAAW,gBAAiB,CACrDyH,QAAS,CAAE,aAAcC,KAFd,cACTwH,EADS,yBAIND,GAAgBC,IAJV,2CAAF,mDAAC,GAOd0C,SAAS,WAAD,4BAAE,WAAOC,EAAM7E,EAAKtF,GAAlB,iBAAAyH,EAAA,6DACJpN,EAAO,IAAIyO,gBAAgB,CAC7B,CAAC,OAAQqB,GACT,CAAC,MAAO7E,KAHF,SAKaxF,MAAMxH,EAAW,QAAS,CAC7C0Q,OAAQ,OACRjJ,QAAS,CACP,eAAgB,oCAChB,aAAcC,GAEhBiJ,KAAM5O,IAXA,cAKJmN,EALI,yBAaDD,GAAgBC,GAAU,IAbzB,2CAAF,uDAAC,GAgBT4C,UAAU,WAAD,4BAAE,WAAOC,EAAMrK,GAAb,eAAAyH,EAAA,sEACY3H,MACnBxH,EAAW,aAAe+R,EAAKpY,KAAI,SAACqT,GAAD,qBAAiBA,MAAO1K,KAAK,KAChE,CACEmF,QAAS,CACP,aAAcC,KALX,cACLwH,EADK,yBASFD,GAAgBC,GAAU,IATxB,2CAAF,qDAAC,GAYV8C,UAAU,WAAD,4BAAE,WAAOvV,EAAOiL,GAAd,iBAAAyH,EAAA,6DACTxU,QAAQG,IAAI,UAAW2B,GACnBsF,EAAO,IAAIyO,gBAAgB,CAAC,CAAC,QAAS/T,KAFjC,SAGY+K,MAAMxH,EAAW,SAAU,CAC9C0Q,OAAQ,OACRjJ,QAAS,CACP,eAAgB,oCAChB,aAAcC,GAEhBiJ,KAAM5O,IATC,cAGLmN,EAHK,yBAWFD,GAAgBC,GAAU,IAXxB,2CAAF,qDAAC,IC9ML,SAAS+C,KACd/J,aAAY,iBAAuB1N,KAAKqP,UAAU9F,OAAOmO,kB,WCarDC,GAAa,sCACbC,GAAQ,sBAEDC,GAAWlV,IAAMmV,cAAc,CAC1C5U,MAAO,KACP6U,UAAW,eAGN,SAASC,GAAYrW,GAC1B,OACE,6BACE,kBAACiJ,GAAD,MACA,kBAAC,GAAD,CAAWqN,aAActW,EAAMsW,eAC/B,yBAAKnW,UAAU,iBACb,uBAAGkB,KAAK,cAAcI,OAAO,UAC3B,0BAAMtB,UAAU,oBAChB,gDAHJ,WAME,uBACEyB,QAAS,WACP5B,EAAMsW,aAAa,eAAM,kBAAC,GAAD,SAG3B,0BAAMnW,UAAU,uBAChB,4DAZJ,WAeE,uBAAGkB,KAAK,eAAeI,OAAO,UAC5B,0BAAMtB,UAAU,uBAChB,oFAEF,2BACE,oJAGJ,yBAAKA,UAAU,qBACb,2BACE,uBACEyB,QAAS,WACH,kBAAmBuH,WACrBA,UAAUoN,cACPC,mBACArY,MAAK,SAACsY,GAAmB,IAAD,gBACEA,GADF,IACvB,2BAAwC,CAAC,IAAhCC,EAA+B,QACtClY,QAAQG,IAAI,aAAc+X,GAC1BA,EAAaC,cAHQ,kCAO7B/D,KAAQzK,QACRwI,YAAW,WACT/I,OAAOoE,SAASC,QAAO,KACtB,OAfP,wCADF,6CAqBUnI,qBAA2C,IAClDA,aAtBH,oIAyBF,yBAAK3D,UAAU,qBACb,sJACA,0SAIA,4DACO,uBAAGkB,KAAM,UAAY4U,IAAQA,IADpC,YAIF,yBAAK9V,UAAU,qBACb,mGAEE,uBAAGkB,KAAK,6CAA6CI,OAAO,UAA5D,UAFF,qBAKM,IACJ,uBAAGJ,KAAM2U,GAAYvU,OAAO,UAA5B,SAEK,IARP,sBAWA,gFAEE,uBACEJ,KAAK,2CACLI,OAAO,SACPgE,IAAI,YAHN,kDAFF,SAUE,uBACEpE,KAAK,qCACLI,OAAO,SACPgE,IAAI,YAHN,qDAVF,SAiBI,IACF,uBAAGpE,KAAK,uBAAuBI,OAAO,SAASgE,IAAI,YAAnD,SAlBF,SAsBE,uBAAGpE,KAAK,4BAA4BI,OAAO,SAASgE,IAAI,YAAxD,WAtBF,wCA2BA,6BACA,6FAEE,uBAAGpE,KAAK,8BAA8BI,OAAO,UAA7C,WAFF,qBAKM,IACJ,uBAAGJ,KAAM2U,GAAYvU,OAAO,UAA5B,SAEK,IARP,wBAgBD,IAAMmV,GAAb,kDACE,WAAY5W,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACXgW,aAAcjP,OAAOkP,OAAS,GAC9BC,gBAAiBnP,OAAOoP,YAAc,GAJvB,EADrB,yDASe1W,EAAOiL,GAClB,GAAIjL,IAAUsH,OAAOkP,MAArB,CAIA,IAAIlR,EAAO,IAAIqR,SACfrR,EAAK0O,OAAO,QAAShU,GACrB+K,MAAMxH,EAAW,SAAU,CACzB0Q,OAAQ,OACRjJ,QAAS,CAAE,aAAcC,GACzBiJ,KAAM5O,IAELzH,KAAKJ,GACLI,MAAK,SAAC+Y,GACL,GAAe,IAAXA,EAAEhE,KACJ,MAAM,IAAInU,MAAMmY,EAAEhM,KAEpBtD,OAAOkP,MAAQxW,EACfkB,MAAM,uDAEPoK,OAAM,SAACC,GAAD,OAASrK,MAAM,gDAAeqK,WAlBrCrK,MAAM,wBAXZ,wCAgCoB2V,EAAM5L,GACtB,IAAI3F,EAAO,IAAIqR,SACfrR,EAAK0O,OAAO,OAAQ6C,GACpB9L,MAAMxH,EAAW,cAAe,CAC9B0Q,OAAQ,OACRjJ,QAAS,CAAE,aAAcC,GACzBiJ,KAAM5O,IAELzH,KAAKJ,GACLI,MAAK,SAAC+Y,GACL,GAAe,IAAXA,EAAEhE,KACJ,MAAM,IAAInU,MAAMmY,EAAEhM,KAEpBtD,OAAOoP,WAAaG,EACpB3V,MAAM,mEAEPoK,OAAM,SAACC,GAAD,OAASrK,MAAM,4DAAiBqK,QAhD7C,iCAmDaN,GACL6L,IAAK7L,IAAQ/J,MAAM,sFApD3B,+BAuDY,IAAD,OACP,OACE,kBAAC0U,GAASmB,SAAV,MACG,SAAC9L,GAAD,OACC,6BAIE,yBAAKpL,UAAU,kBACZoL,EAAMhK,MACL,6BACE,2BACE,6DACA,4BACEO,KAAK,SACLF,QAAS,WACP2J,EAAM6K,UAAU,QAGlB,0BAAMjW,UAAU,qBANlB,iBAQA,8BAEF,2BACE,uBACEyB,QAAS,WACP,EAAK5B,MAAMsW,aACT,2BACA,kBAAC,GAAD,CAAe/K,MAAOA,EAAMhK,WAJlC,wCAUA,6BAXF,oGAcA,2BACE,uBAAGK,QAAS,EAAK0V,WAAWhV,KAAK,EAAMiJ,EAAMhK,QAA7C,2BAGA,6BAJF,kNAQA,4DAEE,2BACEA,MAAO,EAAKV,MAAMgW,aAClBhO,SAAU,SAACtK,GACT,EAAKiE,SAAS,CAAEqU,aAActY,EAAEkD,OAAOF,SAEzCwH,UAAW,KAEb,4BACE5I,UAAU,mBACV2B,KAAK,SACLF,QAAS,SAACrD,GACR,EAAKgZ,aAAa,EAAK1W,MAAMgW,aAActL,EAAMhK,QAEnDQ,UAAW,EAAKlB,MAAMgW,cANxB,gBAUA,6BAnBF,kRAsBA,mEAEE,0BAAM3S,MAAO,CAAE4K,QAAS,eAAgB0I,MAAO,SAC7C,2BAAiC,EAA7B,EAAK3W,MAAMkW,kBAEjB,2BACExV,MAAO,EAAKV,MAAMkW,gBAClBjV,KAAK,QACL2V,IAAI,IACJC,IAAI,KACJC,KAAK,YACL9O,SAAU,SAACtK,GACT,EAAKiE,SAAS,CAAEuU,gBAAiBxY,EAAEkD,OAAOF,WAG9C,4BACEpB,UAAU,mBACV2B,KAAK,SACLF,QAAS,SAACrD,GACR,EAAKqZ,kBACH,EAAK/W,MAAMkW,gBACXxL,EAAMhK,SANZ,gBAYA,8BAAUiH,GAAG,aACX,qCACA,qCACA,sCAEF,6BAhCF,wTAqCF,kBAAC,EAAD,CAAY9F,eAAgB6I,EAAM6K,YAC/B,SAACyB,GAAD,OACC,6BACE,2BACE,4BAAQ/V,KAAK,SAASF,QAASiW,GAC7B,0BAAM1X,UAAU,oBADlB,qBAKF,2BACE,sNAzKxB,GAA+B8B,aA0LlB6V,GAAb,kDACE,WAAY9X,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACX3C,KAAM,GACN4C,eAAgB,OAChBiX,SAAS,EACTC,WAAW,GAEb,EAAKjQ,gBAAkB,EAAKC,UAAU1F,KAAf,gBACvB,EAAK2V,0BAA4B,EAAKC,oBAAoB5V,KAAzB,gBACjC,EAAK8F,SAAW,EAAKpI,MAAMoI,UAAYpH,IAAMC,YAC7C,EAAKkX,8BAAgC,EAAKC,wBAAwB9V,KAA7B,gBAGrC,EAAK4E,aAAe,IAAIhL,EAdP,EADrB,oEAkB0BqC,GAET,UAAXA,EAAE2U,MACD3U,EAAEmK,SACFnK,EAAEoK,SACgE,IAAnE,CAAC,QAAS,YAAY2F,QAAQ/P,EAAEkD,OAAO4W,QAAQ3b,gBAE3CP,KAAKiM,SAAS9G,UAChB/C,EAAE6C,iBACFjF,KAAKiM,SAAS9G,QAAQsH,WA3B9B,0CAgCI0P,SAAS7O,iBAAiB,WAAYtN,KAAKgc,iCAhC/C,6CAmCIG,SAASC,oBACP,WACApc,KAAKgc,iCArCX,gCAyCY5W,GACRpF,KAAKqG,SAAS,CACZtE,KAAMqD,MA3CZ,0CA+CsBkH,GAClBtM,KAAKqG,SAAS,CACZwV,UAAWvP,EAAMhH,OAAOyN,YAjD9B,gCAqDYzG,GAAQ,IAAD,OAEf,GADIA,GAAOA,EAAMrH,iBACiB,YAA9BjF,KAAK0E,MAAMC,gBACV3E,KAAK0E,MAAM3C,KAAhB,CACA/B,KAAKqG,SAAS,CACZ1B,eAAgB,YALH,IAQP+P,EAAQ1U,KAAK6D,MAAb6Q,IARO,EASa1U,KAAK0E,MAAzB3C,EATO,EASPA,KAAM8Z,EATC,EASDA,UACVpS,EAAO,IAAIyO,gBAAgB,CAC7BnW,KAAMA,EACN8Z,UAAWA,EAAY,IAAM,KAE/B3M,MAAM,GAAD,OAAItH,EAAJ,iBAAuB8M,EAAvB,YAAsC,CACzC0D,OAAQ,OACRjJ,QAAS,CACP,eAAgB,oCAChB,aAAcnP,KAAK6D,MAAMuL,OAE3BiJ,KAAM5O,IAELzH,KAAKJ,GACLI,MAAK,SAACqN,GACL,GAAkB,IAAdA,EAAK0H,KACP,MAAM,IAAInU,MAAMyM,EAAKN,KAGvB,IAAI6K,EAAmBnO,OAAOmO,iBACzBA,EAAiByC,SAAS3H,KAC7BkF,EAAiB0C,QAAQ5H,GACzBjJ,OAAOmO,iBAAmBA,EAC1BD,MAGF,EAAKtT,SAAS,CACZ1B,eAAgB,OAChB5C,KAAM,GACN6Z,SAAS,IAEX,EAAK3P,SAAS9G,QAAQ6G,QACtB,EAAKnI,MAAM0Y,iBAEZ9M,OAAM,SAACrN,GACNC,QAAQC,MAAMF,GACdiD,MAAM,6BAAWjD,GACjB,EAAKiE,SAAS,CACZ1B,eAAgB,eApG1B,uCA0GI3E,KAAKqG,SAAS,CACZuV,SAAU5b,KAAK0E,MAAMkX,YA3G3B,+BA+GY,IAAD,OACP,OACE,0BACEY,SAAUxc,KAAKoM,UAAUjG,KAAKnG,MAC9BgE,UAAW,kBAAoBhE,KAAK0E,MAAM3C,KAAO,gBAAkB,KAElE/B,KAAK0E,MAAMkX,QACV,yBAAK5X,UAAU,iBACb,kBAAC,GAAD,CACEjC,KAAM/B,KAAK0E,MAAM3C,KACjBgJ,aAAc/K,KAAK+K,aACnBV,SAAU,gBAId,kBAAC,GAAD,CACErF,IAAKhF,KAAKiM,SACVI,GAAIrM,KAAK6D,MAAM6Q,IACf7I,UAAW7L,KAAK4L,gBAChBQ,UAAWpM,KAAKoM,UAAUjG,KAAKnG,QAGnC,yBAAKgE,UAAU,sBACb,yBAAKA,UAAU,sBACb,4BACE2B,KAAK,SACLF,QAAS,WACP,EAAKgX,mBAGNzc,KAAK0E,MAAMkX,QACV,0BAAM5X,UAAU,0BAEhB,0BAAMA,UAAU,mBAGW,YAA9BhE,KAAK0E,MAAMC,eACV,4BAAQiB,SAAS,YACf,0BAAM5B,UAAU,uBAGlB,4BAAQ2B,KAAK,UACX,0BAAM3B,UAAU,qBAIrByH,OAAOkP,OACN,+BACE,2BACEhV,KAAK,WACL+G,SAAU1M,KAAK8b,0BACf/I,QAAS/S,KAAK0E,MAAMmX,YACnB,IALL,kCA9JZ,GAA+B/V,aA6KlB4W,GAAb,kDACE,WAAY7Y,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACX3C,KAAM,GACN4a,qBAAsB,GACtBC,YAAY,EACZC,UAAW,GACXC,UAAW,GACXjE,GAAIpN,OAAOsR,WAAa,GACxBC,aAAcvR,OAAOwR,YAAa,EAClCtY,eAAgB,OAChBiX,SAAS,EACTsB,WAAYzR,OAAO0R,YACnBC,aAAclb,KAAKC,MAAMsJ,OAAO0R,aAAe,QAC/CtB,WAAW,GAEb,EAAK5P,SAAWpH,IAAMC,YACtB,EAAK8G,gBAAkB,EAAKC,UAAU1F,KAAf,gBACvB,EAAKkX,6BAA+B,EAAKC,uBAAuBnX,KAA5B,gBACpC,EAAK2V,0BAA4B,EAAKC,oBAAoB5V,KAAzB,gBACjC,EAAKoX,mBAAqB,EAAKC,aAAarX,KAAlB,gBAC1B,EAAKsX,4BAA8B,EAAKC,sBAAsBvX,KAA3B,gBACnC,EAAK4E,aAAe,IAAIhL,EAtBP,EADrB,gEA2BQC,KAAKiM,SAAS9G,SAASnF,KAAKiM,SAAS9G,QAAQsH,UA3BrD,6CA8B0B,IAAD,EACgCzM,KAAK0E,MAAlDmU,EADa,EACbA,GAAImE,EADS,EACTA,aAAcE,EADL,EACKA,SAAUE,EADf,EACeA,aACpC3R,OAAOsR,UAAYlE,EACnBpN,OAAOwR,UAAYD,EACnBpN,aAAY,qBAA2BoN,EAAe,IAAM,GAC5DvR,OAAO0R,YAAcD,EAAWhb,KAAKqP,UAAU6L,GAAgB,OAnCnE,6CAsCyB9Q,GACrBtM,KAAKqG,SAAS,CACZ2W,aAAc1Q,EAAMhH,OAAOyN,YAxCjC,0CA4CsBzG,GAClBtM,KAAKqG,SAAS,CACZwV,UAAWvP,EAAMhH,OAAOyN,YA9C9B,mCAkDezG,GACXtM,KAAKqG,SAAS,CACZwS,GAAIvM,EAAMhH,OAAOF,UApDvB,gCAwDYA,GACRpF,KAAKqG,SAAS,CACZtE,KAAMqD,MA1DZ,gCA8Da,IAAD,SAQJpF,KAAK0E,MANPmU,EAFM,EAENA,GACA9W,EAHM,EAGNA,KACAib,EAJM,EAINA,aACAnB,EALM,EAKNA,UACAqB,EANM,EAMNA,SACAE,EAPM,EAONA,aAEE3T,EAAO,IAAIyO,gBAAgB,CAC7BW,GAAIA,EACJ9W,KAAMA,EACNib,aAAcA,EAAe,IAAM,GACnCnB,UAAWA,EAAY,IAAM,GAC7BlW,KAAM,SAEJuX,GACFE,EAAapc,SAAQ,SAAC2c,GAChBA,GAAKlU,EAAK0O,OAAO,eAAgBwF,MAIzCzO,MAAMxH,EAAW,UAAW,CAC1B0Q,OAAQ,OACRjJ,QAAS,CACP,eAAgB,oCAChB,aAAcnP,KAAK6D,MAAMuL,OAE3BiJ,KAAM5O,IAELzH,KAAKJ,GACLI,MAAK,SAACqN,GACL,GAAkB,IAAdA,EAAK0H,KACP,MAAM,IAAInU,MAAMyM,EAAKN,KAGvB,EAAK1I,SAAS,CACZ1B,eAAgB,OAChB5C,KAAM,GACN6Z,SAAS,IAEX,EAAK3P,SAAS9G,QAAQ6G,QACtB,EAAKnI,MAAM0Y,cACX9Q,OAAOsR,UAAY,GACnBtR,OAAO0R,YAAc,QAEtB1N,OAAM,SAACrN,GACNC,QAAQC,MAAMF,GACdiD,MAAM,6BAAWjD,GACjB,EAAKiE,SAAS,CACZ1B,eAAgB,cAhH1B,gCAqHY2H,GACJA,GAAOA,EAAMrH,iBACiB,YAA9BjF,KAAK0E,MAAMC,gBACV3E,KAAK0E,MAAM3C,OAEd/B,KAAKqG,SAAS,CACZ1B,eAAgB,YAElB3E,KAAK4d,aA7HX,uCAkII5d,KAAKqG,SAAS,CACZuV,SAAU5b,KAAK0E,MAAMkX,YAnI3B,4CAuIwBtP,EAAOnC,GAC3B,IAAIiT,EAAepd,KAAK0E,MAAM0Y,aAC1Brb,EAAOuK,EAAMhH,OAAOF,MACxBgY,EAAajT,GAAOpI,GACfA,GAAQqb,EAAaza,OAAS,GACjCya,EAAaS,OAAO1T,EAAK,GAEvBiT,EAAaA,EAAaza,OAAS,IAAMya,EAAaza,OAAS,GACjEya,EAAavT,KAAK,IAEpB7J,KAAKqG,SAAS,CAAE+W,aAAcA,MAjJlC,qCAoJiB9Q,GACbjK,QAAQG,IAAI8J,GACZ,IAAIwR,EAAIxR,EAAMhH,OAAOyY,MAAM,GAC3B,GAAID,EAAG,CACLzb,QAAQG,IAAIsb,GACZ9d,KAAKqG,SAAS,CAAEuW,YAAY,EAAMC,UAAWiB,EAAEzd,KAAMyc,UAAWgB,EAAEnY,OAIlE,IAAIqY,EAAK,IAAIC,eACbD,EAAGE,OAAO5Q,iBACR,WACAtN,KAAKme,gBAAgBhY,KAAKnG,OAC1B,GAEFge,EAAG1Q,iBAAiB,OAAQtN,KAAKoe,gBAAgBjY,KAAKnG,OAAO,GAC7Dge,EAAG1Q,iBAAiB,QAAStN,KAAKqe,aAAalY,KAAKnG,OAAO,GAC3Dge,EAAG1Q,iBAAiB,QAAStN,KAAKse,aAAanY,KAAKnG,OAAO,GAC3Dge,EAAGjK,KAAK,OAAQnM,EAAa,WAC7BoW,EAAGO,iBAAiB,aAAcve,KAAK6D,MAAMuL,OAC7C4O,EAAGQ,KAAKV,MAxKd,+CA4K2BrU,GAAO,IAAD,EACIzJ,KAAK0E,MAA9BmY,EADqB,EACrBA,UAAWC,EADU,EACVA,UACf5U,EAAG,UAAML,GAAN,YAAsB4B,EAAKgV,KAA3B,qBAA4CtF,mBACjD0D,GADK,qBAEO1D,mBAAmB2D,IAC7B4B,EACF1e,KAAK0E,MAAM3C,KACX,MACC+a,EAAU3T,WAAW,UAArB,cAAwCjB,EAAxC,KAAiDA,GACpDlI,KAAKqG,SAAS,CAAEtE,KAAM2c,IACtB1e,KAAKiM,SAAS9G,QAAQwZ,IAAID,KAtL9B,sCAyLkBpS,GACdjK,QAAQG,IAAI8J,EAAMsS,OAAQtS,EAAMuS,OAChC7e,KAAKqG,SAAS,CACZsW,qBAAqB,GAAD,QAAsB,IAAfrQ,EAAMsS,OAAgBtS,EAAMuS,OAAOC,QAC5D,GADkB,SA5L1B,sCAkMkBxS,GACd,IACE,IAAIyO,EAAI7Y,KAAKC,MAAMmK,EAAMhH,OAAOyZ,cAChC,GAAc,GAAVhE,EAAEhE,KAEJ,MADA1R,MAAM0V,EAAEhM,KACF,IAAInM,MAEZ5C,KAAKgf,yBAAyBjE,EAAEtR,MAChCzJ,KAAKqG,SAAS,CAAEuW,YAAY,IAC5B,MAAOxa,GACPC,QAAQG,IAAIJ,GACZpC,KAAKqe,aAAa/R,MA7MxB,mCAiNeA,GACXjH,MACE,8BACGiH,EAAMhH,OAAOyZ,aAAapc,OAAS,IAChC2J,EAAMhH,OAAOyZ,aACbzS,EAAMhH,OAAOzC,SAErB7C,KAAKqG,SAAS,CAAEuW,YAAY,MAxNhC,mCA2NetQ,GACXjH,MAAM,kCACNrF,KAAKqG,SAAS,CAAEuW,YAAY,MA7NhC,+BAgOY,IAAD,SASH5c,KAAK0E,MAPPwY,EAFK,EAELA,SACAE,EAHK,EAGLA,aACAxB,EAJK,EAILA,QACAjX,EALK,EAKLA,eACAgY,EANK,EAMLA,qBACAC,EAPK,EAOLA,WACAC,EARK,EAQLA,UAEF,OACE,0BAAML,SAAUxc,KAAKoM,UAAUjG,KAAKnG,MAAOgE,UAAU,iBACnD,yBAAKA,UAAU,iBACb,6BACG4X,EACC,4BACEjW,KAAK,SACLF,QAAS,WACP,EAAKgX,mBAGP,0BAAMzY,UAAU,0BANlB,oBAUA,4BACE2B,KAAK,SACLF,QAAS,WACP,EAAKgX,mBAGP,0BAAMzY,UAAU,kBANlB,oBAWkB,SAAnBW,EACC,4BAAQiB,SAAS,YACf,0BAAM5B,UAAU,sBADlB,oBAKA,4BAAQ2B,KAAK,UACX,0BAAM3B,UAAU,mBADlB,qBAMJ,yBAAKA,UAAU,gBACb,+BACE,2BACE2B,KAAK,WACL+G,SAAU1M,KAAKqd,6BACftK,QAAS/S,KAAK0E,MAAMsY,eACnB,IALL,4BAQCvR,OAAOkP,OACN,+BACE,2BACEhV,KAAK,WACL+G,SAAU1M,KAAK8b,0BACf/I,QAAS/S,KAAK0E,MAAMmX,YACnB,IALL,8BAWLD,EACC,yBAAK5X,UAAU,gBACb,kBAAC,GAAD,CACEjC,KAAM/B,KAAK0E,MAAM3C,KACjBgJ,aAAc/K,KAAK+K,aACnBV,SAAU,gBAId,oCACE,8EACA,2BACErG,UAAU,aACV2B,KAAK,OACLtF,KAAK,OACLqM,SAAU1M,KAAKif,eAAe9Y,KAAKnG,MACnC4F,SAAUgX,IAEXA,GACC,2BACE,+CACK,2BAAIC,GADT,YAC4BF,IAIhC,2BACEhX,KAAK,OACLH,YAAY,uEACZJ,MAAOpF,KAAK0E,MAAMmU,GAClBxM,GAAG,UACHrI,UAAU,gBACV0I,SAAU1M,KAAKud,mBACf3Q,UAAU,OAEZ,kBAAC,GAAD,CACE5H,IAAKhF,KAAKiM,SACVI,GAAG,WACHR,UAAW7L,KAAK4L,gBAChBQ,UAAWpM,KAAKoM,UAAUjG,KAAKnG,SAIrC,4BACE2F,KAAK,SACLF,QAAS,WACP,EAAKY,SAAS,CAAE6W,UAAWA,MAG5BA,EAAW,eAAO,eANrB,gBASCA,GACC,yBAAKlZ,UAAU,0BACb,wDACCoZ,EAAa/b,KAAI,SAAC6d,EAAQ/U,GAAT,OAChB,2BACEpB,IAAKoB,EACLxE,KAAK,OACLP,MAAO8Z,EACP1Z,YAAY,gDACZkH,SAAU,SAACtK,GAAD,OAAO,EAAKqb,4BAA4Brb,EAAG+H,IACrDyC,UAAU,WAKlB,6BACA,6BACA,6BACA,2BACE,oDAEE,uBAAG1H,KAAK,eAAeI,OAAO,UAA9B,gEAFF,yCAQF,2BACE,mMApXV,GAA8BQ,a,SClexBqZ,GAAiB,CAAEtI,GAAG,EAAMuI,OAAO,GAGnCC,GAAkB,GAExB5T,OAAO6T,eAAiBnK,SAASvF,aAAY,gBAAqB,KAAO,EAIzE,SAAS2P,GAAYlI,GACnB,OACI5L,OAAOuF,OAAON,WAAa2G,EAAK/W,QAChCmL,OAAOuF,OAAOJ,eAAe4O,MAAK,SAACC,GAAD,OAAUpI,EAAKtV,KAAKsa,SAASoD,OAC9DpI,EAAKwB,IACJpN,OAAOuF,OAAOJ,eACXzP,OAAOsK,OAAOuF,OAAOL,UACrB6O,MAAK,SAACC,GAAD,OAAUpI,EAAKwB,GAAGwD,SAASoD,SACtCpI,EAAKqI,QAIV,SAASC,GAAiBxF,EAAc/K,GACtC,8CAAO,WAAOsF,GAAP,qCAAAmC,EAAA,6DAAY9M,EAAZ,gCACDgB,EAAe,IAAIhL,EAEvBoa,EADIyF,EAAa,iBAASlL,EAGxB,yBAAK1Q,UAAU,eAAf,6BAAoC0Q,GACpC3K,EAAU,UAAY,QANnB,kBASgB4N,GAAIyB,WAAW1E,EAAKtF,GATpC,cASCyQ,EATD,QAUIpW,KAAKiO,QAAU,GAVnB,UAW2BC,GAAIG,wBAChCpD,EACAtF,EACArE,EACAoK,SAAS0K,EAAOpW,KAAKqW,QAfpB,iBAWS7I,EAXT,EAWGxN,KAMN0Q,EACEyF,EACA,kBAAC,GAAD,CACE7W,KAAM,IAAIjF,KACVuT,KAAMwI,EAAOpW,KACbwN,QAASA,EAAQxN,KACjBwO,UAAWhB,EAAQgB,UACnB7I,MAAOA,EACP+K,aAAcA,EACdpP,aAAcA,EACdgV,gBAAqD,OAApCnQ,aAAY,kBAE/B,WA7BC,kDAgCHvN,QAAQC,MAAR,MACA6X,EACEyF,EACA,yBAAK5b,UAAU,eACb,2BACE,uBAAGyB,QAAS,kBAAMka,GAAiBxF,EAAc/K,EAA/BuQ,CAAsCjL,GAAK,KAA7D,6BAIF,2BAAI,UAEN,WA3CC,0DAAP,sD,IAiDIsL,G,kDACJ,WAAYnc,GAAQ,uCACZA,G,qDAGE,IAAD,EAUH7D,KAAK6D,MARPwT,EAFK,EAELA,KACAtM,EAHK,EAGLA,aACAV,EAJK,EAILA,SACA4V,EALK,EAKLA,eACAC,EANK,EAMLA,UACAC,EAPK,EAOLA,UACAC,EARK,EAQLA,SACA1W,EATK,EASLA,aAEI2W,EAAShJ,EAAKhX,KAClBigB,EAAYjJ,EAAKtV,KACjBwe,EAAkBhB,GAAYlI,GAEhC,OADArX,KAAK+K,aAAe,IAAIhL,EAEtB,yBACEiE,UAAW,iBACX+D,MACEsP,EAAKI,eACD,CACE,sBAAuBJ,EAAKI,eAAe,GAC3C,qBAAsBJ,EAAKI,eAAe,IAE5C,MAGN,yBAAKzT,UAAU,gBACVic,GACD,0BACEjc,UAAU,+BACVyB,QAAS,WACPwa,EAAe5I,EAAKhX,QAGtB,0BAAM2D,UAAU,sBARtB,OAYG,0BAAMA,UAAU,mBAAmBqT,EAAKhX,MACxCgX,EAAKmJ,cACJ,0BAAMxc,UAAU,gCAAhB,WAAoDqT,EAAKmJ,aAAzD,MAEDnJ,EAAK/W,QACJ,0BAAM0D,UAAU,6BAAhB,8BAECkc,KAAe7I,EAAKqI,SACrB,0BACE1b,UAAU,YACVyB,QAAS,WACPya,EAAU,MAAO7I,EAAKD,OAGvB,IANH,qBAOM,OAGLgJ,GACD,0BAAMpc,UAAU,YAAYyB,QAAS2a,GAClC,IADH,eAEK,OAGJD,GACD,2CAEE,0BAAMnc,UAAU,YAAYyB,QAAS0a,GACnC,0BAAMnc,UAAU,oBAHpB,QAQDqT,EAAKoJ,gBACJ,0BAAMzc,UAAU,eAAhB,IAAgCqT,EAAKoJ,eAArC,KAEDpJ,EAAKqJ,eACJ,0BAAM1c,UAAU,eAAhB,IAAgCqT,EAAKqJ,cAArC,KAEF,kBAAC9c,EAAD,CAAMG,MAAOsT,EAAKrH,UAAWzL,OAAQ4b,IAnDvC,OAqDGI,GAAmB,0BAAMvc,UAAU,oBAAhB,wBAEpBuc,GACA,yBAAKvc,UAAU,eACb,kBAAC,GAAD,CACEqc,OAAQA,EACRte,KAAMue,EACNvV,aAAcA,EACdV,SAAUA,EACVX,aAAcA,U,GA9FRmF,iBAuGd8R,G,kDACJ,WAAY9c,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACXmU,GAAIhV,EAAMwT,KAAKwB,IAAM,IAHN,E,sDAOTvM,GACRA,EAAMrH,iBACNgW,IACE,UAAG3O,EAAMhH,OAAOJ,MAAhB,OACElF,KAAK6D,MAAMwT,KAAKwB,GAAK,UAAO7Y,KAAK6D,MAAMwT,KAAKwB,GAAK,SAAM,GADzD,eAEO7Y,KAAK6D,MAAMwT,KAAKtV,KAFvB,sBAGMmB,EAAY,IAAIY,KAAiC,IAA5B9D,KAAK6D,MAAMwT,KAAKrH,YAH3C,YAIIhQ,KAAK6D,MAAMwT,KAAKuJ,QAJpB,wBAKQ5gB,KAAK6D,MAAMwT,KAAKyI,MALxB,0BAME9f,KAAK6D,MAAMoT,QAAQ5V,KAAI,SAACkW,GAAD,sBAAWA,EAAElX,KAAb,mBAAuBkX,EAAExV,KAAzB,SAAmCiI,KAAK,S,mCAIxDsC,GACXtM,KAAKqG,SAAS,CACZwS,GAAIvM,EAAMhH,OAAOF,U,+BAIX,IAAD,EAeHpF,KAAK6D,MAbPwT,EAFK,EAELA,KACAwJ,EAHK,EAGLA,SACA9I,EAJK,EAILA,OACAE,EALK,EAKLA,UACAgI,EANK,EAMLA,eACAC,EAPK,EAOLA,UACAY,EARK,EAQLA,WACAC,EATK,EASLA,cACAhW,EAVK,EAULA,aACAV,EAXK,EAWLA,SACA2W,EAZK,EAYLA,QACAZ,EAbK,EAaLA,SACA1W,EAdK,EAcLA,aAEMmP,EAAO7Y,KAAK0E,MAAZmU,GACFpB,EAAiB1M,EAAaL,IAnNxB,eAmNqC2M,EAAK/W,QACtD,OACE,yBAAK0D,UAAW,aAAe6c,EAAW,mBAAqB,OAC1DA,GACD,yBAAK7c,UAAU,2BACb,6BACE,0BAAMA,UAAU,sBAOtB,yBACEA,UAAU,MACV+D,MAAO,CACL,sBAAuB0P,EAAe,GACtC,qBAAsBA,EAAe,OAGpChM,OAAO6T,gBACRnK,SAASkC,EAAK3C,IAAK,IAAMjJ,OAAO6T,gBAC9B,yBAAKtb,UAAU,oBAEhBiU,IAAcF,GAAU,yBAAK/T,UAAU,kBAC1C,yBAAKA,UAAU,gBACVic,GACD,0BACEjc,UAAU,+BACVyB,QAAS,WACPwa,EAjPF,kBAoPA,0BAAMjc,UAAU,wBAGjBmR,SAASkC,EAAKuJ,QAAS,KACxB,0BAAM5c,UAAU,oBACbqT,EAAKuJ,QADR,OAEE,0BACE5c,UAAW,cAAgBiU,EAAY,UAAY,aAItD9C,SAASkC,EAAKyI,MAAO,KACtB,0BAAM9b,UAAU,oBACbqT,EAAKyI,MADR,OAEE,0BAAM9b,UAAU,qBAGpB,0BAAMA,UAAU,UACd,uBAAGkB,KAAM,KAAOmS,EAAK3C,IAAKjP,QAASzF,KAAKihB,UAAU9a,KAAKnG,OAAvD,IACIqX,EAAK3C,MA3Bb,OA+BG2C,EAAKmJ,cACJ,0BAAMxc,UAAU,gCAAhB,WAAoDqT,EAAKmJ,aAAzD,MAEDnJ,EAAK/W,QACJ,0BAAM0D,UAAU,6BAAhB,4BAEDqT,EAAK6J,aAAe,0BAAMld,UAAU,eAAhB,SAClBkc,KAAe7I,EAAKqI,SACrB,0BACE1b,UAAU,YACVyB,QAAS,WACPya,EAAU,MAAO7I,EAAK3C,OAGvB,IANH,qBAOM,OAGL0L,GACD,0BAAMpc,UAAU,YAAYyB,QAAS2a,GAClC,IADH,eAEK,KAGN/I,EAAKoJ,gBACJ,0BAAMzc,UAAU,eAAhB,IAAgCqT,EAAKoJ,eAArC,KAEDpJ,EAAKqJ,eACJ,0BAAM1c,UAAU,eAAhB,IAAgCqT,EAAKqJ,cAArC,KAEW,OAAZrJ,EAAKwB,MAAiBiI,IAAezJ,EAAKqI,UACzC,0BAAM1b,UAAU,iBAAiBqT,EAAKwB,MAErCiI,KAAgBzJ,EAAKqI,SACtB,yBAAK1b,UAAU,gCACb,2BACE2B,KAAK,OACLP,MAAOyT,EACPjM,UAAU,KACVpH,YAAY,uCACZkH,SAAU1M,KAAKwd,aAAarX,KAAKnG,QAEnC,4BAAQ2F,KAAK,SAASF,QAAS,SAACrD,GAAD,OAAO0e,EAAWjI,EAAIxB,EAAK3C,OAA1D,iBAKH2C,EAAK2F,cAAgB,gDACtB,kBAACpZ,EAAD,CAAMG,MAAOsT,EAAKrH,UAAWzL,OAAQwc,OAEpC1J,EAAK8J,WACN,0BAAMnd,UAAU,cAAhB,cAAyCqT,EAAK8J,WAEhD,yBAAKnd,UAAU,eACb,kBAAC,GAAD,CACEjC,KAAMsV,EAAKtV,KACXgJ,aAAcA,EACdV,SAAUA,EACVX,aAAcA,KAGjB2N,EAAK+J,MACJ,yBAAKpd,UAAYgd,EAAgC,WAAtB,qBACzB,kBAAC,KAAD,CACEjY,IAAKsO,EAAK+J,KAAK7H,MAAQ,IACvB8H,SAAU,GACVC,QAASjK,EAAK+J,KAAKE,QACnBC,OAAQP,GAAY,aACpBQ,aAAc,CAAEC,MAAO,QACvBC,WAAW,EACXnI,KAAM3J,aAAa,eAAiByH,EAAK3C,MAAQ2C,EAAK+J,KAAK7H,WAI7DtB,IAAaZ,EAAKK,QAAQiK,eAC5B,uBAAG3d,UAAU,cAAb,4BACO,kBAACJ,EAAD,CAAMG,MAAOsT,EAAKK,QAAQiK,aAAcpd,OAAO,W,GAhL3CsK,iBAyLjB+S,G,kDACJ,WAAY/d,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACXuT,UAAWpU,EAAMoU,UACjBZ,KAAMxT,EAAMwT,KACZJ,QAASpT,EAAMoT,QACftS,eAAgB,OAChBkd,UAAW,KACXC,YAAa,KACbC,KAAK,GAEP,EAAKhX,aAAelH,EAAMkH,aAC1B,EAAKiX,UAAYne,EAAMoe,YAAe,aACtC,EAAKC,UAAYrd,IAAMC,YAbN,E,wDAgBPsS,EAAKM,GACf1X,KAAKqG,UACH,SAAC8b,GACC,OAAI/K,EACK,CACLH,QAASkL,EAAKlL,QAAQ5V,KAAI,SAACye,GACzB,OAAIA,EAAM1I,MAAQA,EACTnG,OAAOC,OAAO,GAAI4O,EAAO,CAC9BpI,QAASzG,OAAOC,OAAO,GAAI4O,EAAMpI,QAASA,KAElCoI,MAIT,CACLzI,KAAMpG,OAAOC,OAAO,GAAIiR,EAAK9K,KAAM,CACjCK,QAASzG,OAAOC,OAAO,GAAIiR,EAAK9K,KAAKK,QAASA,SAItD,WACE1X,KAAKgiB,UAAU,CACb3K,KAAMrX,KAAK0E,MAAM2S,KACjBJ,QAASjX,KAAK0E,MAAMuS,e,qCAMO,IAAD,OAArBmL,IAAqB,yDAChCpiB,KAAKqG,SAAS,CACZ1B,eAAgB,UAChBkd,UAAW,OAEblK,GAAIC,aACF5X,KAAK0E,MAAM2S,KAAK3C,IAChB1U,KAAK6D,MAAMuL,MACXpP,KAAK+K,aACL,MAEC/I,MAAK,SAACqN,GACL,EAAKhJ,UACH,SAAC8b,EAAMte,GAAP,MAAkB,CAChBoT,QAAS5H,EAAK5F,KACd4N,KAAM+K,EACFnR,OAAOC,OAAO,GAAIiR,EAAK9K,KAAM,CAC3ByI,MAAO,GAAKzQ,EAAK5F,KAAK9G,OACtBie,QAAS,GAAKvR,EAAKuR,UAErBuB,EAAK9K,KACTY,YAAa5I,EAAK4I,UAClBtT,eAAgB,OAChBkd,UAAW,SAEb,WACE,EAAKG,UAAU,CACb/K,QAAS,EAAKvS,MAAMuS,QACpBgB,UAAW,EAAKvT,MAAMuT,UACtBZ,KAAM,EAAK3S,MAAM2S,OAEf,EAAK3S,MAAMuS,QAAQtU,QACrB,EAAK0f,YAAY,KAAM,CACrBV,aAAcxhB,KAAKob,IAAIna,MACrB,KACA,EAAKsD,MAAMuS,QAAQ5V,KAAI,SAACkW,GAAD,OAAOpC,SAASoC,EAAEvH,uBAMpDP,OAAM,SAACrN,GACNC,QAAQC,MAAMF,GACd,EAAKiE,SAAS,CACZ4Q,QAAS,GACTtS,eAAgB,OAChBkd,UAAW,GAAKzf,S,yCAKJ,IAAD,OACXkgB,EAAYtiB,KAAK0E,MAAM2S,KACvB3C,EAAM4N,EAAU5N,IACtBiD,GAAIK,cAActD,GAAM1U,KAAK0E,MAAMuT,UAAWjY,KAAK6D,MAAMuL,OACtDpN,MAAK,SAACqN,GACL,EAAKhJ,SAAS,CACZ4R,UAAW5I,EAAK4I,UAChBZ,KAAMpG,OAAOC,OAAO,GAAIoR,EAAW,CACjC1B,QAAS,GAAKvR,EAAKuR,YAIvB,IAAIhH,EAAmBnO,OAAOmO,iBAC9B,GAAIvK,EAAK4I,YAAc2B,EAAiByC,SAAS3H,GAC/CkF,EAAiB0C,QAAQ5H,QACpB,IAAKrF,EAAK4I,WAAa2B,EAAiByC,SAAS3H,GAAM,CAC5D,IAAMvK,EAAMyP,EAAiBzH,QAAQuC,GACrCkF,EAAiBiE,OAAO1T,EAAK,GAE/BsB,OAAOmO,iBAAmBA,EAC1BD,KAEA,EAAKqI,UAAU,CACb/J,UAAW5I,EAAK4I,UAChBZ,KAAMpG,OAAOC,OAAO,GAAIoR,EAAW,CACjC1B,QAAS,GAAKvR,EAAKuR,eAIxBnR,OAAM,SAACrN,GACN,EAAKiE,SAAS,CACZ1B,eAAgB,SAElBU,MAAM,yCAAajD,GACnBC,QAAQC,MAAMF,Q,8BAIZmX,GAAO,IAAD,OACZvZ,KAAKqG,SAAS,CACZ1B,eAAgB,UAChBkd,UAAW,OAEblK,GAAI2B,SAASC,EAAMvZ,KAAK0E,MAAM2S,KAAK3C,IAAK1U,KAAK6D,MAAMuL,OAChDpN,MAAK,SAACqN,GACa,IAAdA,EAAK0H,OACTnH,aAAa,eAAiB,EAAKlL,MAAM2S,KAAK3C,KAAO6E,EACrD,EAAKlT,UACH,SAAC8b,EAAMte,GAAP,MAAkB,CAChBwT,KAAMpG,OAAOC,OAAO,GAAIiR,EAAK9K,KAAM,CAAE+J,KAAM/R,EAAK5F,OAChD9E,eAAgB,WAElB,WACE,EAAKqd,UAAU,CACb3K,KAAM,EAAK3S,MAAM2S,cAKxB5H,OAAM,SAACrN,GACNC,QAAQC,MAAMF,GACd,EAAKiE,SAAS,CACZ1B,eAAgB,OAChBkd,UAAW,GAAKzf,S,6BAKjBkK,GAAmB,IAAZvK,EAAW,uDAAJ,GACnBM,QAAQG,IAAIT,GACZ,IAAIwW,EAASlL,OAAO,iBAAD,OAAQrN,KAAK0E,MAAM2S,KAAK3C,IAAxB,6BAAoC3S,GACnDyW,EAAcrF,QAAQ,8FACX,OAAXoF,GACFZ,GAAIW,OAAOtY,KAAK0E,MAAM2S,KAAK3C,IAAK6D,EAAQC,EAAaxY,KAAK6D,MAAMuL,OAC7DpN,MAAK,SAACqN,GACLhK,MAAM,+BAEPoK,OAAM,SAACrN,GACNiD,MAAM,6BAAWjD,GACjBC,QAAQC,MAAMF,Q,4BAKhB/B,EAAMsF,EAAM0G,EAAIkQ,GAChBpJ,QAAQ,2BAAD,OAAQ9S,EAAR,4GACTsX,GAAIc,MAAM9S,EAAM0G,EAAIrM,KAAK6D,MAAMuL,OAC5BpN,MAAK,SAACqN,GACL,IAAI5F,EAAO4F,EAAK5F,KAChBpE,MAAM,gEAAD,OAAeoE,EAAK8Y,OACvBhG,GAAeA,OAElB9M,OAAM,SAACrN,GACNiD,MAAM,6BAAWjD,GACjBC,QAAQC,MAAMF,Q,sCAKN/B,GACdL,KAAKqG,UAAS,SAACmc,GAAD,MAAgB,CAC5BV,YAAazhB,IAASmiB,EAAUV,YAAc,KAAOzhB,Q,mCAKvDL,KAAKqG,UAAS,SAACmc,GAAD,MAAgB,CAAET,KAAMS,EAAUT,OAAQU,iB,qCAG3CpiB,EAAMiM,GACnB,GAAItM,KAAKkiB,UAAU/c,UAAYmH,EAAMhH,OAAOod,QAAQ,iBAAkB,CACpE,IAAI3gB,EAAO/B,KAAKkiB,UAAU/c,QAAQuF,MAClC,GACE,uFAA6EhJ,KAC3EK,GAEF,CAEA,IAAI4gB,EAAc,MAAQtiB,EAAO,KAC7BsiB,IAAgB3iB,KAAKkiB,UAAU/c,QAAQuF,MACzC1K,KAAKkiB,UAAU/c,QAAQwZ,IAAI,IACxB3e,KAAKkiB,UAAU/c,QAAQwZ,IAAIgE,O,qCAKvBvT,GAA4B,IAArBmN,EAAoB,uDAAN,KAC5B2D,EAAY,SAACva,EAAM0G,GACvB,IAAIsM,EAAOtL,OAAO,qBAAD,OAAO1H,EAAP,YAAe0G,EAAf,wBAA0B,YAC9B,OAATsM,GACFhB,GAAIe,IAAI/S,EAAM0G,EAAIsM,EAAMvJ,GACrBpN,MAAK,SAACqN,GACLhK,MAAM,4BACNkX,OAED9M,OAAM,SAACrN,GACNiD,MAAM,6BAAWjD,GACjBC,QAAQC,MAAMF,OAItB,OAAO8d,I,iCAGErH,EAAIxM,GAAK,IAAD,OACjBsL,GAAIiB,UAAUC,EAAIxM,EAAIrM,KAAK6D,MAAMuL,OAC9BpN,MAAK,SAACqN,GACL,EAAKhJ,SACH,CACEgR,KAAMpG,OAAOC,OAAO,GAAI,EAAKxM,MAAM2S,KAAM,CAAEwB,GAAIA,MAEjD,WACE,EAAKmJ,UAAU,CACb3K,KAAM,EAAK3S,MAAM2S,UAIvBhS,MAAM,yBAEPoK,OAAM,SAACrN,GACNiD,MAAM,6BAAWjD,GACjBC,QAAQC,MAAMF,Q,+BAIV,IAAD,OACP,GAAkC,YAA9BpC,KAAK0E,MAAMC,eACb,OAAO,uBAAGX,UAAU,eAAb,kCAET,IAAIqG,EAAWsV,GAAiB3f,KAAK6D,MAAMsW,aAAcna,KAAK6D,MAAMuL,OAEhEwT,EAAkB5iB,KAAK0E,MAAMod,YAC7B9hB,KAAK0E,MAAMuS,QAAQtV,QAAO,SAAC4V,GAAD,OAAOA,EAAElX,OAAS,EAAKqE,MAAMod,eACvD9hB,KAAK0E,MAAMuS,QAAQ4L,QACnB7iB,KAAK0E,MAAMqd,KAAKa,EAAgBE,UAOpC,IAAIC,EAAW,eAtnBH,eAsnBmB,GAC/BH,EAAgB5hB,SAAQ,SAACuW,QACKnG,IAAxB2R,EAAYxL,EAAElX,QAAqB0iB,EAAYxL,EAAElX,MAAQ,GAC7D0iB,EAAYxL,EAAElX,WAIhB,IAAI2iB,EACFhjB,KAAK0E,MAAMod,aA9nBD,iBA8nBgB9hB,KAAK0E,MAAMod,YAA0B,KAC7D,kBAAC,GAAD,CACEtT,SAAU,SAACpM,GACT,EAAK6gB,eAAe,GAAI7gB,KAG1B,kBAAC,GAAD,CACEiV,KAAMrX,KAAK0E,MAAM2S,KACjBY,UAAWjY,KAAK0E,MAAMuT,UACtB8I,eAAe,EACfhW,aAAc/K,KAAK+K,aACnBV,SAAUA,EACVX,aAAc1J,KAAK6D,MAAM6F,aACzBuN,QAASjX,KAAK0E,MAAMuS,QACpBoL,YAAa,SAAC3K,GACZ,EAAK2K,YAAY,KAAM3K,IAEzBuI,eACE8C,EAhpBE,gBAgpBqB,EAAI/iB,KAAKkjB,gBAAgB/c,KAAKnG,MAAQ,KAE/DkgB,UAAWlgB,KAAKmjB,eAAenjB,KAAK6D,MAAMuL,OAAO,WAC/C3D,OAAOoE,SAASC,YAElBgR,WAAY9gB,KAAK8gB,WAAW3a,KAAKnG,MACjCghB,QAAShhB,KAAKghB,QAAQ7a,KAAKnG,MAC3BogB,SAAU,WACR,EAAK3H,MAAM,eAAM,OAAQ,EAAK/T,MAAM2S,KAAK3C,KAAK,WAC5CjJ,OAAOoE,SAASC,gBAO5B,OACE,yBAAK9L,UAAU,mCACb,yBAAKA,UAAU,iBACVhE,KAAK6D,MAAMuL,OACZ,8BACE,uBAAG3J,QAASzF,KAAKsY,OAAOnS,KAAKnG,OAC3B,0BAAMgE,UAAU,mBAChB,gDAHJ,YAQF,uBAAGyB,QAASzF,KAAK4X,aAAazR,KAAKnG,OACjC,0BAAMgE,UAAU,sBAChB,iDAEAhE,KAAK0E,MAAMuS,QAAQtU,QAAU,GAAK3C,KAAK0E,MAAMqd,MAC7C,yCAEE,uBAAGtc,QAASzF,KAAKojB,WAAWjd,KAAKnG,OAC/B,0BAAMgE,UAAU,wBAChB,+BAAQhE,KAAK0E,MAAMqd,IAAM,eAAO,oBAInC/hB,KAAK6D,MAAMuL,OACZ,yCAEE,uBACE3J,QAAS,WACP,EAAK4d,qBAGNrjB,KAAK0E,MAAMuT,UACV,8BACE,0BAAMjU,UAAU,sBAChB,sDAGF,8BACE,0BAAMA,UAAU,mBAChB,2DAOThE,KAAK0E,MAAMod,aACZ,yBAAK9d,UAAU,yCACb,2BACE,0BAAM+D,MAAO,CAAEub,MAAO,SACpB,uBACE7d,QAAS,WACP,EAAKyd,gBAAgB,QAFzB,iBAQF,0BAAMlf,UAAU,qBAVlB,mCAYE,kBAAC8D,GAAD,CACEE,OAAQhI,KAAK+K,aAAaL,IAAI1K,KAAK0E,MAAMod,cAExC9hB,KAAK0E,MAAMod,gBAKlB9hB,KAAK0E,MAAMqd,KAAOiB,IACjBhjB,KAAK0E,MAAMmd,WACZ,yBAAK7d,UAAU,yBACb,uDACA,2BAAIhE,KAAK0E,MAAMmd,YAGlB7hB,KAAK6D,MAAMkc,iBACV5K,SAASnV,KAAK0E,MAAM2S,KAAKyI,OAAS9f,KAAK0E,MAAMuS,QAAQtU,UACnD3C,KAAK0E,MAAMuS,QAAQtU,QACnB,yBAAKqB,UAAU,oCACZmR,SAASnV,KAAK0E,MAAM2S,KAAKyI,OAAS9f,KAAK0E,MAAMuS,QAAQtU,OAAQ,IADhE,wCAKHigB,EAAgBvhB,KACf,SAACye,EAAOlL,GAAR,OACGkL,EAAMJ,UAAYI,EAAMyD,aACvB,kBAAC,KAAD,CACExa,IAAK6L,EACL4O,OAAQ,KACRC,OAAO,MACPC,UAAU,EACVC,MAAM,GAEN,kBAAC,GAAD,CACEnV,SAAU,SAACpM,GACT,EAAK6gB,eAAenD,EAAMzf,KAAM+B,KAGlC,kBAAC,GAAD,CACEiV,KAAMyI,EACN/U,aAAc,EAAKA,aACnBV,SAAUA,EACVX,aAAc,EAAK7F,MAAM6F,aACzB2Y,YAAa,SAAC3K,GACZ,EAAK2K,YAAYvC,EAAM1I,IAAKM,IAE9BuI,eACE8C,EAAYjD,EAAMzf,MAAQ,EACtB,EAAK6iB,gBAAgB/c,KAAK,GAC1B,KAEN+Z,UAAW,EAAKiD,eACd,EAAKtf,MAAMuL,MACX,EAAKwI,aAAazR,KAAK,IAEzBia,SAAU,WACR,EAAK3H,MACHqH,EAAMzf,KACN,UACAyf,EAAM1I,IACN,EAAKQ,aAAazR,KAAK,KAG3Bga,UAAW,SAAC/d,GACV,EAAKkW,OACHlW,EADF,4BAEQ0d,EAAMzf,KAFd,gCAE2Byf,EAAM1I,cAQ9CpX,KAAK0E,MAAMqd,KAAOiB,EAClBhjB,KAAK6D,MAAMuL,MACV,kBAAC,GAAD,CACEsF,IAAK1U,KAAK0E,MAAM2S,KAAK3C,IACrBtF,MAAOpP,KAAK6D,MAAMuL,MAClBnD,SAAUjM,KAAKkiB,UACf3F,YAAavc,KAAK4X,aAAazR,KAAKnG,QAGtC,yBAAKgE,UAAU,yBAAf,+D,GAjdgB6K,iBAwdpB+U,G,kDACJ,WAAY/f,GAAQ,IAAD,8BACjB,cAAMA,IACDggB,SACHhgB,EAAMwT,KAAKwB,KACiC,GAA5CpN,OAAOuF,OAAOH,aAAasB,QAAQ,OACmB,GAAtD1G,OAAOuF,OAAOH,aAAasB,QAAQtO,EAAMwT,KAAKwB,KAC/B,SAAfhV,EAAMigB,KACR,EAAKvD,gBAAkBhB,GAAY1b,EAAMwT,MACzC,EAAKtM,aAAe,IAAIhL,EACxB,EAAK2E,MAAQ,CACXuS,QAASpT,EAAMwT,KAAK0M,SAChB/M,GAAcnT,EAAMwT,KAAK0M,SAAU,EAAKhZ,cACxC,GACJiZ,aAAc,OACdC,YAAa,KACb5M,KAAMpG,OAAOC,OAAO,GAAIrN,EAAMwT,KAAM,CAAEK,QAAS,KAC/CO,UAAWpU,EAAMwT,KAAKY,UACtBF,QAAQ,GAjBO,E,gEAuBZ/X,KAAK6D,MAAMwT,KAAK0M,UAEnB/jB,KAAK4X,aAAa,MAAwB,K,mCAQjCpJ,GAAgC,IAAD,OAArB4T,IAAqB,yDAE1CpiB,KAAKqG,SAAS,CACZ2d,aAAc,UACdC,YAAa,OAEftM,GAAIG,wBACF9X,KAAK0E,MAAM2S,KAAK3C,IAChB1U,KAAK6D,MAAMuL,MACXpP,KAAK+K,aACLoK,SAASnV,KAAK0E,MAAM2S,KAAKyI,QAExB9d,MAAK,YAA6B,IAApBqN,EAAmB,EAAzB5F,KAAYsO,EAAa,EAAbA,OAEnB,EAAK1R,UACH,SAAC8b,EAAMte,GAAP,MAAkB,CAChBoT,QAAS5H,EAAK5F,KACd4N,KAAMpG,OAAOC,OAAO,GAAIiR,EAAK9K,KAAM,CACjCyI,MAAOsC,EAAe,GAAK/S,EAAK5F,KAAK9G,OAASwf,EAAK9K,KAAKyI,MACxDpI,QAASrI,EAAK5F,KAAK9G,OACf,CACEgf,aAAcxhB,KAAKob,IAAIna,MACrB,KACAiO,EAAK5F,KAAKpI,KAAI,SAACkW,GAAD,OAAOpC,SAASoC,EAAEvH,gBAGpC,KAENiI,YAAa5I,EAAK4I,UAClB+L,aAAc,OACdC,YAAa,KACblM,YAEFvJ,MAGHiB,OAAM,SAACrN,GACNC,QAAQC,MAAMF,GACd,EAAKiE,SACH,CACE4Q,QAAS,GACT+M,aAAc,SACdC,YAAa,GAAK7hB,GAEpBoM,Q,qCAMNxO,KAAK6D,MAAMsW,aACT,iBAASna,KAAK0E,MAAM2S,KAAK3C,IACzB,kBAAC,GAAD,CACE3L,KAAM,IAAIjF,KACVuT,KAAMrX,KAAK0E,MAAM2S,KACjB3N,aAAc1J,KAAK6D,MAAM6F,aACzBuN,QAASjX,KAAK0E,MAAMuS,QACpBgB,UAAWjY,KAAK0E,MAAMuT,UACtBgK,WAAYjiB,KAAKqG,SAASF,KAAKnG,MAC/BoP,MAAOpP,KAAK6D,MAAMuL,MAClB+K,aAAcna,KAAK6D,MAAMsW,aACzBpP,aAAc/K,KAAK+K,aACnBgV,gBAAiB/f,KAAK6D,MAAMkc,qB,+BAKxB,IAAD,SACuD/f,KAAK6D,MAA3DsW,EADD,EACCA,aAAc/K,EADf,EACeA,MAAO1F,EADtB,EACsBA,aAAcmX,EADpC,EACoCA,SAAUiD,EAD9C,EAC8CA,KACjDzZ,EAAWsV,GAAiBxF,EAAc/K,EAAQpP,KAAK0E,MAAM2S,KAAK3C,KAElEwP,EAAW,CAAC,CAAC,MAAO1jB,IACpB2jB,EAAQtjB,EAAWb,KAAK0E,MAAM2S,KAAKtV,KAAMmiB,GAIzCE,EAAW,KACf,IAAKvD,EAAL,qBAC8BsD,GAD9B,IACE,2BAAmC,CAAC,IAAD,yBAAzBL,EAAyB,KAAnBviB,EAAmB,KAEjC,GADAA,EAAUA,EAAQoB,OAAS,EAAIpB,EAAQuJ,UAAU,GAAKvJ,EAE3C,QAATuiB,IACsC,IAAtCzE,GAAgBlN,QAAQ5Q,IACxB4T,SAAS5T,GAAW4T,SAASnV,KAAK0E,MAAM2S,KAAK3C,KAC7C,CACA,GAAiB,OAAb0P,EACC,CACHA,EAAW,KACX,MAHqBA,EAAWjP,SAAS5T,KARjD,+BAgBA,IAAIM,EACF,yBACEmC,UACE,2CACC6c,EAAW,uBAAyB,IAEvCpb,QAAS,SAAC6G,GACH6S,GAAe7S,EAAMhH,OAAO4W,QAAQ3b,gBACvC,EAAK4Z,iBAGT,kBAAC,GAAD,CACE9C,KAAMrX,KAAK0E,MAAM2S,KACjBY,UAAWjY,KAAK0E,MAAMuT,UACtB8I,eAAe,EACfF,SAAU7gB,KAAK6D,MAAMgd,SACrB9V,aAAc/K,KAAK+K,aACnBV,SAAUA,EACV4M,QAASjX,KAAK0E,MAAMuS,QACpBc,OAAQ/X,KAAK0E,MAAMqT,OACnBrO,aAAcA,IAEhB,yBAAK1F,UAAU,kBACgB,YAA5BhE,KAAK0E,MAAMsf,cACV,yBAAKhgB,UAAU,eAAf,sBAE2B,WAA5BhE,KAAK0E,MAAMsf,cACV,yBAAKhgB,UAAU,eACb,2BACE,uBACEyB,QAAS,WACP,EAAKmS,iBAFT,yCAQF,2BAAI5X,KAAK0E,MAAMuf,cAGlBjkB,KAAK0E,MAAMuS,QACT4L,MAAM,EAt+BS,IAu+BfxhB,KACC,SAACye,GAAD,OACGA,EAAMJ,UAAYI,EAAMyD,aACvB,kBAAC,GAAD,CACExa,IAAK+W,EAAM1I,IACXC,KAAMyI,EACN/U,aAAc,EAAKA,aACnBV,SAAUA,EACVX,aAAcA,OAIvB1J,KAAK0E,MAAMuS,QAAQtU,OAn/BF,IAo/BhB,yBAAKqB,UAAU,eAAf,gBACMhE,KAAK0E,MAAMuS,QAAQtU,OAr/BT,GAo/BhB,aAQR,OAAI3C,KAAK6jB,UAAY7jB,KAAKugB,kBAEpBvgB,KAAKugB,iBAA4B,SAATuD,IACxB,yBACE9f,UAAU,0CACVyB,QAAS,SAAC6G,GACH6S,GAAe7S,EAAMhH,OAAO4W,QAAQ3b,gBACvC,EAAK4Z,iBAGT,yBACEnW,UACE,aAAehE,KAAK6D,MAAMgd,SAAW,mBAAqB,OAGzD7gB,KAAK6D,MAAMgd,UACZ,yBAAK7c,UAAU,2BACb,6BACE,0BAAMA,UAAU,sBAOtB,yBAAKA,UAAU,OACb,yBAAKA,UAAU,gBACVhE,KAAK6D,MAAMoc,gBACZ,0BACEjc,UAAU,+BACVyB,QAAS,WACP,EAAK5B,MAAMoc,eArhCnB,kBAwhCM,0BAAMjc,UAAU,sBAGpB,0BAAMA,UAAU,UAAhB,IAA2BhE,KAAK6D,MAAMwT,KAAK3C,KAX7C,OAaG1U,KAAK6D,MAAMwT,KAAKmJ,cACf,0BAAMxc,UAAU,gCAAhB,WAAoDhE,KAAK6D,MAAMwT,KAAKmJ,aAApE,MAEDxgB,KAAK6D,MAAMwT,KAAK/W,QACf,0BAAM0D,UAAU,6BAAhB,4BAEsB,OAAvBhE,KAAK6D,MAAMwT,KAAKwB,IACf,0BAAM7U,UAAU,iBAAiBhE,KAAK6D,MAAMwT,KAAKwB,IAEnD,kBAACjV,EAAD,CAAMG,MAAO/D,KAAK6D,MAAMwT,KAAKrH,UAAWzL,OAAO,IAC/C,0BAAMP,UAAU,oBACbhE,KAAK6jB,SAAW,qBAAQ,sBAE3B,yBAAK9b,MAAO,CAAEiE,MAAO,cAS5BoY,EACL,6BACGviB,EACD,kBAAC,GAAD,CACE6S,IAAK0P,EACLjK,aAAcna,KAAK6D,MAAMsW,aACzB/K,MAAOpP,KAAK6D,MAAMuL,MAClB2Q,gBAAiB/f,KAAK6D,MAAMkc,mBAIhCle,M,GAtQoBgN,iBA2QpBwV,G,kDACJ,WAAYxgB,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACXC,eAAgB,QAChBkd,UAAW,KACXxK,KAAM,MALS,E,gEAUjBrX,KAAKiP,S,6BAGC,IAAD,OACLjP,KAAKqG,SACH,CACE1B,eAAgB,YAElB,WACEgT,GAAIyB,WAAW,EAAKvV,MAAM6Q,IAAK,EAAK7Q,MAAMuL,OACvCpN,MAAK,SAACqN,GACL,EAAKhJ,SAAS,CACZ1B,eAAgB,OAChB0S,KAAMhI,EAAK5F,UAGdgG,OAAM,SAACC,IACgC,KAAjC,GAAKA,GAAKyC,QAAQ,wCACrB,EAAK9L,SAAS,CACZ1B,eAAgB,UAGlB,EAAK0B,SAAS,CACZ1B,eAAgB,QAChBkd,UAAW,GAAKnS,Y,+BAQ5B,MAAkC,UAA9B1P,KAAK0E,MAAMC,eAAmC,KACX,YAA9B3E,KAAK0E,MAAMC,eAEhB,yBAAKX,UAAU,cACb,yBAAKA,UAAU,eACb,0BAAMA,UAAU,sBADlB,uBAEQhE,KAAK6D,MAAM6Q,MAIc,UAA9B1U,KAAK0E,MAAMC,eAEhB,yBAAKX,UAAU,cACb,yBAAKA,UAAU,eACb,2BACE,uBAAGyB,QAASzF,KAAKiP,KAAK9I,KAAKnG,OAA3B,6BAEF,2BAAIA,KAAK0E,MAAMmd,aAOnB,kBAAC,GAAD,CACExK,KAAMrX,KAAK0E,MAAM2S,KACjByM,KAAM9jB,KAAK6D,MAAMigB,KACjB3J,aAAcna,KAAK6D,MAAMsW,aACzB/K,MAAOpP,KAAK6D,MAAMuL,MAClByR,UAAU,EACVd,gBAAiB/f,KAAK6D,MAAMkc,sB,GAzEVlR,iBA+E5B,SAASyV,GAAUzgB,GACjB,OACE,kBAACkW,GAASmB,SAAV,MACG,gBAAU9L,EAAV,EAAGhK,MAAH,OACC,yBAAKpB,UAAU,gBACVH,EAAMM,OAAS,kBAACK,EAAD,CAAWzC,KAAM8B,EAAMM,QACxCN,EAAM2X,KAAKna,KACV,SAACgW,EAAMkN,GAAP,OACGlN,EAAKqI,UAAYrI,EAAKkM,aACrB,kBAAC,KAAD,CACExa,IAAKsO,EAAKtO,KAAOsO,EAAK3C,IACtB8O,OAAQ,IACRC,OAAO,OACPe,mBAAmB,GAEnB,gCAEI3gB,EAAMkc,iBACS,SAAflc,EAAMigB,MACNS,GACA1gB,EAAM2X,KAAK+I,EAAM,GAAG7P,IAAM2C,EAAK3C,IAAM,IAErC,yBAAK1Q,UAAU,iBACb,yBAAKA,UAAU,oCACZH,EAAM2X,KAAK+I,EAAM,GAAG7P,IAAM2C,EAAK3C,IAAM,EADxC,8BAKJ,kBAAC,GAAD,CACE2C,KAAMA,EACNyM,KAAMjgB,EAAMigB,KACZ3J,aAActW,EAAMsW,aACpB/K,MAAOA,EACP2Q,gBAAiBlc,EAAMkc,gBACvBrW,aAAc7F,EAAM6F,wBAYnC,IAAM+a,GAAb,kDACE,WAAY5gB,GAAQ,IAAD,sBACjB,cAAMA,GACN,IAAImV,EAAUvN,OAAO5H,EAAMigB,KAAKY,cAAgB,mBAF/B,YAGDtT,IAAZ4H,IACFA,EAAyB,SAAfnV,EAAMigB,MAAmBrY,OAAOuF,OAAO2T,KAAO,EAAS,GAEnE,EAAKjgB,MAAQ,CACXsU,QAASA,GAPM,EADrB,8DAYoB8K,GAChB,OAAQA,GACN,IAAK,OACH,MAAO,CAAC,eAAM,2BAAQ,2BAAQ,gBAChC,IAAK,YACH,MAAO,CAAC,2BAAQ,4BAClB,IAAK,SACH,MAAO,CAAC,kBAAS,2BAAQ,gBAE7B,MAAO,KArBX,kCAwBc9K,GACVvN,OAAOzL,KAAK6D,MAAMigB,KAAKY,cAAgB,mBAAqB1L,EAC5DhZ,KAAKqG,SAAS,CACZ2S,QAASA,MA3Bf,+BA+BY,IAAD,OACCA,EAAYhZ,KAAK0E,MAAjBsU,QACF4L,EAAgB5kB,KAAK6kB,kBAAkB7kB,KAAK6D,MAAMigB,MACxD,OACE,oCACE,yBAAK9f,UAAU,kCACZ4gB,EAAcvjB,KAAI,SAAChB,EAAM8J,GAAP,OACjB,uBACEpB,IAAKoB,EACLnG,UAAWgV,IAAY7O,EAAM,UAAY,GACzC1E,QAAS,EAAKqf,YAAY3e,KAAK,EAAMgE,IAEpC9J,OAKP,kBAAC,GAAD,CACE0I,IAAKiQ,EACLmB,aAAcna,KAAK6D,MAAMsW,aACzB2J,KAAM9jB,KAAK6D,MAAMigB,KACjB9K,QAASA,EACT+L,YAAa/kB,KAAK6D,MAAMkhB,YACxB3V,MAAOpP,KAAK6D,MAAMuL,aAtD5B,GAA0BP,iBA6DpBmW,G,kDACJ,WAAYnhB,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACXof,KAAMjgB,EAAMigB,KACZpa,aAAc7F,EAAMkhB,YACpBE,aAAc,EACdC,OAAQ,CACN/gB,MAAO,GACPsF,KAAM,IAER0b,qBAAsB,KACtBxgB,eAAgB,OAChBkd,UAAW,MAEb,EAAKuD,gBAAkB,EAAKC,UAAUlf,KAAf,gBACvBsF,OAAO6T,eAAiBnK,SAASvF,aAAY,gBAAqB,KAAO,EAfxD,E,sDAkBTmJ,GAAO,IAAD,OACRuM,EAAS,SAAC5V,GACdrN,QAAQC,MAAMoN,GACd,EAAKrJ,UAAS,SAAC8b,EAAMte,GAAP,MAAkB,CAC9BohB,aAAc9C,EAAK8C,aAAe,EAClCtgB,eAAgB,SAChBkd,UAAW,GAAKnS,OAIpB,GAAIqJ,EAAO/Y,KAAK0E,MAAMugB,aAAe,EAAG,MAAM,IAAIriB,MAAM,YACxD,GAAImW,IAAS/Y,KAAK0E,MAAMugB,aAAe,EAAG,CAAC,IAAD,EACTjlB,KAAK0E,MAA5Bof,EADgC,EAChCA,KAAMpa,EAD0B,EAC1BA,aAD0B,EAEb1J,KAAK6D,MAAxBuL,EAFgC,EAEhCA,MAAO4J,EAFyB,EAEzBA,QAGf,GAFA3W,QAAQG,IAAI,gBAAiBuW,GAC7BtC,KACa,SAATqN,EACFnM,GAAImB,SAASC,EAAM3J,EAAO4J,GACvBhX,MAAK,SAACqN,GACL,GAAa,IAAT0J,GAAc1J,EAAK5F,KAAK9G,OAAQ,CAElC,IAAI4iB,EAAS9Z,OAAO6T,iBAAmB,EACvCjQ,EAAK5F,KAAKzI,SAAQ,SAACiC,GACbkS,SAASlS,EAAEyR,IAAK,IAAM6Q,IAAQA,EAASpQ,SAASlS,EAAEyR,IAAK,QAE7D9E,aAAY,gBAAsB,GAAK2V,EAEzC9Z,OAAOkP,MAAQtL,EAAKqL,aACpBjP,OAAOoP,WAAaxL,EAAKuL,gBACzBvL,EAAK5F,KAAKzI,SAAQ,SAACiC,GACjB,GAAIA,EAAE8gB,SAAU,CACd,IAAIyB,EAAe,CACjBzO,KAAM,EACNkB,UAAWhV,EAAEgV,UACbxO,KAAMxG,EAAE8gB,UAGVtN,KAAQX,IAAI7S,EAAEyR,IAAKS,SAASlS,EAAE6c,MAAO,IAAK0F,OAG9C,EAAKnf,UAAS,SAAC8b,EAAMte,GAAP,MAAkB,CAC9BqhB,OAAQ,CACN/gB,MAAO,YACPsF,KAAM0Y,EAAK+C,OAAOzb,KAAKtI,OACrBkO,EAAK5F,KAAK9H,QACR,SAACsB,GAAD,OAC8B,IAA5Bkf,EAAK+C,OAAOzb,KAAK9G,SAChBwf,EAAK+C,OAAOzb,KACVoZ,OAAO,KACPrD,MAAK,SAACpV,GAAD,OAAOA,EAAEsK,MAAQzR,EAAEyR,YAInC/P,eAAgB,cAGnB8K,MAAM6V,QACJ,GAAa,WAATxB,GAAqBpa,EAC9BiO,GAAIsB,WAAWF,EAAMrP,EAAc0F,EAAO4J,GACvChX,MAAK,SAACqN,GACL,IAAMoW,EAAgC,IAArBpW,EAAK5F,KAAK9G,OAC3B,EAAK0D,UAAS,SAAC8b,EAAMte,GAAP,MAAkB,CAC9BqhB,OAAQ,CACN/gB,MAAO,eAAiBuF,EAAe,IACvCD,KAAM0Y,EAAK+C,OAAOzb,KAAKtI,OAAOkO,EAAK5F,OAErCqa,KAAM2B,EAAW,kBAAoB,SACrC9gB,eAAgB,cAGnB8K,MAAM6V,QACJ,GAAa,WAATxB,EAAmB,CAC5B,IAAMpP,EAAMS,SAASnV,KAAK0E,MAAMgF,aAAahH,OAAO,GAAI,IACxDiV,GAAIyB,WAAW1E,EAAK1U,KAAK6D,MAAMuL,OAC5BpN,MAAK,SAACqN,GACL,IAAIpM,EAAIoM,EAAK5F,KACb,GAAIxG,EAAE8gB,SAAU,CACd,IAAIyB,EAAe,CACjBzO,KAAM,EACNkB,UAAWhV,EAAEgV,UACbxO,KAAMxG,EAAE8gB,UAGVtN,KAAQX,IAAI7S,EAAEyR,IAAKS,SAASlS,EAAE6c,MAAO,IAAK0F,GAG5C,EAAKnf,SAAS,CACZ6e,OAAQ,CACN/gB,MAAO,SAAWuQ,EAClBjL,KAAM,CAAC4F,EAAK5F,OAEdqa,KAAM,kBACNnf,eAAgB,YAGnB8K,MAAM6V,OACJ,IAAa,cAATxB,EA2FT,YADAzhB,QAAQG,IAAI,mBAzFZ,IAAIkjB,IAAe1lB,KAAK0E,MAAMgF,aAC1Bic,EAAYD,KAAgB1lB,KAAK0E,MAAMgF,aAAakc,MAAM,UAC1DC,EAAe,KACnB,GAAIF,EACF,IACEE,EAAe,IAAI/b,OAAO9J,KAAK0E,MAAMgF,aAAamZ,MAAM,GAAI,IAC5D,MAAOzgB,GACPiD,MAAM,6EAAD,OAAkBjD,IACvByjB,EAAe,KAKnB,GAFAxjB,QAAQG,IAAIkjB,EAAYC,GAEG,IAAvB3lB,KAAK6D,MAAMmV,QACbrB,GAAI0B,cAAcrZ,KAAK6D,MAAMuL,OAC1BpN,MAAK,SAACqN,GACL,EAAKhJ,SAAS,CACZ6e,OAAQ,CACN/gB,MAAM,GAAD,OACHuhB,EACIC,EAAS,2BACaE,EAAaC,WAD1B,8BAEQ,EAAKphB,MAAMgF,aAFnB,SAGT,GALD,kBAOLD,KAAOic,EAEFC,EAMDtW,EAAK5F,KAAK9H,QACR,SAACokB,GAAD,QAAYA,EAAKhkB,KAAK6jB,MAAMC,MAN9BxW,EAAK5F,KAAK9H,QAAO,SAACokB,GAChB,OAAO,EAAKrhB,MAAMgF,aACflI,MAAM,KACNwkB,OAAM,SAAC9M,GAAD,OAAa6M,EAAKhkB,KAAKsa,SAASnD,SAL3C7J,EAAK5F,MAWXqa,KAAM,qBACNnf,eAAgB,SAEb+gB,IACHja,OAAOmO,iBAAmBqM,MAAMC,KAC9B,IAAIC,IAAJ,sBACK1a,OAAOmO,kBADZ,YAEKvK,EAAK5F,KAAKpI,KAAI,SAAC0kB,GAAD,OAAUA,EAAKrR,WAElCwC,MAAK,SAACL,EAAGM,GAAJ,OAAUA,EAAIN,KACrB8C,SAGHlK,MAAM6V,QACJ,GAA2B,IAAvBtlB,KAAK6D,MAAMmV,QAAe,CACnC,IACIS,EAAOhO,OAAOmO,iBACf1C,MAAK,SAACL,EAAGM,GAAJ,OAAUA,EAAIN,KACnBgM,MAHa,IAGN9J,EAAO,GAHD,GAGeA,GAC/B,IAAIU,EAAK9W,OA6BP,OALAN,QAAQG,IAAI,iCACZxC,KAAKqG,SAAS,CACZ1B,eAAgB,OAChBmf,KAAM,uBA1BRnM,GAAI6B,UAAUC,EAAMzZ,KAAK6D,MAAMuL,OAC5BpN,MAAK,SAACqN,GACLA,EAAK5F,KAAKzI,SAAQ,SAACiC,GACjB,GAAIA,EAAE8gB,SAAU,CACd,IAAIyB,EAAe,CACjBzO,KAAM,EACNkB,UAAWhV,EAAEgV,UACbxO,KAAMxG,EAAE8gB,UAGVtN,KAAQX,IAAI7S,EAAEyR,IAAKS,SAASlS,EAAE6c,MAAO,IAAK0F,OAG9C,EAAKnf,UAAS,SAAC8b,EAAMte,GAAP,MAAkB,CAC9BqhB,OAAQ,CACN/gB,MAAO,wBACPsF,KAAM0Y,EAAK+C,OAAOzb,KAAKtI,OAAOkO,EAAK5F,OAErC9E,eAAgB,cAGnB8K,MAAM6V,IAeftlB,KAAKqG,UAAS,SAAC8b,EAAMte,GAAP,MAAkB,CAC9BohB,aAAc9C,EAAK8C,aAAe,EAClCtgB,eAAgB,UAChBkd,UAAW,Y,gCAKPvV,GACJA,EAAMhH,SAAW6W,WAEjBA,SAAS9D,KAAK+N,aAAe3a,OAAO4a,QAAU5a,OAAO6a,YAC3C7a,OAAO6a,aAA6C,SAA9BtmB,KAAK0E,MAAMC,gBAC3C3E,KAAKumB,UAAUvmB,KAAK0E,MAAMugB,aAAe,M,0CAK7CjlB,KAAKumB,UAAU,GACf9a,OAAO6B,iBAAiB,SAAUtN,KAAKolB,iBACvC3Z,OAAO6B,iBAAiB,SAAUtN,KAAKolB,mB,6CAGvC3Z,OAAO2Q,oBAAoB,SAAUpc,KAAKolB,iBAC1C3Z,OAAO2Q,oBAAoB,SAAUpc,KAAKolB,mB,mCAG/Bxb,EAAG4c,GACd,OAAO5c,EAAElH,OAAO,EAAG8jB,IAAY5c,EAAEjH,OAAS6jB,EAAU,MAAQ,M,mCAI5DxmB,KAAKqG,SAAS,CACZogB,YAAY,EACZtB,qBAAsBjjB,KAAKC,MAAMyN,aAAY,kBAAwB,MAClEvO,KAAI,SAACqT,GAAD,iBAAaA,MACjB1K,KAAK,S,+BAIF,IAAD,OACD0c,EAA6D,OAApC9W,aAAY,gBADpC,EAEsD5P,KAAK0E,MAA1Dof,EAFD,EAECA,KAAMoB,EAFP,EAEOA,OAAQC,EAFf,EAEeA,qBAAsBzb,EAFrC,EAEqCA,aAC5C,OACE,yBAAK1F,UAAU,kBACH,cAAT8f,GACwB,IAAvB9jB,KAAK6D,MAAMmV,SACc,OAAzBmM,GACE,4BACEnhB,UAAU,aACV2B,KAAK,SACLF,QAASzF,KAAK2mB,WAAWxgB,KAAKnG,OAHhC,6BASHmlB,GACC,kBAACyB,GAAD,CAAsBC,UAAW1B,IAGnC,kBAACb,GAAD,CACEngB,MAAO+gB,EAAO/gB,MACdqX,KAAM0J,EAAOzb,KACbqa,KAAMA,EACNpa,aAAcA,GAAgB,KAC9ByQ,aAAcna,KAAK6D,MAAMsW,aACzB4F,gBAAiB2G,IAEY,WAA9B1mB,KAAK0E,MAAMC,gBACV,yBAAKX,UAAU,cACb,yBAAKA,UAAU,eACb,2BACE,uBACEyB,QAAS,WACP,EAAK8gB,UAAU,EAAK7hB,MAAMugB,aAAe,KAF7C,6BAQF,2BAAIjlB,KAAK0E,MAAMmd,aAIrB,kBAACrd,EAAD,CACEzC,KACgC,YAA9B/B,KAAK0E,MAAMC,eACT,8BACE,0BAAMX,UAAU,sBADlB,kBAKA,8C,GA9SQ6K,iBAuTtB,SAAS+X,GAAqB/iB,GAAQ,IAAD,EACXijB,mBAASjjB,EAAMgjB,WADJ,mBAC5B9kB,EAD4B,KACtBglB,EADsB,KAE7BvmB,EAAS,UAYf,OACE,yBAAKwD,UAAU,OACb,8BACEA,UAAU,kBACVoB,MAAOrD,EACP2K,SAAU,SAACJ,GAAD,OAAWya,EAAQza,EAAMhH,OAAOF,UAE5C,4BAAQpB,UAAU,aAAa2B,KAAK,SAASF,QAjBpC,WACX,IAAIgU,EAAO,YAAI1X,EAAKilB,SAASxmB,IAC1Ba,KAAI,SAAC4lB,GAAD,OAAO9R,SAAS8R,EAAE,OACtB/P,MAAK,SAACL,EAAGM,GAAJ,OAAUA,EAAIN,KACtBxU,QAAQG,IAAIiX,GACZhO,OAAOmO,iBAAmBH,EAC1BE,KACAoN,EAAQtN,EAAKpY,KAAI,SAACqT,GAAD,iBAAaA,MAAO1K,KAAK,QAUxC,iB,WClmDAkd,GAAU,qCAEVC,G,kDACJ,WAAYtjB,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACXqgB,YAAa,IAEf,EAAKqC,SAAWvjB,EAAMujB,SAEtB,EAAKxb,gBAAkB,EAAKC,UAAU1F,KAAf,gBACvB,EAAKkhB,kBAAoB,EAAKC,YAAYnhB,KAAjB,gBACzB,EAAKohB,iBAAmB,EAAKC,WAAWrhB,KAAhB,gBACxB,EAAKshB,mBAAqB,EAAKC,aAAavhB,KAAlB,gBAVT,E,gEAaE,IAAD,OAClB,GAAIsF,OAAOoE,SAAS8X,KAAM,CACxB,IAAI5lB,EAAO6lB,mBAAmBnc,OAAOoE,SAAS8X,MAAMjlB,OAAO,IAC5B,IAA3BX,EAAK8lB,YAAY,OACnB9lB,EAAOA,EAAKW,OAAO,EAAGX,EAAK8lB,YAAY,OACzC7nB,KAAKqG,SACH,CACE0e,YAAahjB,IAEf,WACE,EAAKulB,YAAY,CAAEve,IAAK,aAK9B0C,OAAO6B,iBACL,cACA,WACE,IAAIvL,EAAO6lB,mBAAmBnc,OAAOoE,SAAS8X,MAAMjlB,OAAO,GACvDX,GAAmB,KAAXA,EAAK,KACfM,QAAQG,IAAI,SAAUT,GACtB,EAAKsE,SACH,CACE0e,YAAahjB,IAEf,WACE,EAAKulB,YAAY,CAAEve,IAAK,iBAKhC,K,gCAIMuD,GACRtM,KAAKqG,SAAS,CACZ0e,YAAazY,EAAMhH,OAAOF,U,kCAIlBkH,GACV,GAAkB,UAAdA,EAAMvD,IAAiB,CACzB,IAAI+e,EAAWZ,GAAQa,KAAK/nB,KAAK0E,MAAMqgB,aACvC,GAAI+C,EAkBF,YAjBIA,EAAS,IACXlY,aAAakY,EAAS,IAAMA,EAAS,GACrCziB,MACE,YACEyiB,EAAS,GACT,IACAA,EAAS,GACT,oDAGGlY,aAAakY,EAAS,IAC7BziB,MACE,cACEyiB,EAAS,GACT,6CAMR,IAAMhE,EAAO9jB,KAAK0E,MAAMqgB,YAAY5b,WAAW,KAC3C,SACoB,cAApBnJ,KAAK6D,MAAMigB,KACX,SACA,YACJ9jB,KAAKonB,SAAStD,EAAM9jB,KAAK0E,MAAMqgB,aAAe,O,mCAKhDtZ,OAAOuc,SAAS,EAAG,GACnBhoB,KAAKqG,SAAS,CACZ0e,YAAa,KAEf/kB,KAAKonB,SAAS,OAAQ,MACtB3b,OAAOoE,SAAS8X,KAAO,K,qCAIvBlc,OAAOuc,SAAS,EAAG,GACnBhoB,KAAKqG,SAAS,CACZ0e,YAAa,KAEf/kB,KAAKonB,SAAS,YAAa,Q,+BAGnB,IAAD,OACP,OACE,kBAACrN,GAASmB,SAAV,MACG,gBAAU9L,EAAV,EAAGhK,MAAH,OACC,yBAAKpB,UAAU,eACb,uBACEA,UAAU,2BACVyB,QAAS,EAAK8hB,kBAEd,0BAAMvjB,UAAU,sBAChB,0BAAMA,UAAU,qBAAhB,mBAECoL,GACD,uBACEpL,UAAU,2BACVyB,QAAS,EAAKgiB,oBAEd,0BAAMzjB,UAAU,wBAChB,0BAAMA,UAAU,qBAAhB,iBAGJ,2BACEA,UAAU,iBACVoB,MAAO,EAAKV,MAAMqgB,YAClBvf,YACsB,cAApB,EAAK3B,MAAMigB,KACP,mDACA,iDAENpX,SAAU,EAAKd,gBACfqc,WAAY,EAAKZ,oBAEnB,uBACErjB,UAAU,2BACVyB,QAAS,WACP,EAAK5B,MAAMsW,aACT,sBACA,kBAACD,GAAD,CAAaC,aAAc,EAAKtW,MAAMsW,kBAI1C,0BAAMnW,UAAW,cAAgBoL,EAAQ,QAAU,WACnD,0BAAMpL,UAAU,qBACboL,EAAQ,eAAO,mBAGjBA,GACD,uBACEpL,UAAU,2BACVyB,QAAS,WACP,EAAK5B,MAAMsW,aACT,2BACA,kBAAC,GAAD,CACE/K,MAAOA,EACPmN,YAAa,WACX,EAAK1Y,MAAMsW,aAAa,KAAM,KAAM,SACpC,EAAKqN,mBAMb,0BAAMxjB,UAAU,mBAChB,0BAAMA,UAAU,qBAAhB,yB,GAxKS6K,iBAkLlB,SAASqZ,GAAMrkB,GACpB,OACE,yBAAKG,UAAU,aAEb,yBAAKA,UAAU,cACb,yBAAKA,UAAU,SACb,uBAAGA,UAAU,iBACX,0BACEyB,QAAS,kBACP5B,EAAMsW,aACJ,sBACA,kBAACD,GAAD,CAAaC,aAActW,EAAMsW,kBAJvC,yBAYJ,kBAAC,GAAD,CACEA,aAActW,EAAMsW,aACpBiN,SAAUvjB,EAAMujB,SAChBtD,KAAMjgB,EAAMigB,S,WC9MTqE,GAAb,kDACE,WAAYtkB,GAAQ,IAAD,8BACjB,cAAMA,IAEDukB,eAAiB,EAAKC,SAASliB,KAAd,gBACtB,EAAKmiB,cAAgB,EAAKC,QAAQpiB,KAAb,gBAJJ,EADrB,uDASInG,KAAK6D,MAAMsW,aAAa,KAAM,KAAM,WATxC,gCAYIna,KAAK6D,MAAMsW,aAAa,KAAM,KAAM,SAZxC,+BAeY,IAAD,OAEHqO,EAAWxoB,KAAK6D,MAAM4kB,MAAMpnB,KAC9B,WAAiBuT,GAAjB,IAAMrT,EAAN,EAAG,GAAH,OACEA,GACE,yBACEwH,IAAK6L,EACL5Q,UACE,oBACC4Q,IAAM,EAAK/Q,MAAM4kB,MAAM9lB,OAAS,EAC7B,uBACA,yBAGLpB,MAILmnB,EAAY1oB,KAAK6D,MAAM4kB,MAAMzoB,KAAK6D,MAAM4kB,MAAM9lB,OAAS,GAAG,GAC9D,OACE,yBACEqB,UACE,sBACe,OAAd0kB,EAAqB,aAAe,gBAGvC,yBACE1kB,UAAU,iBACVyB,QAASzF,KAAKsoB,cACdK,WAAY,SAACvmB,GACXA,EAAE6C,iBACF7C,EAAEkD,OAAOsjB,WAGb,yBAAK5kB,UAAU,WAAWwkB,GAC1B,yBAAKxkB,UAAU,iBACb,uBAAGA,UAAU,eAAeyB,QAASzF,KAAKooB,gBAA1C,OAEE,0BAAMpkB,UAAU,oBAFlB,QAKChE,KAAK6D,MAAM4kB,MAAM9lB,OAAS,GACzB,uBAAGqB,UAAU,eAAeyB,QAASzF,KAAKsoB,eAA1C,OAEE,0BAAMtkB,UAAU,mBAFlB,QAMD0kB,QA/DX,GAA6B7Z,iB,oBCMhBga,I,OAAb,kDACE,WAAYhlB,GAAQ,IAAD,8BACjB,cAAMA,IACDa,MAAQ,CACXokB,MAAO,EACPC,OAAO,GAET,EAAKva,SAAW3K,EAAM2K,SACtB,EAAKwa,aAAe,KAPH,EADrB,sDAWa,IAAD,OACJhpB,KAAKgpB,eACPC,cAAcjpB,KAAKgpB,cACnBhpB,KAAKgpB,aAAe,MAEtBhpB,KAAKqG,SAAS,CACZyiB,MAAO,EACPC,OAAO,IAET/oB,KAAKwO,WACL/C,OAAO+I,YAAW,WAChB,EAAKnO,SAAS,CACZyiB,MAAO,EACPC,OAAO,MAER,OA1BP,0CA6BuB,IAAD,OACdtd,OAAOuF,OAAOT,WAChB2Y,KAASvK,IACPxC,SAAS9D,KACT,CACE8Q,OAAQ,SAACC,GACF,EAAK1kB,MAAMqkB,QACVK,GAAS,KACX,EAAKC,UAEL,EAAKhjB,SAAS,CACZyiB,MAAOM,MAIfE,IAAK,WACH,EAAKjjB,SAAS,CACZyiB,MAAO,EACPC,OAAO,MAIb,CACEQ,UAAU,EACVC,KAAM,QACNC,eAAe,IAInBtN,SAAS7O,iBAAiB,WAAW,SAAClL,GAC/BA,EAAEsnB,QAAoB,WAAVtnB,EAAE2G,MACb,EAAKigB,cAAcC,cAAc,EAAKD,cAC1C,EAAK3iB,SACH,CACEyiB,MAAOa,KAET,WACE,EAAKX,aAAeY,aAAY,WAC9B,IAAIC,EAAY,EAAKnlB,MAAMokB,MAAQ,GAC/Be,GAAa,KAAO,EAAKR,UAE3B,EAAKhjB,SAAS,CACZyiB,MAAOe,MAEV,WAKX1N,SAAS7O,iBAAiB,SAAS,SAAClL,GACpB,WAAVA,EAAE2G,MACA,EAAKigB,eACPC,cAAc,EAAKD,cACnB,EAAKA,aAAe,MAEtB,EAAK3iB,SAAS,CACZyiB,MAAO,WArFnB,+BA6FI,IAAMgB,EAhGS,IAgGW9pB,KAAK0E,MAAMokB,MAjGvB,IAEG,IAgGjB,OACE,yBACE9kB,UACE,gBACChE,KAAK0E,MAAMqkB,MAAQ,sBAAwB,KAC3C/oB,KAAK0E,MAAMokB,OAAS,KAAS,sBAAwB,IAExD/gB,MAAO,CACLgiB,KAAMD,EACNE,MAAOF,EACPG,IAAKH,EACLI,OAAQJ,SAzGlB,GAAoChkB,cCIpC,SAASqkB,GAAgBtmB,GACvB,OAAO,yBAAKwI,GAAG,wBAAwBtE,MAAO,CAAE4K,QAAS,U,IAqJ5CyX,G,kDAjJb,WAAYvmB,GAAQ,IAAD,6BACjB,cAAMA,GACNiN,KNnBFrF,OAAOmO,iBAAmB1X,KAAKC,MAC7ByN,aAAY,kBAAwB,MMoBpCnE,OAAOwR,YAAYrN,aAAY,qBdF5B,SAAyBya,GAE9B,SAASC,UAEQlZ,IAAbiZ,EACI5e,OAAOyB,WAAW,gCAAgCC,QAClDkd,GAEJlO,SAAS9D,KAAKhQ,UAAUkiB,IAAI,kBACzBpO,SAAS9D,KAAKhQ,UAAUC,OAAO,kBAGtCgiB,IACA7e,OAAOyB,WAAW,gCAAgCsd,aAAY,WAC5DF,OcXAG,CACE,CAAEC,aAAStZ,EAAWuZ,OAAO,EAAOC,MAAM,GACxCnf,OAAOuF,OAAOP,eAGlB,EAAK/L,MAAQ,CACXmmB,cAAe,CAAC,CAAC,KAAM,OACvB/G,KAAM,OACNiB,YAAa,KACb+F,iBAAkB,IAAIhnB,KACtBsL,MAAOQ,aAAY,OAAa,MAElC,EAAKmb,mBAAqB,EAAK5Q,aAAahU,KAAlB,gBAC1B,EAAK6kB,eAAiB,EAAK5D,SAASjhB,KAAd,gBACtB,EAAK8kB,kBAAoB,EAAKC,YAAY/kB,KAAjB,gBAnBR,E,0DAgCbnG,KAAK0E,MAAMmmB,cAAcloB,OAAS,EACpC3C,KAAKma,aAAa,KAAM,KAAM,SAC3Bna,KAAKonB,SAAS,OAAQ,Q,mCAGhBjjB,EAAO5C,GAAyB,IAAhBuiB,EAAe,uDAAR,OAClC9jB,KAAKqG,UAAS,SAACmc,GACb,IAAI2I,EAAK3I,EAAUqI,cAAchI,QACjC,GAAa,SAATiB,EACgB,IAAdqH,EAAGxoB,SACLwZ,SAAS9D,KAAKtQ,MAAMkiB,IAApB,WAA8Bxe,OAAO4a,QAArC,MACAlK,SAAS9D,KAAKtQ,MAAMqjB,SAAW,QAC/BjP,SAAS9D,KAAKtQ,MAAMsT,MAAQ,SAE1B8P,EAAGxoB,OArDgB,IAqDiBwoB,EAAGtN,OAAO,EAAG,GACrDsN,EAAKA,EAAGhqB,OAAO,CAAC,CAACgD,EAAO5C,UACnB,GAAa,QAATuiB,EAAgB,CACzB,GAAkB,IAAdqH,EAAGxoB,OAAc,OACrB,GAAkB,IAAdwoB,EAAGxoB,OAAc,CACnB,IAAM0jB,EAAUlK,SAAS9D,KAAKtQ,MAAMkiB,IACpC9N,SAAS9D,KAAKtQ,MAAMqjB,SAAW,GAC/BjP,SAAS9D,KAAKtQ,MAAMkiB,IAAM,GAC1B9N,SAAS9D,KAAKtQ,MAAMsT,MAAQ,GAC5B5P,OAAOuc,SAAS,GAA+B,EAA5B7S,SAASkR,GAAW,MAEzC8E,EAAGE,WACE,GAAa,YAATvH,EACTqH,EAAGE,MACHF,EAAKA,EAAGhqB,OAAO,CAAC,CAACgD,EAAO5C,SACnB,IAAa,UAATuiB,EAOJ,MAAM,IAAIlhB,MAAM,yBANrB,IAAMyjB,EAAUlK,SAAS9D,KAAKtQ,MAAMkiB,IACpC9N,SAAS9D,KAAKtQ,MAAMqjB,SAAW,GAC/BjP,SAAS9D,KAAKtQ,MAAMkiB,IAAM,GAC1B9N,SAAS9D,KAAKtQ,MAAMsT,MAAQ,GAC5B5P,OAAOuc,SAAS,GAA+B,EAA5B7S,SAASkR,GAAW,MACvC8E,EAAK,CAAC,CAAC,KAAM,OAEf,MAAO,CACLN,cAAeM,Q,+BAKZrH,EAAMiB,GACb/kB,KAAKqG,SAAS,CACZyd,KAAMA,EACNiB,YAAaA,EACb+F,iBAAkB,IAAIhnB,S,+BAIhB,IAAD,OACP,OACE,kBAACiW,GAASuR,SAAV,CACElmB,MAAO,CACLA,MAAOpF,KAAK0E,MAAM0K,MAClB6K,UAAW,SAAChX,GACV2M,aAAY,MAAY3M,GAAK,GAC7B,EAAKoD,SAAS,CACZ+I,MAAOnM,OAKb,kBAAC,GAAD,CAAgBuL,SAAUxO,KAAKirB,oBAC/B,yBAAKjnB,UAAU,SAAS+D,MAAOyJ,OAC/B,kBAAC,GAAD,CACE2I,aAAcna,KAAK+qB,mBACnB3D,SAAUpnB,KAAKgrB,eACflH,KAAM9jB,KAAK0E,MAAMof,OAEnB,kBAAC/J,GAASmB,SAAV,MACG,SAAC9L,GAAD,OACC,yBAAKpL,UAAU,kBACb,kBAACmmB,GAAD,CAAiB/a,MAAOA,EAAMhK,SAC5BgK,EAAMhK,OACN,yBAAKpB,UAAU,4BACb,yBAAKA,UAAU,eACb,kBAAC,EAAD,CAAYuC,eAAgB6I,EAAM6K,YAC/B,SAACyB,GAAD,OACC,uBAAGjW,QAASiW,GACV,0BAAM1X,UAAU,oBADlB,mDASToL,EAAMhK,MACL,kBAAC,GAAD,CACE2D,IAAK,EAAKrE,MAAMomB,gBAChB3Q,aAAc,EAAK4Q,mBACnBjH,KAAM,EAAKpf,MAAMof,KACjBiB,YAAa,EAAKrgB,MAAMqgB,YACxB3V,MAAOA,EAAMhK,QAGf,kBAACZ,EAAD,CAAWzC,KAAK,qDAElB,iCAIN,kBAAC,GAAD,CACEoY,aAAcna,KAAK+qB,mBACnBtC,MAAOzoB,KAAK0E,MAAMmmB,oB,qCAnHxB,MAAmC,SAA/Bpf,OAAOuF,OAAOP,cACiB,UAA/BhF,OAAOuF,OAAOP,cAGThF,OAAOyB,WAAW,gCAAgCC,Y,GA5B7CrH,aCPZylB,GAAcC,QACW,cAA7B/f,OAAOoE,SAAS4b,UAEe,UAA7BhgB,OAAOoE,SAAS4b,UAEhBhgB,OAAOoE,SAAS4b,SAAS7F,MACvB,2DAsCN,SAAS8F,GAAgBC,GACvB3e,UAAUoN,cACPwR,SAASD,GACT3pB,MAAK,SAACuY,GACLA,EAAasR,cAAgB,WAC3B,IAAMC,EAAmBvR,EAAawR,WACtCD,EAAiBE,cAAgB,WACA,cAA3BF,EAAiBpnB,QACfsI,UAAUoN,cAAc6R,WAK1B5pB,QAAQG,IAAI,6CAKZH,QAAQG,IAAI,4CAMrBiN,OAAM,SAACnN,GACND,QAAQC,MAAM,4CAA6CA,MCrEjE4pB,IAAS3gB,OAAO,kBAAC,GAAD,MAAS4Q,SAASgQ,eAAe,SDWF,kBAAmBnf,WAU9DvB,OAAO6B,iBAAiB,QAAQ,WAC9B,IAAMqe,EAAK,UAAMhkB,IAAN,sBAEP4jB,IAiDV,SAAiCI,GAE/Bzc,MAAMyc,GACH3pB,MAAK,SAAC4U,GAGiB,MAApBA,EAAS/T,SACuD,IAAhE+T,EAASzH,QAAQzE,IAAI,gBAAgByH,QAAQ,cAG7CnF,UAAUoN,cAAcgS,MAAMpqB,MAAK,SAACuY,GAClCA,EAAaC,aAAaxY,MAAK,WAC7ByJ,OAAOoE,SAASC,eAKpB4b,GAAgBC,MAGnBlc,OAAM,WACLpN,QAAQG,IACN,oEArEA6pB,CAAwBV,GAIxB3e,UAAUoN,cAAcgS,MAAMpqB,MAAK,WACjCK,QAAQG,IACN,gHAMJkpB,GAAgBC,O","file":"static/js/main.1b946996.chunk.js","sourcesContent":["// https://martin.ankerl.com/2009/12/09/how-to-create-random-colors-programmatically/\n\nconst golden_ratio_conjugate = 0.618033988749895;\n\nexport class ColorPicker {\n  constructor() {\n    this.names = {};\n    this.current_h = Math.random();\n  }\n\n  get(name, is_tmp = false) {\n    name = name.toLowerCase();\n    if (is_tmp) return ['hsl(0, 0%, 86%)', 'hsl(0, 0%, 25%)'];\n    if (name === '洞主') return ['hsl(0, 0%, 97%)', 'hsl(0, 0%, 16%)'];\n\n    if (!this.names[name]) {\n      this.current_h += golden_ratio_conjugate;\n      this.current_h %= 1;\n      this.names[name] = [\n        `hsl(${this.current_h * 360}, 50%, 90%)`,\n        `hsl(${this.current_h * 360}, 60%, 20%)`,\n      ];\n    }\n    return this.names[name];\n  }\n}\n","// regexp should match the WHOLE segmented part\n// export const PID_RE=/(^|[^\\d\\u20e3\\ufe0e\\ufe0f])([2-9]\\d{4,5}|1\\d{4,6})(?![\\d\\u20e3\\ufe0e\\ufe0f])/g;\nexport const PID_RE = /(^|[^\\d\\u20e3\\ufe0e\\ufe0f])(#\\d{1,7})(?![\\d\\u20e3\\ufe0e\\ufe0f])/g;\n// TODO: fix this re\n// export const URL_PID_RE=/((?:https?:\\/\\/)?thuhole\\.com\\/?#(?:#|%23)([2-9]\\d{4,5}|1\\d{4,6}))(?!\\d|\\u20e3|\\ufe0e|\\ufe0f)/g;\nexport const URL_PID_RE = /(https:\\/\\/thuhollow\\.github\\.io\\/?#(?:#|%23)(?:\\d{1,7}))(?!\\d|\\u20e3|\\ufe0e|\\ufe0f)/g;\nexport const NICKNAME_RE = /(^|[^A-Za-z])((?:(?:(?:Alice|Bob|Carol|Dave|Eve|Francis|Grace|Hans|Isabella|Jason|Kate|Louis|Margaret|Nathan|Olivia|Paul|Queen|Richard|Susan|Thomas|Uma|Vivian|Winnie|Xander|Yasmine|Zach) )*(?:Alice|Bob|Carol|Dave|Eve|Francis|Grace|Hans|Isabella|Jason|Kate|Louis|Margaret|Nathan|Olivia|Paul|Queen|Richard|Susan|Thomas|Uma|Vivian|Winnie|Xander|Yasmine|Zach))|洞主)(?![A-Za-z])/gi;\nexport const URL_RE = /(^|[^.@a-zA-Z0-9_])(https?:\\/\\/(?:(?:[\\w-]+\\.)+[a-zA-Z]{2,9}|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,5})(?::\\d{1,5})?(?:\\/[\\w~!@#$%^&*()\\-_=+[\\]{};:,./?|]*)?)(?![a-zA-Z0-9])/gi;\n\nexport const TAG_RE = /(^|\\s)(#[^#\\s]{1,32})($|\\s|#)/g;\n\nexport function split_text(txt, rules) {\n  // rules: [['name',/regex/],...]\n  // return: [['name','part'],[null,'part'],...]\n\n  txt = [[null, txt]];\n  rules.forEach((rule) => {\n    let [name, regex] = rule;\n    txt = [].concat.apply(\n      [],\n      txt.map((part) => {\n        let [rule, content] = part;\n        if (rule)\n          // already tagged by previous rules\n          return [part];\n        else {\n          return content\n            .split(regex)\n            .map((seg) => (regex.test(seg) ? [name, seg] : [null, seg]))\n            .filter(([name, seg]) => name !== null || seg);\n        }\n      }),\n    );\n  });\n  return txt;\n}\n","export function get_json(res) {\n  if (!res.ok) {\n    return res.text().then((t) => {\n      console.log('error:', res);\n      t = t.length < 100 ? t : '';\n      throw Error(`${res.status} ${res.statusText} ${t}`);\n    });\n  }\n  return res.text().then((t) => {\n    try {\n      return JSON.parse(t);\n    } catch (e) {\n      console.error('json parse error');\n      console.trace(e);\n      console.log(t);\n      throw new SyntaxError('JSON Parse Error ' + t.substr(0, 50));\n    }\n  });\n}\n\nexport function listen_darkmode(override) {\n  // override: true/false/undefined\n  function update_color_scheme() {\n    if (\n      override === undefined\n        ? window.matchMedia('(prefers-color-scheme: dark)').matches\n        : override\n    )\n      document.body.classList.add('root-dark-mode');\n    else document.body.classList.remove('root-dark-mode');\n  }\n\n  update_color_scheme();\n  window.matchMedia('(prefers-color-scheme: dark)').addListener(() => {\n    update_color_scheme();\n  });\n}\n\nconst NAMES = [\n  'Alice',\n  'Bob',\n  'Carol',\n  'Dave',\n  'Eve',\n  'Francis',\n  'Grace',\n  'Hans',\n  'Isabella',\n  'Jason',\n  'Kate',\n  'Louis',\n  'Margaret',\n  'Nathan',\n  'Olivia',\n  'Paul',\n  'Queen',\n  'Richard',\n  'Susan',\n  'Thomas',\n  'Uma',\n  'Vivian',\n  'Winnie',\n  'Xander',\n  'Yasmine',\n  'Zach',\n];\n\nexport function gen_name(name_id) {\n  if (name_id == 0) return '洞主';\n\n  let r = name_id;\n  let name = '';\n  do {\n    r -= 1;\n    name += ' ' + NAMES[r % 26];\n    r = parseInt(r / 26);\n  } while (r);\n\n  return name.substr(1);\n}\n","import React, { Component, PureComponent } from 'react';\nimport ReactDOM from 'react-dom';\n\nimport TimeAgo from 'react-timeago';\nimport chineseStrings from 'react-timeago/lib/language-strings/zh-CN';\nimport buildFormatter from 'react-timeago/lib/formatters/buildFormatter';\n\nimport './global.css';\nimport './widgets.css';\n\nimport { get_json, API_VERSION_PARAM } from './functions';\n\nfunction pad2(x) {\n  return x < 10 ? '0' + x : '' + x;\n}\nexport function format_time(time) {\n  return `${time.getMonth() + 1}-${pad2(\n    time.getDate(),\n  )} ${time.getHours()}:${pad2(time.getMinutes())}:${pad2(time.getSeconds())}`;\n}\nconst chinese_format = buildFormatter(chineseStrings);\nexport function Time(props) {\n  const time = new Date(props.stamp * 1000);\n  return (\n    <span className={'time-str'}>\n      <TimeAgo\n        date={time}\n        formatter={chinese_format}\n        title={time.toLocaleString('zh-CN', {\n          timeZone: 'Asia/Shanghai',\n          hour12: false,\n        })}\n      />\n      &nbsp;\n      {!props.short ? format_time(time) : null}\n    </span>\n  );\n}\n\nexport function TitleLine(props) {\n  return (\n    <p className=\"centered-line title-line aux-margin\">\n      <span className=\"black-outline\">{props.text}</span>\n    </p>\n  );\n}\n\nexport function GlobalTitle(props) {\n  return (\n    <div className=\"aux-margin\">\n      <div className=\"title\">\n        <p className=\"centered-line\">{props.text}</p>\n      </div>\n    </div>\n  );\n}\n\nclass LoginPopupSelf extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading_status: 'idle',\n    };\n\n    this.input_token_ref = React.createRef();\n  }\n\n  setThuhole(e, tar, ref) {\n    console.log(tar);\n    e.preventDefault();\n    tar.href = '/_login?p=thuhole&token=' + ref.current.value;\n    console.log(tar);\n    alert('T大树洞已经没有啦😭');\n  }\n\n  render() {\n    return (\n      <div>\n        <div className=\"thuhole-login-popup-shadow\" />\n        <div className=\"thuhole-login-popup\">\n          <p>\n            <b>通过第三方验证登陆新T树洞</b>\n          </p>\n          <p>\n            <a href={(process.env.REACT_APP_BACKEND || '/') + \"_login?p=cs\"} target=\"_blank\"\n              referrerPolicy=\"origin\"\n            >\n              <span className=\"icon icon-login\" />\n              &nbsp;闭社\n            </a>\n          </p>\n          <p>\n            <input ref={this.input_token_ref} placeholder=\"T大树洞Token\" />\n            <br />\n            <a\n              href=\"/_login?p=thuhole\"\n              target=\"_blank\"\n              onClick={(e) => {\n                this.setThuhole(e, e.target, this.input_token_ref);\n              }}\n            >\n              <span className=\"icon icon-login\" />\n              &nbsp;T大树洞\n            </a>\n          </p>\n          <p>\n            <small>前往Telegram群查询15分钟临时token</small>\n            <br />\n            <a href=\"//t.me/THUChatBot\" target=\"_blank\">\n              <span className=\"icon icon-login\" />\n              &nbsp;清华大水群\n            </a>\n          </p>\n          <p>\n            <button type=\"button\" disabled>\n              <span className=\"icon icon-login\" />\n              &nbsp;未名bbs\n            </button>\n          </p>\n          <p>\n            <button type=\"button\" disabled>\n              <span className=\"icon icon-login\" />\n              &nbsp;清华统一身份认证\n            </button>\n          </p>\n          <hr />\n          <p>\n            <button onClick={this.props.on_close}>取消</button>\n          </p>\n          <hr />\n          <div className=\"thuhole-login-popup-info\">\n            <p>提醒:</p>\n            <ul>\n              <li>\n                {' '}\n                无论采用哪种方式注册，你后台记录的用户名都是本质实名的（除临时token），因为闭社/T大树洞的管理员可以根据你的闭社id/树洞评论区代号查到邮箱。但是这不影响新T树洞的安全性。新T树洞的匿名性来自隔离用户名与发布的内容，而非试图隔离用户名与真实身份。\n              </li>\n              <li>\n                {' '}\n                由于T大树洞仍未提供授权接口，使用T大树洞方式登陆需要用你的token在特定洞发布一段随机内容以确定身份。这是否违反用户条例由T大树洞管理员决定，需自行承担相关风险。完成登陆后建议立即重置T大树洞token。{' '}\n              </li>\n              <li> 目前一个人可能有两个帐号。</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport class LoginPopup extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      popup_show: false,\n    };\n    this.on_popup_bound = this.on_popup.bind(this);\n    this.on_close_bound = this.on_close.bind(this);\n  }\n\n  on_popup() {\n    this.setState({\n      popup_show: true,\n    });\n  }\n  on_close() {\n    this.setState({\n      popup_show: false,\n    });\n  }\n\n  render() {\n    return (\n      <>\n        {this.props.children(this.on_popup_bound)}\n        {this.state.popup_show && (\n          <LoginPopupSelf\n            token_callback={this.props.token_callback}\n            on_close={this.on_close_bound}\n          />\n        )}\n      </>\n    );\n  }\n}\n","import MarkdownIt from 'markdown-it';\nimport MarkdownItKaTeX from 'markdown-it-katex';\nimport hljs from 'highlight.js';\nimport 'highlight.js/styles/atom-one-dark.css';\nimport './Markdown.css';\n\nimport 'katex/dist/katex.min.css';\n\nlet md = new MarkdownIt({\n  html: false,\n  linkify: false,\n  breaks: true,\n  inline: true,\n  highlight(str, lang) {\n    if (lang && hljs.getLanguage(lang)) {\n      try {\n        return (\n          '<pre class=\"hljs\"><code>' +\n          hljs.highlight(lang, str, true).value +\n          '</code></pre>'\n        );\n      } catch (__) {}\n    }\n    return (\n      '<pre class=\"hljs\"><code>' + md.utils.escapeHtml(str) + '</code></pre>'\n    );\n  },\n}).use(MarkdownItKaTeX, {\n  throwOnError: false,\n  errorColor: '#aa0000',\n});\n\nexport default (text) => md.render(text);\n","import React, { Component, PureComponent } from 'react';\nimport { format_time, Time, TitleLine } from './infrastructure/widgets';\nimport HtmlToReact from 'html-to-react';\nimport './Common.css';\nimport {\n  URL_PID_RE,\n  URL_RE,\n  PID_RE,\n  NICKNAME_RE,\n  TAG_RE,\n  split_text,\n} from './text_splitter';\nimport renderMd from './Markdown';\n\nexport { format_time, Time, TitleLine };\n\nexport const API_BASE = `${process.env.REACT_APP_BACKEND || '/'}_api/v1`;\nexport const API_BASE_2 = `${process.env.REACT_APP_BACKEND || '/'}_api/v2`;\nexport const STORAGE_BASE = `${process.env.REACT_APP_STORAGE || ''}`;\n\n// https://stackoverflow.com/questions/3446170/escape-string-for-use-in-javascript-regex\nfunction escape_regex(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction is_video(s) {\n  try {\n    let url = new URL(s);\n    return (\n      url.pathname.endsWith('.mp4') ||\n      url.pathname.endsWith('.mov') ||\n      (url.searchParams.get('filetype') || '').startsWith('video/')\n    );\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction is_audio(s) {\n  try {\n    let url = new URL(s);\n    return (\n      url.pathname.endsWith('.mp3') ||\n      (url.searchParams.get('filetype') || '').startsWith('audio/')\n    );\n  } catch (e) {\n    return false;\n  }\n}\n\nexport function build_highlight_re(\n  txt,\n  split = ' ',\n  option = 'g',\n  isRegex = false,\n) {\n  if (isRegex) {\n    try {\n      return new RegExp('(' + txt.slice(1, -1) + ')', option);\n    } catch (e) {\n      return /^$/g;\n    }\n  } else {\n    return txt\n      ? new RegExp(\n          `(${txt\n            .split(split)\n            .filter((x) => !!x)\n            .map(escape_regex)\n            .join('|')})`,\n          option,\n        )\n      : /^$/g;\n  }\n}\n\nexport function ColoredSpan(props) {\n  return (\n    <span\n      className=\"colored-span\"\n      style={{\n        '--coloredspan-bgcolor-light': props.colors[0],\n        '--coloredspan-bgcolor-dark': props.colors[1],\n      }}\n    >\n      {props.children}\n    </span>\n  );\n}\n\nfunction normalize_url(url) {\n  return /^https?:\\/\\//.test(url) ? url : 'http://' + url;\n}\n\nfunction stop_loading(e) {\n  e.target.parentNode.classList.remove('loading');\n}\n\n// props: text, show_pid, color_picker, search_param\nexport class HighlightedMarkdown extends Component {\n  render() {\n    const props = this.props;\n    const processDefs = new HtmlToReact.ProcessNodeDefinitions(React);\n    const processInstructions = [\n      {\n        shouldProcessNode: (node) => /^h[123456]$/.test(node.name),\n        processNode(node, children, index) {\n          let currentLevel = +node.name[1];\n          if (currentLevel < 3) currentLevel = 3;\n          const HeadingTag = `h${currentLevel}`;\n          return <HeadingTag key={index}>{children}</HeadingTag>;\n        },\n      },\n      {\n        shouldProcessNode: (node) => node.name === 'img',\n        processNode(node, index) {\n          return (\n            <span className=\"ext-img__warpper loading\">\n              <img\n                src={normalize_url(node.attribs.src)}\n                alt={node.alt}\n                className=\"ext-img\"\n                referrerPolicy={\n                  STORAGE_BASE && node.attribs.src.startsWith(STORAGE_BASE)\n                    ? 'origin'\n                    : 'no-referrer'\n                }\n                onError={stop_loading}\n                onLoad={stop_loading}\n              />\n            </span>\n          );\n        },\n      },\n      {\n        shouldProcessNode: (node) => node.name === 'a',\n        processNode(node, children, index) {\n          return (\n            <a\n              href={normalize_url(node.attribs.href)}\n              target=\"_blank\"\n              rel=\"noopenner\"\n              referrerPolicy={\n                STORAGE_BASE && node.attribs.href.startsWith(STORAGE_BASE)\n                  ? 'origin'\n                  : 'no-referrer'\n              }\n              className=\"ext-link\"\n              key={index}\n            >\n              {children}\n              <span className=\"icon icon-new-tab\" />\n            </a>\n          );\n        },\n      },\n      {\n        shouldProcessNode(node) {\n          return (\n            node.type === 'text' && node.parent && node.parent.name === 'p'\n          ); // pid, nickname, search\n        },\n        processNode(node, children, index) {\n          const originalText = node.data;\n          let rules = [\n            ['url_pid', URL_PID_RE],\n            ['url', URL_RE],\n            ['pid', PID_RE],\n            ['tag', TAG_RE],\n            ['nickname', NICKNAME_RE],\n          ];\n          if (props.search_param) {\n            let search_kws = props.search_param.split(' ').filter((s) => !!s);\n            rules.push([\n              'search',\n              new RegExp(\n                `(${search_kws\n                  .map((s) => s.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'))\n                  .join('|')})`,\n                'g',\n              ),\n            ]);\n          }\n          const splitted = split_text(originalText, rules);\n\n          return (\n            <React.Fragment key={index}>\n              {splitted.map(([rule, p], idx) => {\n                return (\n                  <span key={idx}>\n                    {rule === 'url_pid' ? (\n                      <span\n                        className=\"url-pid-link\"\n                        title={p}\n                        onClick={(e) => {\n                          e.preventDefault();\n                          props.show_pid(p.split('##')[1]);\n                        }}\n                      >\n                        {p}\n                      </span>\n                    ) : rule === 'url' ? (\n                      <>\n                        <a\n                          href={normalize_url(p)}\n                          className=\"ext-link\"\n                          target=\"_blank\"\n                          rel=\"noopener\"\n                          referrerPolicy={\n                            STORAGE_BASE && p.startsWith(STORAGE_BASE)\n                              ? 'origin'\n                              : 'no-referrer'\n                          }\n                        >\n                          {p}\n                          <span className=\"icon icon-new-tab\" />\n                        </a>\n\n                        {/*\n                          这里对referrer暂时没有比较好的办法\n                          如果使用ifrmae对fireofx可行在chomre上很容易变成下载\n                        */}\n                        {is_video(p) && (\n                          <video className=\"ext-video\" src={p} controls />\n                        )}\n                        {is_audio(p) && (\n                          <audio className=\"ext-audio\" src={p} controls />\n                        )}\n                      </>\n                    ) : rule === 'pid' ? (\n                      <a\n                        href={'#' + p}\n                        onClick={(e) => {\n                          e.preventDefault();\n                          props.show_pid(p.substring(1));\n                        }}\n                      >\n                        {p}\n                      </a>\n                    ) : rule === 'nickname' ? (\n                      <ColoredSpan colors={props.color_picker.get(p)}>\n                        {p}\n                      </ColoredSpan>\n                    ) : rule === 'search' ? (\n                      <span className=\"search-query-highlight\">{p}</span>\n                    ) : rule === 'tag' ? (\n                      <a href={p}>{p}</a>\n                    ) : (\n                      p\n                    )}\n                  </span>\n                );\n              })}\n            </React.Fragment>\n          );\n        },\n      },\n      {\n        shouldProcessNode: () => true,\n        processNode: processDefs.processDefaultNode,\n      },\n    ];\n    const parser = new HtmlToReact.Parser();\n    let rawMd = props.text;\n    const renderedMarkdown = renderMd(rawMd);\n    return (\n      parser.parseWithInstructions(\n        renderedMarkdown,\n        (node) => node.type !== 'script',\n        processInstructions,\n      ) || null\n    );\n  }\n}\n\nwindow.TEXTAREA_BACKUP = {};\n\nexport class SafeTextarea extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      text: '',\n    };\n    this.on_change_bound = this.on_change.bind(this);\n    this.on_keydown_bound = this.on_keydown.bind(this);\n    this.clear = this.clear.bind(this);\n    this.area_ref = React.createRef();\n    this.change_callback = props.on_change || (() => {});\n    this.submit_callback = props.on_submit || (() => {});\n  }\n\n  componentDidMount() {\n    this.setState(\n      {\n        text: window.TEXTAREA_BACKUP[this.props.id] || '',\n      },\n      () => {\n        this.change_callback(this.state.text);\n      },\n    );\n  }\n\n  componentWillUnmount() {\n    window.TEXTAREA_BACKUP[this.props.id] = this.state.text;\n    this.change_callback(this.state.text);\n  }\n\n  on_change(event) {\n    this.setState({\n      text: event.target.value,\n    });\n    this.change_callback(event.target.value);\n  }\n  on_keydown(event) {\n    if (event.key === 'Enter' && event.ctrlKey && !event.altKey) {\n      event.preventDefault();\n      this.submit_callback();\n    }\n  }\n\n  clear() {\n    this.setState({\n      text: '',\n    });\n  }\n  set(text) {\n    this.change_callback(text);\n    this.setState({\n      text: text,\n    });\n  }\n  get() {\n    return this.state.text;\n  }\n  focus() {\n    this.area_ref.current.focus();\n  }\n\n  render() {\n    return (\n      <textarea\n        ref={this.area_ref}\n        onChange={this.on_change_bound}\n        value={this.state.text}\n        onKeyDown={this.on_keydown_bound}\n        maxLength=\"4096\"\n      />\n    );\n  }\n}\n\nlet pwa_prompt_event = null;\nwindow.addEventListener('beforeinstallprompt', (e) => {\n  console.log('pwa: received before install prompt');\n  pwa_prompt_event = e;\n});\n\nexport function PromotionBar(props) {\n  let is_ios = /iPhone|iPad|iPod/i.test(window.navigator.userAgent);\n  let is_installed =\n    window.matchMedia('(display-mode: standalone)').matches ||\n    window.navigator.standalone;\n\n  if (is_installed) return null;\n\n  if (is_ios)\n    // noinspection JSConstructorReturnsPrimitive\n    return !navigator.standalone ? (\n      <div className=\"box promotion-bar\">\n        <span className=\"icon icon-about\" />\n        &nbsp; 用 Safari 把树洞 <b>添加到主屏幕</b> 更好用\n      </div>\n    ) : null;\n  // noinspection JSConstructorReturnsPrimitive\n  else\n    return pwa_prompt_event ? (\n      <div className=\"box promotion-bar\">\n        <span className=\"icon icon-about\" />\n        &nbsp; 把网页版树洞{' '}\n        <b>\n          <a\n            onClick={() => {\n              if (pwa_prompt_event) pwa_prompt_event.prompt();\n            }}\n          >\n            安装到桌面\n          </a>\n        </b>{' '}\n        更好用\n      </div>\n    ) : null;\n}\n\nexport class ClickHandler extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      moved: true,\n      init_y: 0,\n      init_x: 0,\n    };\n    this.on_begin_bound = this.on_begin.bind(this);\n    this.on_move_bound = this.on_move.bind(this);\n    this.on_end_bound = this.on_end.bind(this);\n\n    this.MOVE_THRESHOLD = 3;\n    this.last_fire = 0;\n  }\n\n  on_begin(e) {\n    //console.log('click',(e.touches?e.touches[0]:e).screenY,(e.touches?e.touches[0]:e).screenX);\n    this.setState({\n      moved: false,\n      init_y: (e.touches ? e.touches[0] : e).screenY,\n      init_x: (e.touches ? e.touches[0] : e).screenX,\n    });\n  }\n  on_move(e) {\n    if (!this.state.moved) {\n      let mvmt =\n        Math.abs((e.touches ? e.touches[0] : e).screenY - this.state.init_y) +\n        Math.abs((e.touches ? e.touches[0] : e).screenX - this.state.init_x);\n      //console.log('move',mvmt);\n      if (mvmt > this.MOVE_THRESHOLD)\n        this.setState({\n          moved: true,\n        });\n    }\n  }\n  on_end(event) {\n    //console.log('end');\n    if (!this.state.moved) this.do_callback(event);\n    this.setState({\n      moved: true,\n    });\n  }\n\n  do_callback(event) {\n    if (this.last_fire + 100 > +new Date()) return;\n    this.last_fire = +new Date();\n    this.props.callback(event);\n  }\n\n  render() {\n    return (\n      <div\n        onTouchStart={this.on_begin_bound}\n        onMouseDown={this.on_begin_bound}\n        onTouchMove={this.on_move_bound}\n        onMouseMove={this.on_move_bound}\n        onClick={this.on_end_bound}\n      >\n        {this.props.children}\n      </div>\n    );\n  }\n}\n","import React, { PureComponent } from 'react';\nimport { Time, API_BASE } from './Common';\nimport { get_json } from './infrastructure/functions';\n\nimport './Message.css';\n\nexport class MessageViewer extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading_status: 'idle',\n      msg: [],\n    };\n    this.input_suf_ref = React.createRef();\n  }\n\n  componentDidMount() {\n    this.load();\n  }\n\n  load() {\n    if (this.state.loading_status === 'loading') return;\n    this.setState(\n      {\n        loading_status: 'loading',\n      },\n      () => {\n        fetch(API_BASE + '/systemlog', {\n          headers: { 'User-Token': this.props.token },\n        })\n          .then(get_json)\n          .then((json) => {\n            this.setState({\n              loading_status: 'done',\n              msg: json.data,\n              start_time: json.start_time,\n              salt: json.salt,\n              tmp_token: json.tmp_token,\n            });\n          })\n          .catch((err) => {\n            console.error(err);\n            alert('' + err);\n            this.setState({\n              loading_status: 'failed',\n            });\n          });\n      },\n    );\n  }\n\n  do_set_token() {\n    if (this.state.loading_status === 'loading') return;\n    if (!this.input_suf_ref.current.value) {\n      alert('不建议后缀为空');\n      return;\n    }\n    let tt = this.state.tmp_token + '_' + this.input_suf_ref.current.value;\n    console.log(tt);\n    localStorage['TOKEN'] = tt;\n    alert('已登录为临时用户，过期后需注销重新登陆');\n    window.location.reload();\n  }\n\n  render() {\n    if (this.state.loading_status === 'loading')\n      return <p className=\"box box-tip\">加载中……</p>;\n    else if (this.state.loading_status === 'failed')\n      return (\n        <div className=\"box box-tip\">\n          <a\n            onClick={() => {\n              this.load();\n            }}\n          >\n            重新加载\n          </a>\n        </div>\n      );\n    else if (this.state.loading_status === 'done')\n      return (\n        <>\n          <br />\n          <p>\n            最近一次重置 <Time stamp={this.state.start_time} short={false} />\n          </p>\n          <p>\n            随机盐 <b>{this.state.salt}</b>\n          </p>\n          <br />\n          <div>\n            <p>15分钟临时token:</p>\n            <div className=\"input-prepend\">{this.state.tmp_token}_ </div>\n            <input\n              type=\"text\"\n              className=\"input-suf\"\n              ref={this.input_suf_ref}\n              placeholder=\"自定义后缀\"\n              maxLength={10}\n            />\n            <button\n              type=\"button\"\n              disabled={this.state.loading_status === 'loading'}\n              onClick={(e) => this.do_set_token()}\n            >\n              使用\n            </button>\n          </div>\n          {this.state.msg.map((msg) => (\n            <div className=\"box\" key={msg.type + msg.timestamp}>\n              <div className=\"box-header\">\n                <Time stamp={msg.timestamp} short={false} />\n                &nbsp; &nbsp;\n                <b>{msg.type}</b>\n                &nbsp;\n                <span className=\"box-header-name\">{msg.user}</span>\n              </div>\n              <div className=\"box-content\">\n                <pre>{msg.detail}</pre>\n              </div>\n            </div>\n          ))}\n        </>\n      );\n    else return null;\n  }\n}\n","import React, { PureComponent } from 'react';\n\nimport './Config.css';\n\nconst BUILTIN_IMGS = {\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/gbp.jpg':\n    '怀旧背景（默认）',\n  'https://www.tsinghua.edu.cn/image/nav-bg.jpg': '清华紫',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/gbp.jpg':\n    '寻觅繁星',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/eriri.jpg':\n    '平成著名画师',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/yurucamp.jpg':\n    '露营天下第一',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/minecraft.jpg':\n    '麦恩·库拉夫特',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/cyberpunk.jpg':\n    '赛博城市',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/bj.jpg':\n    '城市的星光',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/sif.jpg':\n    '梦开始的地方',\n};\n\nconst DEFAULT_CONFIG = {\n  background_img:\n    '//cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/gbp.jpg',\n  background_color: '#113366',\n  pressure: false,\n  easter_egg: true,\n  color_scheme: 'default',\n  block_tmp: true,\n  block_cw: ['xxg', 'zzxg'],\n  block_words_v4: ['🕷️', '[系统自动代发]'],\n  whitelist_cw: [],\n};\n\nexport function load_config() {\n  let config = Object.assign({}, DEFAULT_CONFIG);\n  let loaded_config;\n  try {\n    loaded_config = JSON.parse(localStorage['hole_config'] || '{}');\n  } catch (e) {\n    alert('设置加载失败，将重置为默认设置！\\n' + e);\n    delete localStorage['hole_config'];\n    loaded_config = {};\n  }\n\n  // unrecognized configs are removed\n  Object.keys(loaded_config).forEach((key) => {\n    if (config[key] !== undefined) config[key] = loaded_config[key];\n  });\n\n  if (loaded_config['block_words_v3']) {\n    config['block_words_v4'] = loaded_config['block_words_v3'].concat(\n      config['block_words_v4'],\n    );\n  }\n\n  console.log('config loaded', config);\n  window.config = config;\n}\n\nexport function save_config(need_load = true) {\n  localStorage['hole_config'] = JSON.stringify(window.config);\n  if (need_load) load_config();\n}\n\nexport function bgimg_style(img, color) {\n  if (img === undefined) img = window.config.background_img;\n  if (color === undefined) color = window.config.background_color;\n  return {\n    background: 'transparent center center',\n    backgroundImage: img === null ? 'unset' : 'url(\"' + encodeURI(img) + '\")',\n    backgroundColor: color,\n    backgroundSize: 'cover',\n  };\n}\n\nclass ConfigBackground extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      img: window.config.background_img,\n      color: window.config.background_color,\n    };\n  }\n\n  save_changes() {\n    this.props.callback({\n      background_img: this.state.img,\n      background_color: this.state.color,\n    });\n  }\n\n  on_select(e) {\n    let value = e.target.value;\n    this.setState(\n      {\n        img: value === '##other' ? '' : value === '##color' ? null : value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n  on_change_img(e) {\n    this.setState(\n      {\n        img: e.target.value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n  on_change_color(e) {\n    this.setState(\n      {\n        color: e.target.value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n\n  render() {\n    let img_select =\n      this.state.img === null\n        ? '##color'\n        : Object.keys(BUILTIN_IMGS).indexOf(this.state.img) === -1\n        ? '##other'\n        : this.state.img;\n    return (\n      <div>\n        <p>\n          <b>背景图片：</b>\n          <select\n            className=\"config-select\"\n            value={img_select}\n            onChange={this.on_select.bind(this)}\n          >\n            {Object.keys(BUILTIN_IMGS).map((key) => (\n              <option key={key} value={key}>\n                {BUILTIN_IMGS[key]}\n              </option>\n            ))}\n            <option value=\"##other\">输入图片网址……</option>\n            <option value=\"##color\">纯色背景……</option>\n          </select>\n          &nbsp;\n          <small>#background_img</small>&nbsp;\n          {img_select === '##other' && (\n            <input\n              type=\"url\"\n              placeholder=\"图片网址\"\n              value={this.state.img}\n              onChange={this.on_change_img.bind(this)}\n            />\n          )}\n          {img_select === '##color' && (\n            <input\n              type=\"color\"\n              value={this.state.color}\n              onChange={this.on_change_color.bind(this)}\n            />\n          )}\n        </p>\n        <div\n          className=\"bg-preview\"\n          style={bgimg_style(this.state.img, this.state.color)}\n        />\n      </div>\n    );\n  }\n}\n\nclass ConfigColorScheme extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      color_scheme: window.config.color_scheme,\n    };\n  }\n\n  save_changes() {\n    this.props.callback({\n      color_scheme: this.state.color_scheme,\n    });\n  }\n\n  on_select(e) {\n    let value = e.target.value;\n    this.setState(\n      {\n        color_scheme: value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n\n  render() {\n    return (\n      <div>\n        <p>\n          <b>夜间模式：</b>\n          <select\n            className=\"config-select\"\n            value={this.state.color_scheme}\n            onChange={this.on_select.bind(this)}\n          >\n            <option value=\"default\">跟随系统</option>\n            <option value=\"light\">始终浅色模式</option>\n            <option value=\"dark\">始终深色模式</option>\n          </select>\n          &nbsp;<small>#color_scheme</small>\n        </p>\n        <p className=\"config-description\">\n          选择浅色或深色模式，深色模式下将会调暗图片亮度\n        </p>\n      </div>\n    );\n  }\n}\n\nclass ConfigTextArea extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      [props.id]: window.config[props.id],\n    };\n  }\n\n  save_changes() {\n    this.props.callback({\n      [this.props.id]: this.props.sift(this.state[this.props.id]),\n    });\n  }\n\n  on_change(e) {\n    let value = this.props.parse(e.target.value);\n    this.setState(\n      {\n        [this.props.id]: value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n\n  render() {\n    return (\n      <div>\n        <label>\n          <p>\n            <b>{this.props.name}</b>&nbsp;<small>#{this.props.id}</small>\n          </p>\n          <p className=\"config-description\">{this.props.description}</p>\n          <textarea\n            name={'config-' + this.props.id}\n            id={`config-textarea-${this.props.id}`}\n            className=\"config-textarea\"\n            value={this.props.display(this.state[this.props.id])}\n            onChange={this.on_change.bind(this)}\n          />\n        </label>\n      </div>\n    );\n  }\n}\n\nclass ConfigSwitch extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      switch: window.config[this.props.id],\n    };\n  }\n\n  on_change(e) {\n    let val = e.target.checked;\n    this.setState(\n      {\n        switch: val,\n      },\n      () => {\n        this.props.callback({\n          [this.props.id]: val,\n        });\n      },\n    );\n  }\n\n  render() {\n    return (\n      <div>\n        <p>\n          <label>\n            <input\n              name={'config-' + this.props.id}\n              type=\"checkbox\"\n              checked={this.state.switch}\n              onChange={this.on_change.bind(this)}\n            />\n            &nbsp;<b>{this.props.name}</b>\n            &nbsp;<small>#{this.props.id}</small>\n          </label>\n        </p>\n        <p className=\"config-description\">{this.props.description}</p>\n      </div>\n    );\n  }\n}\n\nexport class ConfigUI extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.save_changes_bound = this.save_changes.bind(this);\n  }\n\n  save_changes(chg) {\n    console.log(chg);\n    Object.keys(chg).forEach((key) => {\n      window.config[key] = chg[key];\n    });\n    save_config(false);\n  }\n\n  reset_settings() {\n    if (window.confirm('重置所有设置？')) {\n      window.config = {};\n      save_config();\n      window.location.reload();\n    }\n  }\n\n  render() {\n    return (\n      <div>\n        <div className=\"box config-ui-header\">\n          <p>\n            这些功能仍在测试，可能不稳定（\n            <a onClick={this.reset_settings.bind(this)}>全部重置</a>）\n          </p>\n          <p>\n            <b>\n              部分设置修改后需要{' '}\n              <a\n                onClick={() => {\n                  window.location.reload();\n                }}\n              >\n                刷新页面\n              </a>{' '}\n              方可生效\n            </b>\n          </p>\n        </div>\n        <div className=\"box\">\n          <ConfigBackground\n            id=\"background\"\n            callback={this.save_changes_bound}\n          />\n          <hr />\n          <ConfigColorScheme\n            id=\"color-scheme\"\n            callback={this.save_changes_bound}\n          />\n          <hr />\n          <ConfigSwitch\n            callback={this.save_changes_bound}\n            id=\"block_tmp\"\n            name=\"屏蔽临时帐号\"\n            description=\"屏蔽所有临时帐号的发言\"\n          />\n          <hr />\n          <ConfigTextArea\n            id=\"block_cw\"\n            callback={this.save_changes_bound}\n            name=\"设置屏蔽的折叠警告\"\n            description={\n              '折叠警告包含屏蔽词的树洞会不显示而非折叠，每行一个屏蔽词'\n            }\n            display={(array) => array.join('\\n')}\n            sift={(array) => array.filter((v) => v)}\n            parse={(string) => string.split('\\n')}\n          />\n          <hr />\n          <ConfigTextArea\n            id=\"block_words_v4\"\n            callback={this.save_changes_bound}\n            name=\"设置屏蔽词\"\n            description={'包含屏蔽词的树洞会不被显示，每行一个屏蔽词'}\n            display={(array) => array.join('\\n')}\n            sift={(array) => array.filter((v) => v)}\n            parse={(string) => string.split('\\n')}\n          />\n          <hr />\n          <ConfigTextArea\n            id=\"whitelist_cw\"\n            callback={this.save_changes_bound}\n            name=\"展开指定的折叠警告\"\n            description={\n              '完全匹配的树洞不会被折叠，每行一个豁免词，也可使用一个星号(\"*\")表示豁免所有'\n            }\n            display={(array) => array.join('\\n')}\n            sift={(array) => array.filter((v) => v)}\n            parse={(string) => string.split('\\n')}\n          />\n          <hr />\n          <ConfigSwitch\n            callback={this.save_changes_bound}\n            id=\"pressure\"\n            name=\"快速返回\"\n            description=\"短暂按住 Esc 键或重压屏幕（3D Touch）可以快速返回或者刷新树洞\"\n          />\n          <hr />\n          <ConfigSwitch\n            callback={this.save_changes_bound}\n            id=\"easter_egg\"\n            name=\"允许彩蛋\"\n            description=\"在某些情况下显示彩蛋\"\n          />\n          <hr />\n          <p>\n            新功能建议或问题反馈请在&nbsp;\n            <a\n              href=\"https://git.thu.monster/newthuhole/hole-backend-rust/issues\"\n              target=\"_blank\"\n            >\n              Gitea\n            </a>\n            &nbsp;提出。\n          </p>\n        </div>\n      </div>\n    );\n  }\n}\n","const HOLE_CACHE_DB_NAME = 'hole_cache_db';\nconst CACHE_DB_VER = 1;\nconst MAINTENANCE_STEP = 150;\nconst MAINTENANCE_COUNT = 1000;\n\nconst ENC_KEY = 42;\n\nclass Cache {\n  constructor() {\n    this.db = null;\n    this.added_items_since_maintenance = 0;\n    this.encrypt = this.encrypt.bind(this);\n    this.decrypt = this.decrypt.bind(this);\n    const open_req = indexedDB.open(HOLE_CACHE_DB_NAME, CACHE_DB_VER);\n    open_req.onerror = console.error.bind(console);\n    open_req.onupgradeneeded = (event) => {\n      console.log('comment cache db upgrade');\n      const db = event.target.result;\n      const store = db.createObjectStore('comment', {\n        keyPath: 'pid',\n      });\n      store.createIndex('last_access', 'last_access', { unique: false });\n    };\n    open_req.onsuccess = (event) => {\n      console.log('comment cache db loaded');\n      this.db = event.target.result;\n      setTimeout(this.maintenance.bind(this), 1);\n    };\n  }\n\n  // use window.hole_cache.encrypt() only after cache is loaded!\n  encrypt(pid, data) {\n    let s = JSON.stringify(data);\n    let o = '';\n    for (let i = 0, key = (ENC_KEY ^ pid) % 128; i < s.length; i++) {\n      let c = s.charCodeAt(i);\n      let new_key = (key ^ (c / 2)) % 128;\n      o += String.fromCharCode(key ^ s.charCodeAt(i));\n      key = new_key;\n    }\n    return o;\n  }\n\n  // use window.hole_cache.decrypt() only after cache is loaded!\n  decrypt(pid, s) {\n    let o = '';\n    if (typeof s !== typeof 'str') return null;\n\n    for (let i = 0, key = (ENC_KEY ^ pid) % 128; i < s.length; i++) {\n      let c = key ^ s.charCodeAt(i);\n      o += String.fromCharCode(c);\n      key = (key ^ (c / 2)) % 128;\n    }\n\n    try {\n      return JSON.parse(o);\n    } catch (e) {\n      console.error('decrypt failed');\n      console.trace(e);\n      return null;\n    }\n  }\n\n  get(pid, target_version) {\n    pid = parseInt(pid);\n    return new Promise((resolve, reject) => {\n      if (!this.db) return resolve(null);\n      const tx = this.db.transaction(['comment'], 'readwrite');\n      const store = tx.objectStore('comment');\n      const get_req = store.get(pid);\n      get_req.onsuccess = () => {\n        let res = get_req.result;\n        if (!res || !res.data_str) {\n          //console.log('comment cache miss '+pid);\n          resolve(null);\n        } else if (target_version === res.version) {\n          // hit\n          //console.log('comment cache hit', pid);\n          res.last_access = +new Date();\n          store.put(res);\n          let data = this.decrypt(pid, res.data_str);\n          resolve(data); // obj or null\n        } else {\n          // expired\n          console.log(\n            'comment cache expired',\n            pid,\n            ': ver',\n            res.version,\n            'target',\n            target_version,\n          );\n          store.delete(pid);\n          resolve(null);\n        }\n      };\n      get_req.onerror = (e) => {\n        console.warn('comment cache indexeddb open failed');\n        console.error(e);\n        resolve(null);\n      };\n    });\n  }\n\n  put(pid, target_version, data) {\n    pid = parseInt(pid);\n    return new Promise((resolve, reject) => {\n      if (!this.db) return resolve();\n      const tx = this.db.transaction(['comment'], 'readwrite');\n      const store = tx.objectStore('comment');\n      store.put({\n        pid: pid,\n        version: target_version,\n        data_str: this.encrypt(pid, data),\n        last_access: +new Date(),\n      });\n      //console.log('comment cache put', pid);\n      if (++this.added_items_since_maintenance === MAINTENANCE_STEP)\n        setTimeout(this.maintenance.bind(this), 1);\n    });\n  }\n\n  delete(pid) {\n    pid = parseInt(pid);\n    return new Promise((resolve, reject) => {\n      if (!this.db) return resolve();\n      const tx = this.db.transaction(['comment'], 'readwrite');\n      const store = tx.objectStore('comment');\n      let req = store.delete(pid);\n      console.log('comment cache delete', pid);\n      req.onerror = () => {\n        console.warn('comment cache delete failed ', pid);\n        return resolve();\n      };\n      req.onsuccess = () => resolve();\n    });\n  }\n\n  maintenance() {\n    if (!this.db) return;\n    const tx = this.db.transaction(['comment'], 'readwrite');\n    const store = tx.objectStore('comment');\n    let count_req = store.count();\n    count_req.onsuccess = () => {\n      let count = count_req.result;\n      if (count > MAINTENANCE_COUNT) {\n        console.log('comment cache db maintenance', count);\n        store.index('last_access').openKeyCursor().onsuccess = (e) => {\n          let cur = e.target.result;\n          if (cur) {\n            //console.log('maintenance: delete',cur);\n            store.delete(cur.primaryKey);\n            if (--count > MAINTENANCE_COUNT) cur.continue();\n          }\n        };\n      } else {\n        console.log('comment cache db no need to maintenance', count);\n      }\n      this.added_items_since_maintenance = 0;\n    };\n    count_req.onerror = console.error.bind(console);\n  }\n\n  clear() {\n    if (!this.db) return;\n    indexedDB.deleteDatabase(HOLE_CACHE_DB_NAME);\n    console.log('delete comment cache db');\n  }\n}\n\nexport function cache() {\n  if (!window.hole_cache) window.hole_cache = new Cache();\n  return window.hole_cache;\n}\n","import { get_json, gen_name } from './infrastructure/functions';\nimport { API_BASE } from './Common';\nimport { cache } from './cache';\n\nexport { get_json };\n\nconst SEARCH_PAGESIZE = 50;\n\nconst handle_response = async (response, notify = false) => {\n  let json = await get_json(response);\n  if (json.code !== 0) {\n    if (json.msg) {\n      if (notify) {\n        alert(json.msg);\n      } else {\n        throw new Error(json.msg);\n      }\n    } else {\n      throw new Error(JSON.stringify(json));\n    }\n  }\n  return json;\n};\n\nexport const parse_replies = (replies, color_picker) =>\n  replies\n    .sort((a, b) => parseInt(a.cid, 10) - parseInt(b.cid, 10))\n    .map((info) => {\n      info.name = gen_name(info.name_id);\n      info._display_color = color_picker.get(info.name, info.is_tmp);\n      info.variant = {};\n      return info;\n    });\n\nexport const API = {\n  load_replies: async (pid, token, color_picker, cache_version) => {\n    pid = parseInt(pid);\n    let response = await fetch(API_BASE + '/getcomment?pid=' + pid, {\n      headers: {\n        'User-Token': token,\n      },\n    });\n    let json = await handle_response(response);\n    // Why delete then put ??\n    //console.log('Put cache', json, pid, cache_version);\n    cache().put(pid, cache_version, json);\n    json.data = parse_replies(json.data, color_picker);\n    return json;\n  },\n\n  load_replies_with_cache: async (pid, token, color_picker, cache_version) => {\n    pid = parseInt(pid);\n    let json = await cache().get(pid, cache_version);\n    //console.log('Get Cache', json, pid, cache_version);\n    if (json) {\n      //console.log('cache.data', json.data);\n      json.data = parse_replies(json.data, color_picker);\n      return { data: json, cached: true };\n    } else {\n      //console.log('Cache fail, new fetch');\n      json = await API.load_replies(pid, token, color_picker, cache_version);\n      return { data: json, cached: !json };\n    }\n  },\n\n  set_attention: async (pid, attention, token) => {\n    let data = new URLSearchParams();\n    data.append('pid', pid);\n    data.append('switch', attention ? '1' : '0');\n    let response = await fetch(API_BASE + '/attention', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': token,\n      },\n      body: data,\n    });\n    // Delete cache to update `attention` on next reload\n    cache().delete(pid);\n    return handle_response(response, false);\n  },\n\n  report: async (pid, reason, should_hide, token) => {\n    let data = new URLSearchParams([\n      ['pid', pid],\n      ['reason', reason],\n    ]);\n    if (should_hide) {\n      data.append('should_hide', 1);\n    }\n    let response = await fetch(API_BASE + '/report', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': token,\n      },\n      body: data,\n    });\n    return handle_response(response, false);\n  },\n\n  block: async (type, id, token) => {\n    let data = new URLSearchParams([\n      ['type', type],\n      ['id', id],\n    ]);\n    let response = await fetch(API_BASE + '/block', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': token,\n      },\n      body: data,\n    });\n    return handle_response(response, false);\n  },\n\n  del: async (type, id, note, token) => {\n    let data = new URLSearchParams();\n    data.append('type', type);\n    data.append('id', id);\n    data.append('note', note);\n    let response = await fetch(API_BASE + '/delete', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': token,\n      },\n      body: data,\n    });\n    return handle_response(response, false);\n  },\n\n  update_cw: async (cw, id, token) => {\n    let data = new URLSearchParams();\n    data.append('cw', cw);\n    data.append('pid', id);\n    let response = await fetch(API_BASE + '/editcw', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': token,\n      },\n      body: data,\n    });\n    return handle_response(response, false);\n  },\n\n  get_list: async (page, token, submode) => {\n    let response = await fetch(\n      `${API_BASE}/getlist?p=${page}&order_mode=${submode}`,\n      {\n        headers: { 'User-Token': token },\n      },\n    );\n    return handle_response(response);\n  },\n\n  get_search: async (page, keyword, token, submode) => {\n    let response = await fetch(\n      `${API_BASE}/search?search_mode=${submode}&page=${page}&keywords=${encodeURIComponent(\n        keyword,\n      )}&pagesize=${SEARCH_PAGESIZE}`,\n      {\n        headers: { 'User-Token': token },\n      },\n    );\n    return handle_response(response);\n  },\n\n  get_single: async (pid, token) => {\n    let response = await fetch(API_BASE + '/getone?pid=' + pid, {\n      headers: { 'User-Token': token },\n    });\n    return handle_response(response);\n  },\n\n  get_attention: async (token) => {\n    let response = await fetch(API_BASE + '/getattention', {\n      headers: { 'User-Token': token },\n    });\n    return handle_response(response);\n  },\n\n  add_vote: async (vote, pid, token) => {\n    let data = new URLSearchParams([\n      ['vote', vote],\n      ['pid', pid],\n    ]);\n    let response = await fetch(API_BASE + '/vote', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': token,\n      },\n      body: data,\n    });\n    return handle_response(response, true);\n  },\n\n  get_multi: async (pids, token) => {\n    let response = await fetch(\n      API_BASE + '/getmulti?' + pids.map((pid) => `pids=${pid}`).join('&'),\n      {\n        headers: {\n          'User-Token': token,\n        },\n      },\n    );\n    return handle_response(response, true);\n  },\n\n  set_title: async (title, token) => {\n    console.log('title: ', title);\n    let data = new URLSearchParams([['title', title]]);\n    let response = await fetch(API_BASE + '/title', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': token,\n      },\n      body: data,\n    });\n    return handle_response(response, true);\n  },\n};\n","export function load_attentions() {\n  window.saved_attentions = JSON.parse(\n    localStorage['saved_attentions'] || '[]',\n  );\n}\n\nexport function save_attentions() {\n  localStorage['saved_attentions'] = JSON.stringify(window.saved_attentions);\n}\n","import React, { Component } from 'react';\nimport {\n  API_BASE,\n  API_BASE_2,\n  STORAGE_BASE,\n  SafeTextarea,\n  PromotionBar,\n  HighlightedMarkdown,\n} from './Common';\nimport { MessageViewer } from './Message';\nimport { LoginPopup } from './infrastructure/widgets';\nimport { ColorPicker } from './color_picker';\nimport { ConfigUI } from './Config';\nimport copy from 'copy-to-clipboard';\nimport { cache } from './cache';\nimport { get_json } from './flows_api';\nimport { save_attentions } from './Attention';\n\nimport './UserAction.css';\n\nconst REPOSITORY = 'https://git.thu.monster/newthuhole/';\nconst EMAIL = 'hole_thu@riseup.net';\n\nexport const TokenCtx = React.createContext({\n  value: null,\n  set_value: () => {},\n});\n\nexport function InfoSidebar(props) {\n  return (\n    <div>\n      <PromotionBar />\n      <LoginForm show_sidebar={props.show_sidebar} />\n      <div className=\"box list-menu\">\n        <a href=\"/about.html\" target=\"_blank\">\n          <span className=\"icon icon-about\" />\n          <label>关于</label>\n        </a>\n        &nbsp;&nbsp;\n        <a\n          onClick={() => {\n            props.show_sidebar('设置', <ConfigUI />);\n          }}\n        >\n          <span className=\"icon icon-settings\" />\n          <label>本地设置</label>\n        </a>\n        &nbsp;&nbsp;\n        <a href=\"/policy.html\" target=\"_blank\">\n          <span className=\"icon icon-textfile\" />\n          <label>树洞规范（试行）</label>\n        </a>\n        <p>\n          <em>强烈建议开始使用前先看一遍所有设置选项</em>\n        </p>\n      </div>\n      <div className=\"box help-desc-box\">\n        <p>\n          <a\n            onClick={() => {\n              if ('serviceWorker' in navigator) {\n                navigator.serviceWorker\n                  .getRegistrations()\n                  .then((registrations) => {\n                    for (let registration of registrations) {\n                      console.log('unregister', registration);\n                      registration.unregister();\n                    }\n                  });\n              }\n              cache().clear();\n              setTimeout(() => {\n                window.location.reload(true);\n              }, 200);\n            }}\n          >\n            强制检查更新\n          </a>\n          （当前版本：【{process.env.REACT_APP_BUILD_INFO || '---'}{' '}\n          {process.env.NODE_ENV}】 会自动在后台检查更新并在下次访问时更新）\n        </p>\n      </div>\n      <div className=\"box help-desc-box\">\n        <p>意见反馈请加tag #意见反馈 或到github后端的issue区。</p>\n        <p>\n          新T树洞强烈期待有其他更多树洞的出现，一起分布式互联，构建清华树洞族。详情见\n          关于 中的描述。\n        </p>\n        <p>\n          联系我们：<a href={'mailto:' + EMAIL}>{EMAIL}</a> 。\n        </p>\n      </div>\n      <div className=\"box help-desc-box\">\n        <p>\n          新T树洞 网页版 by @hole_thu，基于\n          <a href=\"https://www.gnu.org/licenses/agpl-3.0.html\" target=\"_blank\">\n            AGPLv3\n          </a>\n          协议在{' '}\n          <a href={REPOSITORY} target=\"_blank\">\n            Gitea\n          </a>{' '}\n          开源。\n        </p>\n        <p>\n          新T树洞 网页版基于\n          <a\n            href=\"https://github.com/pkuhelper-web/webhole\"\n            target=\"_blank\"\n            rel=\"noopener\"\n          >\n            P大树洞网页版 by @xmcp\n          </a>\n          、\n          <a\n            href=\"https://github.com/thuhole/webhole\"\n            target=\"_blank\"\n            rel=\"noopener\"\n          >\n            T大树洞网页版 by @thuhole\n          </a>\n          、{' '}\n          <a href=\"https://reactjs.org/\" target=\"_blank\" rel=\"noopener\">\n            React\n          </a>\n          、\n          <a href=\"https://icomoon.io/#icons\" target=\"_blank\" rel=\"noopener\">\n            IcoMoon\n          </a>\n          等开源项目。\n        </p>\n        <hr />\n        <p>\n          新T树洞 后端 by @hole_thu，基于\n          <a href=\"http://www.wtfpl.net/about/\" target=\"_blank\">\n            WTFPLv2\n          </a>\n          协议在{' '}\n          <a href={REPOSITORY} target=\"_blank\">\n            Gitea\n          </a>{' '}\n          开源。\n        </p>\n      </div>\n    </div>\n  );\n}\n\nexport class LoginForm extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      custom_title: window.TITLE || '',\n      auto_block_rank: window.AUTO_BLCOK || 2,\n    };\n  }\n\n  update_title(title, token) {\n    if (title === window.TITLE) {\n      alert('无变化');\n      return;\n    }\n    let data = new FormData();\n    data.append('title', title);\n    fetch(API_BASE + '/title', {\n      method: 'POST',\n      headers: { 'User-Token': token },\n      body: data,\n    })\n      .then(get_json)\n      .then((j) => {\n        if (j.code !== 0) {\n          throw new Error(j.msg);\n        }\n        window.TITLE = title;\n        alert('专属头衔设置成功');\n      })\n      .catch((err) => alert('设置头衔出错了:\\n' + err));\n  }\n\n  update_auto_block(rank, token) {\n    let data = new FormData();\n    data.append('rank', rank);\n    fetch(API_BASE + '/auto_block', {\n      method: 'POST',\n      headers: { 'User-Token': token },\n      body: data,\n    })\n      .then(get_json)\n      .then((j) => {\n        if (j.code !== 0) {\n          throw new Error(j.msg);\n        }\n        window.AUTO_BLCOK = rank;\n        alert('设置自动拉黑阈值成功');\n      })\n      .catch((err) => alert('设置自动拉黑出错了:\\n' + err));\n  }\n\n  copy_token(token) {\n    if (copy(token)) alert('复制成功！\\n请一定不要泄露哦');\n  }\n\n  render() {\n    return (\n      <TokenCtx.Consumer>\n        {(token) => (\n          <div>\n            {/*{!!token.value &&*/}\n            {/*    <LifeInfoBox token={token.value} set_token={token.set_value} />*/}\n            {/*}*/}\n            <div className=\"login-form box\">\n              {token.value ? (\n                <div>\n                  <p>\n                    <b>您已登录。</b>\n                    <button\n                      type=\"button\"\n                      onClick={() => {\n                        token.set_value(null);\n                      }}\n                    >\n                      <span className=\"icon icon-logout\" /> 注销\n                    </button>\n                    <br />\n                  </p>\n                  <p>\n                    <a\n                      onClick={() => {\n                        this.props.show_sidebar(\n                          '系统日志',\n                          <MessageViewer token={token.value} />,\n                        );\n                      }}\n                    >\n                      查看系统日志\n                    </a>\n                    <br />\n                    举报记录、管理日志等都是公开的。\n                  </p>\n                  <p>\n                    <a onClick={this.copy_token.bind(this, token.value)}>\n                      复制 User Token\n                    </a>\n                    <br />\n                    User\n                    Token仅用于开发bot，切勿告知他人。若怀疑被盗号请刷新Token(刷新功能即将上线)。\n                  </p>\n                  <p>\n                    专属头衔：\n                    <input\n                      value={this.state.custom_title}\n                      onChange={(e) => {\n                        this.setState({ custom_title: e.target.value });\n                      }}\n                      maxLength={10}\n                    />\n                    <button\n                      className=\"update-title-btn\"\n                      type=\"button\"\n                      onClick={(e) => {\n                        this.update_title(this.state.custom_title, token.value);\n                      }}\n                      disabled={!this.state.custom_title}\n                    >\n                      提交\n                    </button>\n                    <br />\n                    设置专属头衔后，可在发言时选择使用。重置后需重新设置。临时用户如需保持头衔请使用相同后缀。\n                  </p>\n                  <p>\n                    自动拉黑阈值:\n                    <span style={{ display: 'inline-block', width: '3rem' }}>\n                      <b>{this.state.auto_block_rank * 5}</b>\n                    </span>\n                    <input\n                      value={this.state.auto_block_rank}\n                      type=\"range\"\n                      min=\"1\"\n                      max=\"10\"\n                      list=\"autoBlock\"\n                      onChange={(e) => {\n                        this.setState({ auto_block_rank: e.target.value });\n                      }}\n                    />\n                    <button\n                      className=\"update-title-btn\"\n                      type=\"button\"\n                      onClick={(e) => {\n                        this.update_auto_block(\n                          this.state.auto_block_rank,\n                          token.value,\n                        );\n                      }}\n                    >\n                      提交\n                    </button>\n                    <datalist id=\"autoBlock\">\n                      <option>1</option>\n                      <option>2</option>\n                      <option>3</option>\n                    </datalist>\n                    <br />\n                    自动不展示被拉黑次数较多用户发布的内容，包括自己。对每个洞及其评论的可见性会有1小时缓存，频繁修改无效。\n                  </p>\n                </div>\n              ) : (\n                <LoginPopup token_callback={token.set_value}>\n                  {(do_popup) => (\n                    <div>\n                      <p>\n                        <button type=\"button\" onClick={do_popup}>\n                          <span className=\"icon icon-login\" />\n                          &nbsp;登录\n                        </button>\n                      </p>\n                      <p>\n                        <small>\n                          新T树洞\n                          面向T大学生，通过已验证身份的第三方服务授权登陆。\n                        </small>\n                      </p>\n                    </div>\n                  )}\n                </LoginPopup>\n              )}\n            </div>\n          </div>\n        )}\n      </TokenCtx.Consumer>\n    );\n  }\n}\n\nexport class ReplyForm extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      text: '',\n      loading_status: 'done',\n      preview: false,\n      use_title: false,\n    };\n    this.on_change_bound = this.on_change.bind(this);\n    this.on_use_title_change_bound = this.on_use_title_change.bind(this);\n    this.area_ref = this.props.area_ref || React.createRef();\n    this.global_keypress_handler_bound = this.global_keypress_handler.bind(\n      this,\n    );\n    this.color_picker = new ColorPicker();\n  }\n\n  global_keypress_handler(e) {\n    if (\n      e.code === 'Enter' &&\n      !e.ctrlKey &&\n      !e.altKey &&\n      ['input', 'textarea'].indexOf(e.target.tagName.toLowerCase()) === -1\n    ) {\n      if (this.area_ref.current) {\n        e.preventDefault();\n        this.area_ref.current.focus();\n      }\n    }\n  }\n  componentDidMount() {\n    document.addEventListener('keypress', this.global_keypress_handler_bound);\n  }\n  componentWillUnmount() {\n    document.removeEventListener(\n      'keypress',\n      this.global_keypress_handler_bound,\n    );\n  }\n\n  on_change(value) {\n    this.setState({\n      text: value,\n    });\n  }\n\n  on_use_title_change(event) {\n    this.setState({\n      use_title: event.target.checked,\n    });\n  }\n\n  on_submit(event) {\n    if (event) event.preventDefault();\n    if (this.state.loading_status === 'loading') return;\n    if (!this.state.text) return;\n    this.setState({\n      loading_status: 'loading',\n    });\n\n    const { pid } = this.props;\n    const { text, use_title } = this.state;\n    let data = new URLSearchParams({\n      text: text,\n      use_title: use_title ? '1' : '',\n    });\n    fetch(`${API_BASE_2}/post/${pid}/comment`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': this.props.token,\n      },\n      body: data,\n    })\n      .then(get_json)\n      .then((json) => {\n        if (json.code !== 0) {\n          throw new Error(json.msg);\n        }\n\n        let saved_attentions = window.saved_attentions;\n        if (!saved_attentions.includes(pid)) {\n          saved_attentions.unshift(pid);\n          window.saved_attentions = saved_attentions;\n          save_attentions();\n        }\n\n        this.setState({\n          loading_status: 'done',\n          text: '',\n          preview: false,\n        });\n        this.area_ref.current.clear();\n        this.props.on_complete();\n      })\n      .catch((e) => {\n        console.error(e);\n        alert('回复失败\\n' + e);\n        this.setState({\n          loading_status: 'done',\n        });\n      });\n  }\n\n  toggle_preview() {\n    this.setState({\n      preview: !this.state.preview,\n    });\n  }\n\n  render() {\n    return (\n      <form\n        onSubmit={this.on_submit.bind(this)}\n        className={'reply-form box' + (this.state.text ? ' reply-sticky' : '')}\n      >\n        {this.state.preview ? (\n          <div className=\"reply-preview\">\n            <HighlightedMarkdown\n              text={this.state.text}\n              color_picker={this.color_picker}\n              show_pid={() => {}}\n            />\n          </div>\n        ) : (\n          <SafeTextarea\n            ref={this.area_ref}\n            id={this.props.pid}\n            on_change={this.on_change_bound}\n            on_submit={this.on_submit.bind(this)}\n          />\n        )}\n        <div className=\"reply-form-opt-box\">\n          <div className=\"reply-form-buttons\">\n            <button\n              type=\"button\"\n              onClick={() => {\n                this.toggle_preview();\n              }}\n            >\n              {this.state.preview ? (\n                <span className=\"icon icon-eye-blocked\" />\n              ) : (\n                <span className=\"icon icon-eye\" />\n              )}\n            </button>\n            {this.state.loading_status === 'loading' ? (\n              <button disabled=\"disabled\">\n                <span className=\"icon icon-loading\" />\n              </button>\n            ) : (\n              <button type=\"submit\">\n                <span className=\"icon icon-send\" />\n              </button>\n            )}\n          </div>\n          {window.TITLE && (\n            <label>\n              <input\n                type=\"checkbox\"\n                onChange={this.on_use_title_change_bound}\n                checked={this.state.use_title}\n              />{' '}\n              使用头衔\n            </label>\n          )}\n        </div>\n      </form>\n    );\n  }\n}\n\nexport class PostForm extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      text: '',\n      upload_progress_text: '',\n      is_loading: false,\n      file_name: '',\n      file_type: '',\n      cw: window.CW_BACKUP || '',\n      allow_search: window.AS_BACKUP || false,\n      loading_status: 'done',\n      preview: false,\n      has_poll: !!window.POLL_BACKUP,\n      poll_options: JSON.parse(window.POLL_BACKUP || '[\"\"]'),\n      use_title: false,\n    };\n    this.area_ref = React.createRef();\n    this.on_change_bound = this.on_change.bind(this);\n    this.on_allow_search_change_bound = this.on_allow_search_change.bind(this);\n    this.on_use_title_change_bound = this.on_use_title_change.bind(this);\n    this.on_cw_change_bound = this.on_cw_change.bind(this);\n    this.on_poll_option_change_bound = this.on_poll_option_change.bind(this);\n    this.color_picker = new ColorPicker();\n  }\n\n  componentDidMount() {\n    if (this.area_ref.current) this.area_ref.current.focus();\n  }\n\n  componentWillUnmount() {\n    const { cw, allow_search, has_poll, poll_options } = this.state;\n    window.CW_BACKUP = cw;\n    window.AS_BACKUP = allow_search;\n    localStorage['DEFAULT_ALLOW_SEARCH'] = allow_search ? '1' : '';\n    window.POLL_BACKUP = has_poll ? JSON.stringify(poll_options) : null;\n  }\n\n  on_allow_search_change(event) {\n    this.setState({\n      allow_search: event.target.checked,\n    });\n  }\n\n  on_use_title_change(event) {\n    this.setState({\n      use_title: event.target.checked,\n    });\n  }\n\n  on_cw_change(event) {\n    this.setState({\n      cw: event.target.value,\n    });\n  }\n\n  on_change(value) {\n    this.setState({\n      text: value,\n    });\n  }\n\n  do_post() {\n    const {\n      cw,\n      text,\n      allow_search,\n      use_title,\n      has_poll,\n      poll_options,\n    } = this.state;\n    let data = new URLSearchParams({\n      cw: cw,\n      text: text,\n      allow_search: allow_search ? '1' : '',\n      use_title: use_title ? '1' : '',\n      type: 'text',\n    });\n    if (has_poll) {\n      poll_options.forEach((opt) => {\n        if (opt) data.append('poll_options', opt);\n      });\n    }\n\n    fetch(API_BASE + '/dopost', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': this.props.token,\n      },\n      body: data,\n    })\n      .then(get_json)\n      .then((json) => {\n        if (json.code !== 0) {\n          throw new Error(json.msg);\n        }\n\n        this.setState({\n          loading_status: 'done',\n          text: '',\n          preview: false,\n        });\n        this.area_ref.current.clear();\n        this.props.on_complete();\n        window.CW_BACKUP = '';\n        window.POLL_BACKUP = null;\n      })\n      .catch((e) => {\n        console.error(e);\n        alert('发表失败\\n' + e);\n        this.setState({\n          loading_status: 'done',\n        });\n      });\n  }\n\n  on_submit(event) {\n    if (event) event.preventDefault();\n    if (this.state.loading_status === 'loading') return;\n    if (!this.state.text) return;\n    {\n      this.setState({\n        loading_status: 'loading',\n      });\n      this.do_post();\n    }\n  }\n\n  toggle_preview() {\n    this.setState({\n      preview: !this.state.preview,\n    });\n  }\n\n  on_poll_option_change(event, idx) {\n    let poll_options = this.state.poll_options;\n    let text = event.target.value;\n    poll_options[idx] = text;\n    if (!text && poll_options.length > 1) {\n      poll_options.splice(idx, 1);\n    }\n    if (poll_options[poll_options.length - 1] && poll_options.length < 8) {\n      poll_options.push('');\n    }\n    this.setState({ poll_options: poll_options });\n  }\n\n  on_file_change(event) {\n    console.log(event);\n    let f = event.target.files[0];\n    if (f) {\n      console.log(f);\n      this.setState({ is_loading: true, file_name: f.name, file_type: f.type });\n      // let data = new FormData();\n      // data.append('file', f);\n\n      var xh = new XMLHttpRequest();\n      xh.upload.addEventListener(\n        'progress',\n        this.upload_progress.bind(this),\n        false,\n      );\n      xh.addEventListener('load', this.upload_complete.bind(this), false);\n      xh.addEventListener('error', this.upload_error.bind(this), false);\n      xh.addEventListener('abort', this.upload_abort.bind(this), false);\n      xh.open('POST', API_BASE_2 + '/upload');\n      xh.setRequestHeader('User-Token', this.props.token);\n      xh.send(f);\n    }\n  }\n\n  update_text_after_upload(data) {\n    const { file_name, file_type } = this.state;\n    let url = `${STORAGE_BASE}/${data.path}?filename=${encodeURIComponent(\n      file_name,\n    )}&filetype=${encodeURIComponent(file_type)}`;\n    let new_text =\n      this.state.text +\n      '\\n' +\n      (file_type.startsWith('image/') ? `![](${url})` : url);\n    this.setState({ text: new_text });\n    this.area_ref.current.set(new_text);\n  }\n\n  upload_progress(event) {\n    console.log(event.loaded, event.total);\n    this.setState({\n      upload_progress_text: `${((event.loaded * 100) / event.total).toFixed(\n        2,\n      )}%`,\n    });\n  }\n\n  upload_complete(event) {\n    try {\n      let j = JSON.parse(event.target.responseText);\n      if (j.code != 0) {\n        alert(j.msg);\n        throw new Error();\n      }\n      this.update_text_after_upload(j.data);\n      this.setState({ is_loading: false });\n    } catch (e) {\n      console.log(e);\n      this.upload_error(event);\n    }\n  }\n\n  upload_error(event) {\n    alert(\n      '上传失败\\n' +\n        (event.target.responseText.length < 100\n          ? event.target.responseText\n          : event.target.status),\n    );\n    this.setState({ is_loading: false });\n  }\n\n  upload_abort(event) {\n    alert('上传已中断');\n    this.setState({ is_loading: false });\n  }\n\n  render() {\n    const {\n      has_poll,\n      poll_options,\n      preview,\n      loading_status,\n      upload_progress_text,\n      is_loading,\n      file_name,\n    } = this.state;\n    return (\n      <form onSubmit={this.on_submit.bind(this)} className=\"post-form box\">\n        <div className=\"post-form-bar\">\n          <div>\n            {preview ? (\n              <button\n                type=\"button\"\n                onClick={() => {\n                  this.toggle_preview();\n                }}\n              >\n                <span className=\"icon icon-eye-blocked\" />\n                &nbsp;编辑\n              </button>\n            ) : (\n              <button\n                type=\"button\"\n                onClick={() => {\n                  this.toggle_preview();\n                }}\n              >\n                <span className=\"icon icon-eye\" />\n                &nbsp;预览\n              </button>\n            )}\n\n            {loading_status !== 'done' ? (\n              <button disabled=\"disabled\">\n                <span className=\"icon icon-loading\" />\n                &nbsp;上传\n              </button>\n            ) : (\n              <button type=\"submit\">\n                <span className=\"icon icon-send\" />\n                &nbsp;发表\n              </button>\n            )}\n          </div>\n          <div className=\"checkbox-bar\">\n            <label>\n              <input\n                type=\"checkbox\"\n                onChange={this.on_allow_search_change_bound}\n                checked={this.state.allow_search}\n              />{' '}\n              允许搜索\n            </label>\n            {window.TITLE && (\n              <label>\n                <input\n                  type=\"checkbox\"\n                  onChange={this.on_use_title_change_bound}\n                  checked={this.state.use_title}\n                />{' '}\n                使用头衔\n              </label>\n            )}\n          </div>\n        </div>\n        {preview ? (\n          <div className=\"post-preview\">\n            <HighlightedMarkdown\n              text={this.state.text}\n              color_picker={this.color_picker}\n              show_pid={() => {}}\n            />\n          </div>\n        ) : (\n          <>\n            <span>上传并插入文件: </span>\n            <input\n              className=\"file-input\"\n              type=\"file\"\n              name=\"file\"\n              onChange={this.on_file_change.bind(this)}\n              disabled={is_loading}\n            />\n            {is_loading && (\n              <p>\n                <small>\n                  上传 <i>{file_name}</i> 中: {upload_progress_text}\n                </small>\n              </p>\n            )}\n            <input\n              type=\"text\"\n              placeholder=\"折叠警告(留空表示不折叠)\"\n              value={this.state.cw}\n              id=\"post_cw\"\n              className=\"spoiler-input\"\n              onChange={this.on_cw_change_bound}\n              maxLength=\"32\"\n            />\n            <SafeTextarea\n              ref={this.area_ref}\n              id=\"new_post\"\n              on_change={this.on_change_bound}\n              on_submit={this.on_submit.bind(this)}\n            />\n          </>\n        )}\n        <button\n          type=\"button\"\n          onClick={() => {\n            this.setState({ has_poll: !has_poll });\n          }}\n        >\n          {has_poll ? '取消' : '添加'}投票\n        </button>\n\n        {has_poll && (\n          <div className=\"post-form-poll-options\">\n            <h6>投票选项</h6>\n            {poll_options.map((option, idx) => (\n              <input\n                key={idx}\n                type=\"text\"\n                value={option}\n                placeholder=\"输入以添加选项...\"\n                onChange={(e) => this.on_poll_option_change_bound(e, idx)}\n                maxLength=\"32\"\n              />\n            ))}\n          </div>\n        )}\n        <br />\n        <br />\n        <br />\n        <p>\n          <small>\n            请遵守\n            <a href=\"/policy.html\" target=\"_blank\">\n              树洞管理规范（试行）\n            </a>\n            ，文明发言。\n          </small>\n        </p>\n        <p>\n          <small>上传文件限制200M，保留至少一个月。也可使用第三方图床。</small>\n        </p>\n      </form>\n    );\n  }\n}\n","import React, { PureComponent, useState } from 'react';\nimport copy from 'copy-to-clipboard';\nimport { ColorPicker } from './color_picker';\nimport { split_text, PID_RE } from './text_splitter';\nimport {\n  format_time,\n  Time,\n  TitleLine,\n  ClickHandler,\n  ColoredSpan,\n  HighlightedMarkdown,\n} from './Common';\nimport './Flows.css';\nimport LazyLoad, { forceCheck } from 'react-lazyload';\nimport { TokenCtx, ReplyForm } from './UserAction';\nimport { API, parse_replies } from './flows_api';\nimport { cache } from './cache';\nimport { save_attentions } from './Attention';\nimport Poll from 'react-polls';\n\n/*\nconst IMAGE_BASE = 'https://thimg.yecdn.com/';\nconst IMAGE_BAK_BASE = 'https://img2.thuhole.com/';\n*/\n\nconst CLICKABLE_TAGS = { a: true, audio: true };\nconst PREVIEW_REPLY_COUNT = 10;\n// const QUOTE_BLACKLIST=['23333','233333','66666','666666','10086','10000','100000','99999','999999','55555','555555'];\nconst QUOTE_BLACKLIST = [];\n\nwindow.LATEST_POST_ID = parseInt(localStorage['_LATEST_POST_ID'], 10) || 0;\n\nconst DZ_NAME = '洞主';\n\nfunction check_block(info) {\n  return (\n    ((window.config.block_tmp && info.is_tmp) ||\n      window.config.block_words_v4.some((word) => info.text.includes(word)) ||\n      (info.cw &&\n        window.config.block_words_v4\n          .concat(window.config.block_cw)\n          .some((word) => info.cw.includes(word)))) &&\n    !info.can_del\n  );\n}\n\nfunction load_single_meta(show_sidebar, token) {\n  return async (pid, replace = false) => {\n    let color_picker = new ColorPicker();\n    let title_elem = '树洞 #' + pid;\n    show_sidebar(\n      title_elem,\n      <div className=\"box box-tip\">正在加载 #{pid}</div>,\n      replace ? 'replace' : 'push',\n    );\n    try {\n      let single = await API.get_single(pid, token);\n      single.data.variant = {};\n      let { data: replies } = await API.load_replies_with_cache(\n        pid,\n        token,\n        color_picker,\n        parseInt(single.data.reply),\n      );\n      show_sidebar(\n        title_elem,\n        <FlowSidebar\n          key={+new Date()}\n          info={single.data}\n          replies={replies.data}\n          attention={replies.attention}\n          token={token}\n          show_sidebar={show_sidebar}\n          color_picker={color_picker}\n          deletion_detect={localStorage['DELETION_DETECT'] === 'on'}\n        />,\n        'replace',\n      );\n    } catch (e) {\n      console.error(e);\n      show_sidebar(\n        title_elem,\n        <div className=\"box box-tip\">\n          <p>\n            <a onClick={() => load_single_meta(show_sidebar, token)(pid, true)}>\n              重新加载\n            </a>\n          </p>\n          <p>{'' + e}</p>\n        </div>,\n        'replace',\n      );\n    }\n  };\n}\n\nclass Reply extends PureComponent {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    const {\n      info,\n      color_picker,\n      show_pid,\n      do_filter_name,\n      do_delete,\n      do_report,\n      do_block,\n      search_param,\n    } = this.props;\n    const author = info.name,\n      replyText = info.text,\n      has_block_words = check_block(info);\n    this.color_picker = new ColorPicker();\n    return (\n      <div\n        className={'flow-reply box'}\n        style={\n          info._display_color\n            ? {\n                '--box-bgcolor-light': info._display_color[0],\n                '--box-bgcolor-dark': info._display_color[1],\n              }\n            : null\n        }\n      >\n        <div className=\"box-header\">\n          {!!do_filter_name && (\n            <span\n              className=\"reply-header-badge clickable\"\n              onClick={() => {\n                do_filter_name(info.name);\n              }}\n            >\n              <span className=\"icon icon-locate\" />\n            </span>\n          )}\n          &nbsp;\n          {<span className=\"box-header-name\">{info.name}</span>}\n          {info.author_title && (\n            <span className=\"box-header-name author-title\">{`\"${info.author_title}\"`}</span>\n          )}\n          {info.is_tmp && (\n            <span className=\"box-header-name tmp-title\">临时账号</span>\n          )}\n          {!!do_delete && !!info.can_del && (\n            <span\n              className=\"clickable\"\n              onClick={() => {\n                do_delete('cid', info.cid);\n              }}\n            >\n              {' '}\n              🗑️{' '}\n            </span>\n          )}\n          {!!do_block && (\n            <span className=\"clickable\" onClick={do_block}>\n              {' '}\n              🚫{' '}\n            </span>\n          )}\n          {!!do_report && (\n            <>\n              &nbsp;\n              <span className=\"clickable\" onClick={do_report}>\n                <span className=\"icon icon-flag\" />\n              </span>\n              &nbsp;\n            </>\n          )}\n          {info.dangerous_user && (\n            <span className=\"danger-info\"> {info.dangerous_user} </span>\n          )}\n          {info.blocked_count && (\n            <span className=\"danger-info\"> {info.blocked_count} </span>\n          )}\n          <Time stamp={info.timestamp} short={!do_report} />\n          &nbsp;\n          {has_block_words && <span className=\"box-header-badge\">已屏蔽</span>}\n        </div>\n        {!has_block_words && (\n          <div className=\"box-content\">\n            <HighlightedMarkdown\n              author={author}\n              text={replyText}\n              color_picker={color_picker}\n              show_pid={show_pid}\n              search_param={search_param}\n            />\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n\nclass FlowItem extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      cw: props.info.cw || '',\n    };\n  }\n\n  copy_link(event) {\n    event.preventDefault();\n    copy(\n      `${event.target.href}${\n        this.props.info.cw ? ' 【' + this.props.info.cw + '】' : ''\n      }\\n\\n${this.props.info.text}\\n` +\n        `（${format_time(new Date(this.props.info.timestamp * 1000))} ${\n          this.props.info.likenum\n        }关注 ${this.props.info.reply}回复）\\n\\n` +\n        this.props.replies.map((r) => `【${r.name}】\\n${r.text}\\n`).join('\\n'),\n    );\n  }\n\n  on_cw_change(event) {\n    this.setState({\n      cw: event.target.value,\n    });\n  }\n\n  render() {\n    const {\n      info,\n      is_quote,\n      cached,\n      attention,\n      do_filter_name,\n      do_delete,\n      do_edit_cw,\n      img_clickable,\n      color_picker,\n      show_pid,\n      do_vote,\n      do_block,\n      search_param,\n    } = this.props;\n    const { cw } = this.state;\n    const _display_color = color_picker.get(DZ_NAME, info.is_tmp);\n    return (\n      <div className={'flow-item' + (is_quote ? ' flow-item-quote' : '')}>\n        {!!is_quote && (\n          <div className=\"quote-tip black-outline\">\n            <div>\n              <span className=\"icon icon-quote\" />\n            </div>\n            {/*<div>*/}\n            {/*  <small>提到</small>*/}\n            {/*</div>*/}\n          </div>\n        )}\n        <div\n          className=\"box\"\n          style={{\n            '--box-bgcolor-light': _display_color[0],\n            '--box-bgcolor-dark': _display_color[1],\n          }}\n        >\n          {!!window.LATEST_POST_ID &&\n            parseInt(info.pid, 10) > window.LATEST_POST_ID && (\n              <div className=\"flow-item-dot\" />\n            )}\n          {!!attention && !cached && <div className=\"flow-item-dot\" />}\n          <div className=\"box-header\">\n            {!!do_filter_name && (\n              <span\n                className=\"reply-header-badge clickable\"\n                onClick={() => {\n                  do_filter_name(DZ_NAME);\n                }}\n              >\n                <span className=\"icon icon-locate\" />\n              </span>\n            )}\n            {!!parseInt(info.likenum, 10) && (\n              <span className=\"box-header-badge\">\n                {info.likenum}&nbsp;\n                <span\n                  className={'icon icon-' + (attention ? 'star-ok' : 'star')}\n                />\n              </span>\n            )}\n            {!!parseInt(info.reply, 10) && (\n              <span className=\"box-header-badge\">\n                {info.reply}&nbsp;\n                <span className=\"icon icon-reply\" />\n              </span>\n            )}\n            <code className=\"box-id\">\n              <a href={'##' + info.pid} onClick={this.copy_link.bind(this)}>\n                #{info.pid}\n              </a>\n            </code>\n            &nbsp;\n            {info.author_title && (\n              <span className=\"box-header-name author-title\">{`\"${info.author_title}\"`}</span>\n            )}\n            {info.is_tmp && (\n              <span className=\"box-header-name tmp-title\">临时账号</span>\n            )}\n            {info.is_reported && <span className=\"danger-info\"> R </span>}\n            {!!do_delete && !!info.can_del && (\n              <span\n                className=\"clickable\"\n                onClick={() => {\n                  do_delete('pid', info.pid);\n                }}\n              >\n                {' '}\n                🗑️{' '}\n              </span>\n            )}\n            {!!do_block && (\n              <span className=\"clickable\" onClick={do_block}>\n                {' '}\n                🚫{' '}\n              </span>\n            )}\n            {info.dangerous_user && (\n              <span className=\"danger-info\"> {info.dangerous_user} </span>\n            )}\n            {info.blocked_count && (\n              <span className=\"danger-info\"> {info.blocked_count} </span>\n            )}\n            {info.cw !== null && (!do_edit_cw || !info.can_del) && (\n              <span className=\"box-header-cw\">{info.cw}</span>\n            )}\n            {!!do_edit_cw && !!info.can_del && (\n              <div className=\"box-header-cw-edit clickable\">\n                <input\n                  type=\"text\"\n                  value={cw}\n                  maxLength=\"32\"\n                  placeholder=\"编辑折叠警告\"\n                  onChange={this.on_cw_change.bind(this)}\n                />\n                <button type=\"button\" onClick={(e) => do_edit_cw(cw, info.pid)}>\n                  更新\n                </button>\n              </div>\n            )}\n            {info.allow_search && <span> 📢 </span>}\n            <Time stamp={info.timestamp} short={!img_clickable} />\n          </div>\n          {!!info.hot_score && (\n            <span className=\"box-header\">hot score: {info.hot_score}</span>\n          )}\n          <div className=\"box-content\">\n            <HighlightedMarkdown\n              text={info.text}\n              color_picker={color_picker}\n              show_pid={show_pid}\n              search_param={search_param}\n            />\n          </div>\n          {info.poll && (\n            <div className={!do_vote ? 'box-poll disabled' : 'box-poll'}>\n              <Poll\n                key={info.poll.vote || 'x'}\n                question={''}\n                answers={info.poll.answers}\n                onVote={do_vote || (() => {})}\n                customStyles={{ theme: 'cyan' }}\n                noStorage={true}\n                vote={localStorage['VOTE_RECORD:' + info.pid] || info.poll.vote}\n              />\n            </div>\n          )}\n          {!!(attention && info.variant.latest_reply) && (\n            <p className=\"box-footer\">\n              最新回复 <Time stamp={info.variant.latest_reply} short={false} />\n            </p>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n\nclass FlowSidebar extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      attention: props.attention,\n      info: props.info,\n      replies: props.replies,\n      loading_status: 'done',\n      error_msg: null,\n      filter_name: null,\n      rev: false,\n    };\n    this.color_picker = props.color_picker;\n    this.syncState = props.sync_state || (() => {});\n    this.reply_ref = React.createRef();\n  }\n\n  set_variant(cid, variant) {\n    this.setState(\n      (prev) => {\n        if (cid)\n          return {\n            replies: prev.replies.map((reply) => {\n              if (reply.cid === cid)\n                return Object.assign({}, reply, {\n                  variant: Object.assign({}, reply.variant, variant),\n                });\n              else return reply;\n            }),\n          };\n        else\n          return {\n            info: Object.assign({}, prev.info, {\n              variant: Object.assign({}, prev.info.variant, variant),\n            }),\n          };\n      },\n      function () {\n        this.syncState({\n          info: this.state.info,\n          replies: this.state.replies,\n        });\n      },\n    );\n  }\n\n  load_replies(update_count = true) {\n    this.setState({\n      loading_status: 'loading',\n      error_msg: null,\n    });\n    API.load_replies(\n      this.state.info.pid,\n      this.props.token,\n      this.color_picker,\n      null,\n    )\n      .then((json) => {\n        this.setState(\n          (prev, props) => ({\n            replies: json.data,\n            info: update_count\n              ? Object.assign({}, prev.info, {\n                  reply: '' + json.data.length,\n                  likenum: '' + json.likenum,\n                })\n              : prev.info,\n            attention: !!json.attention,\n            loading_status: 'done',\n            error_msg: null,\n          }),\n          () => {\n            this.syncState({\n              replies: this.state.replies,\n              attention: this.state.attention,\n              info: this.state.info,\n            });\n            if (this.state.replies.length)\n              this.set_variant(null, {\n                latest_reply: Math.max.apply(\n                  null,\n                  this.state.replies.map((r) => parseInt(r.timestamp)),\n                ),\n              });\n          },\n        );\n      })\n      .catch((e) => {\n        console.error(e);\n        this.setState({\n          replies: [],\n          loading_status: 'done',\n          error_msg: '' + e,\n        });\n      });\n  }\n\n  toggle_attention() {\n    const prev_info = this.state.info;\n    const pid = prev_info.pid;\n    API.set_attention(pid, !this.state.attention, this.props.token)\n      .then((json) => {\n        this.setState({\n          attention: json.attention,\n          info: Object.assign({}, prev_info, {\n            likenum: '' + json.likenum,\n          }),\n        });\n\n        let saved_attentions = window.saved_attentions;\n        if (json.attention && !saved_attentions.includes(pid)) {\n          saved_attentions.unshift(pid);\n        } else if (!json.attention && saved_attentions.includes(pid)) {\n          const idx = saved_attentions.indexOf(pid);\n          saved_attentions.splice(idx, 1);\n        }\n        window.saved_attentions = saved_attentions;\n        save_attentions();\n\n        this.syncState({\n          attention: json.attention,\n          info: Object.assign({}, prev_info, {\n            likenum: '' + json.likenum,\n          }),\n        });\n      })\n      .catch((e) => {\n        this.setState({\n          loading_status: 'done',\n        });\n        alert('设置关注失败\\n' + e);\n        console.error(e);\n      });\n  }\n\n  do_vote(vote) {\n    this.setState({\n      loading_status: 'loading',\n      error_msg: null,\n    });\n    API.add_vote(vote, this.state.info.pid, this.props.token)\n      .then((json) => {\n        if (json.code !== 0) return;\n        localStorage['VOTE_RECORD:' + this.state.info.pid] = vote;\n        this.setState(\n          (prev, props) => ({\n            info: Object.assign({}, prev.info, { poll: json.data }),\n            loading_status: 'done',\n          }),\n          () => {\n            this.syncState({\n              info: this.state.info,\n            });\n          },\n        );\n      })\n      .catch((e) => {\n        console.error(e);\n        this.setState({\n          loading_status: 'done',\n          error_msg: '' + e,\n        });\n      });\n  }\n\n  report(event, text = '') {\n    console.log(text);\n    let reason = prompt(`举报 #${this.state.info.pid} 的理由：`, text);\n    let should_hide = confirm('是否认为此洞应该被删除或隐藏？');\n    if (reason !== null) {\n      API.report(this.state.info.pid, reason, should_hide, this.props.token)\n        .then((json) => {\n          alert('举报成功');\n        })\n        .catch((e) => {\n          alert('举报失败\\n' + e);\n          console.error(e);\n        });\n    }\n  }\n\n  block(name, type, id, on_complete) {\n    if (confirm(`确定拉黑${name}吗？后续将不会收到其发布的任何内容`)) {\n      API.block(type, id, this.props.token)\n        .then((json) => {\n          let data = json.data;\n          alert(`操作成功，当前拉黑数 ${data.curr}`);\n          !!on_complete && on_complete();\n        })\n        .catch((e) => {\n          alert('拉黑失败\\n' + e);\n          console.error(e);\n        });\n    }\n  }\n\n  set_filter_name(name) {\n    this.setState((prevState) => ({\n      filter_name: name === prevState.filter_name ? null : name,\n    }));\n  }\n\n  toggle_rev() {\n    this.setState((prevState) => ({ rev: !prevState.rev }), forceCheck);\n  }\n\n  show_reply_bar(name, event) {\n    if (this.reply_ref.current && !event.target.closest('a, .clickable')) {\n      let text = this.reply_ref.current.get();\n      if (\n        /^\\s*(?:Re (?:|洞主|(?:[A-Z][a-z]+ )?(?:[A-Z][a-z]+)|You Win(?: \\d+)?):)?\\s*$/.test(\n          text,\n        )\n      ) {\n        // text is nearly empty so we can replace it\n        let should_text = 'Re ' + name + ': ';\n        if (should_text === this.reply_ref.current.get())\n          this.reply_ref.current.set('');\n        else this.reply_ref.current.set(should_text);\n      }\n    }\n  }\n\n  make_do_delete(token, on_complete = null) {\n    const do_delete = (type, id) => {\n      let note = prompt(`将删除${type}=${id}, 备注：`, '(无)');\n      if (note !== null) {\n        API.del(type, id, note, token)\n          .then((json) => {\n            alert('删除成功');\n            on_complete();\n          })\n          .catch((e) => {\n            alert('删除失败\\n' + e);\n            console.error(e);\n          });\n      }\n    };\n    return do_delete;\n  }\n\n  do_edit_cw(cw, id) {\n    API.update_cw(cw, id, this.props.token)\n      .then((json) => {\n        this.setState(\n          {\n            info: Object.assign({}, this.state.info, { cw: cw }),\n          },\n          () => {\n            this.syncState({\n              info: this.state.info,\n            });\n          },\n        );\n        alert('已更新');\n      })\n      .catch((e) => {\n        alert('更新失败\\n' + e);\n        console.error(e);\n      });\n  }\n\n  render() {\n    if (this.state.loading_status === 'loading')\n      return <p className=\"box box-tip\">加载中……</p>;\n\n    let show_pid = load_single_meta(this.props.show_sidebar, this.props.token);\n\n    let replies_to_show = this.state.filter_name\n      ? this.state.replies.filter((r) => r.name === this.state.filter_name)\n      : this.state.replies.slice();\n    if (this.state.rev) replies_to_show.reverse();\n\n    // may not need key, for performance\n    // key for lazyload elem\n    // let view_mode_key =\n    //   (this.state.rev ? 'y-' : 'n-') + (this.state.filter_name || 'null');\n\n    let replies_cnt = { [DZ_NAME]: 1 };\n    replies_to_show.forEach((r) => {\n      if (replies_cnt[r.name] === undefined) replies_cnt[r.name] = 0;\n      replies_cnt[r.name]++;\n    });\n\n    // hide main thread when filtered\n    let main_thread_elem =\n      this.state.filter_name && this.state.filter_name !== DZ_NAME ? null : (\n        <ClickHandler\n          callback={(e) => {\n            this.show_reply_bar('', e);\n          }}\n        >\n          <FlowItem\n            info={this.state.info}\n            attention={this.state.attention}\n            img_clickable={true}\n            color_picker={this.color_picker}\n            show_pid={show_pid}\n            search_param={this.props.search_param}\n            replies={this.state.replies}\n            set_variant={(variant) => {\n              this.set_variant(null, variant);\n            }}\n            do_filter_name={\n              replies_cnt[DZ_NAME] > 1 ? this.set_filter_name.bind(this) : null\n            }\n            do_delete={this.make_do_delete(this.props.token, () => {\n              window.location.reload();\n            })}\n            do_edit_cw={this.do_edit_cw.bind(this)}\n            do_vote={this.do_vote.bind(this)}\n            do_block={() => {\n              this.block('洞主', 'post', this.state.info.pid, () => {\n                window.location.reload();\n              });\n            }}\n          />\n        </ClickHandler>\n      );\n\n    return (\n      <div className=\"flow-item-row sidebar-flow-item\">\n        <div className=\"box box-tip\">\n          {!!this.props.token && (\n            <span>\n              <a onClick={this.report.bind(this)}>\n                <span className=\"icon icon-flag\" />\n                <label>举报</label>\n              </a>\n              &nbsp;&nbsp;\n            </span>\n          )}\n          <a onClick={this.load_replies.bind(this)}>\n            <span className=\"icon icon-refresh\" />\n            <label>刷新</label>\n          </a>\n          {(this.state.replies.length >= 1 || this.state.rev) && (\n            <span>\n              &nbsp;&nbsp;\n              <a onClick={this.toggle_rev.bind(this)}>\n                <span className=\"icon icon-order-rev\" />\n                <label>{this.state.rev ? '还原' : '逆序'}</label>\n              </a>\n            </span>\n          )}\n          {!!this.props.token && (\n            <span>\n              &nbsp;&nbsp;\n              <a\n                onClick={() => {\n                  this.toggle_attention();\n                }}\n              >\n                {this.state.attention ? (\n                  <span>\n                    <span className=\"icon icon-star-ok\" />\n                    <label>已关注</label>\n                  </span>\n                ) : (\n                  <span>\n                    <span className=\"icon icon-star\" />\n                    <label>未关注</label>\n                  </span>\n                )}\n              </a>\n            </span>\n          )}\n        </div>\n        {!!this.state.filter_name && (\n          <div className=\"box box-tip flow-item filter-name-bar\">\n            <p>\n              <span style={{ float: 'left' }}>\n                <a\n                  onClick={() => {\n                    this.set_filter_name(null);\n                  }}\n                >\n                  还原\n                </a>\n              </span>\n              <span className=\"icon icon-locate\" />\n              &nbsp;当前只看&nbsp;\n              <ColoredSpan\n                colors={this.color_picker.get(this.state.filter_name)}\n              >\n                {this.state.filter_name}\n              </ColoredSpan>\n            </p>\n          </div>\n        )}\n        {!this.state.rev && main_thread_elem}\n        {!!this.state.error_msg && (\n          <div className=\"box box-tip flow-item\">\n            <p>加载失败</p>\n            <p>{this.state.error_msg}</p>\n          </div>\n        )}\n        {this.props.deletion_detect &&\n          parseInt(this.state.info.reply) > this.state.replies.length &&\n          !!this.state.replies.length && (\n            <div className=\"box box-tip flow-item box-danger\">\n              {parseInt(this.state.info.reply) - this.state.replies.length}{' '}\n              条回复被删除\n            </div>\n          )}\n        {replies_to_show.map(\n          (reply, i) =>\n            (reply.can_del || !reply.is_blocked) && (\n              <LazyLoad\n                key={i}\n                offset={1500}\n                height=\"5em\"\n                overflow={true}\n                once={true}\n              >\n                <ClickHandler\n                  callback={(e) => {\n                    this.show_reply_bar(reply.name, e);\n                  }}\n                >\n                  <Reply\n                    info={reply}\n                    color_picker={this.color_picker}\n                    show_pid={show_pid}\n                    search_param={this.props.search_param}\n                    set_variant={(variant) => {\n                      this.set_variant(reply.cid, variant);\n                    }}\n                    do_filter_name={\n                      replies_cnt[reply.name] > 1\n                        ? this.set_filter_name.bind(this)\n                        : null\n                    }\n                    do_delete={this.make_do_delete(\n                      this.props.token,\n                      this.load_replies.bind(this),\n                    )}\n                    do_block={() => {\n                      this.block(\n                        reply.name,\n                        'comment',\n                        reply.cid,\n                        this.load_replies.bind(this),\n                      );\n                    }}\n                    do_report={(e) => {\n                      this.report(\n                        e,\n                        `评论区${reply.name}，评论id ${reply.cid}`,\n                      );\n                    }}\n                  />\n                </ClickHandler>\n              </LazyLoad>\n            ),\n        )}\n        {this.state.rev && main_thread_elem}\n        {this.props.token ? (\n          <ReplyForm\n            pid={this.state.info.pid}\n            token={this.props.token}\n            area_ref={this.reply_ref}\n            on_complete={this.load_replies.bind(this)}\n          />\n        ) : (\n          <div className=\"box box-tip flow-item\">登录后可以回复树洞</div>\n        )}\n      </div>\n    );\n  }\n}\n\nclass FlowItemRow extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.needFold =\n      props.info.cw &&\n      window.config.whitelist_cw.indexOf('*') == -1 &&\n      window.config.whitelist_cw.indexOf(props.info.cw) == -1 &&\n      props.mode === 'list';\n    this.has_block_words = check_block(props.info);\n    this.color_picker = new ColorPicker();\n    this.state = {\n      replies: props.info.comments\n        ? parse_replies(props.info.comments, this.color_picker)\n        : [],\n      reply_status: 'done',\n      reply_error: null,\n      info: Object.assign({}, props.info, { variant: {} }),\n      attention: props.info.attention,\n      cached: true, // default no display anything\n    };\n  }\n\n  componentDidMount() {\n    // cache from getlist, so always to this to update attention\n    if (!this.props.info.comments) {\n      //if (true || parseInt(this.state.info.reply, 10)) {\n      this.load_replies(null, /*update_count=*/ false);\n    }\n  }\n\n  // reveal() {\n  //   this.setState({ hidden: false });\n  // }\n\n  load_replies(callback, update_count = true) {\n    //console.log('fetching reply', this.state.info.pid);\n    this.setState({\n      reply_status: 'loading',\n      reply_error: null,\n    });\n    API.load_replies_with_cache(\n      this.state.info.pid,\n      this.props.token,\n      this.color_picker,\n      parseInt(this.state.info.reply),\n    )\n      .then(({ data: json, cached }) => {\n        //console.log('>> update', json, json.attention);\n        this.setState(\n          (prev, props) => ({\n            replies: json.data,\n            info: Object.assign({}, prev.info, {\n              reply: update_count ? '' + json.data.length : prev.info.reply,\n              variant: json.data.length\n                ? {\n                    latest_reply: Math.max.apply(\n                      null,\n                      json.data.map((r) => parseInt(r.timestamp)),\n                    ),\n                  }\n                : {},\n            }),\n            attention: !!json.attention,\n            reply_status: 'done',\n            reply_error: null,\n            cached,\n          }),\n          callback,\n        );\n      })\n      .catch((e) => {\n        console.error(e);\n        this.setState(\n          {\n            replies: [],\n            reply_status: 'failed',\n            reply_error: '' + e,\n          },\n          callback,\n        );\n      });\n  }\n\n  show_sidebar() {\n    this.props.show_sidebar(\n      '树洞 #' + this.state.info.pid,\n      <FlowSidebar\n        key={+new Date()}\n        info={this.state.info}\n        search_param={this.props.search_param}\n        replies={this.state.replies}\n        attention={this.state.attention}\n        sync_state={this.setState.bind(this)}\n        token={this.props.token}\n        show_sidebar={this.props.show_sidebar}\n        color_picker={this.color_picker}\n        deletion_detect={this.props.deletion_detect}\n      />,\n    );\n  }\n\n  render() {\n    const { show_sidebar, token, search_param, is_quote, mode } = this.props;\n    let show_pid = load_single_meta(show_sidebar, token, [this.state.info.pid]);\n\n    let hl_rules = [['pid', PID_RE]];\n    let parts = split_text(this.state.info.text, hl_rules);\n\n    //console.log('hl:', parts,this.state.info.pid);\n\n    let quote_id = null;\n    if (!is_quote)\n      for (let [mode, content] of parts) {\n        content = content.length > 0 ? content.substring(1) : content;\n        if (\n          mode === 'pid' &&\n          QUOTE_BLACKLIST.indexOf(content) === -1 &&\n          parseInt(content) < parseInt(this.state.info.pid)\n        ) {\n          if (quote_id === null) quote_id = parseInt(content);\n          else {\n            quote_id = null;\n            break;\n          }\n        }\n      }\n\n    let res = (\n      <div\n        className={\n          'flow-item-row flow-item-row-with-prompt' +\n          (is_quote ? ' flow-item-row-quote' : '')\n        }\n        onClick={(event) => {\n          if (!CLICKABLE_TAGS[event.target.tagName.toLowerCase()])\n            this.show_sidebar();\n        }}\n      >\n        <FlowItem\n          info={this.state.info}\n          attention={this.state.attention}\n          img_clickable={false}\n          is_quote={this.props.is_quote}\n          color_picker={this.color_picker}\n          show_pid={show_pid}\n          replies={this.state.replies}\n          cached={this.state.cached}\n          search_param={search_param}\n        />\n        <div className=\"flow-reply-row\">\n          {this.state.reply_status === 'loading' && (\n            <div className=\"box box-tip\">加载中</div>\n          )}\n          {this.state.reply_status === 'failed' && (\n            <div className=\"box box-tip\">\n              <p>\n                <a\n                  onClick={() => {\n                    this.load_replies();\n                  }}\n                >\n                  重新加载评论\n                </a>\n              </p>\n              <p>{this.state.reply_error}</p>\n            </div>\n          )}\n          {this.state.replies\n            .slice(0, PREVIEW_REPLY_COUNT)\n            .map(\n              (reply) =>\n                (reply.can_del || !reply.is_blocked) && (\n                  <Reply\n                    key={reply.cid}\n                    info={reply}\n                    color_picker={this.color_picker}\n                    show_pid={show_pid}\n                    search_param={search_param}\n                  />\n                ),\n            )}\n          {this.state.replies.length > PREVIEW_REPLY_COUNT && (\n            <div className=\"box box-tip\">\n              还有 {this.state.replies.length - PREVIEW_REPLY_COUNT} 条\n            </div>\n          )}\n        </div>\n      </div>\n    );\n\n    if (this.needFold || this.has_block_words) {\n      return (\n        (!this.has_block_words || mode !== 'list') && (\n          <div\n            className=\"flow-item-row flow-item-row-with-prompt\"\n            onClick={(event) => {\n              if (!CLICKABLE_TAGS[event.target.tagName.toLowerCase()])\n                this.show_sidebar();\n            }}\n          >\n            <div\n              className={\n                'flow-item' + (this.props.is_quote ? ' flow-item-quote' : '')\n              }\n            >\n              {!!this.props.is_quote && (\n                <div className=\"quote-tip black-outline\">\n                  <div>\n                    <span className=\"icon icon-quote\" />\n                  </div>\n                  {/*<div>*/}\n                  {/*  <small>提到</small>*/}\n                  {/*</div>*/}\n                </div>\n              )}\n              <div className=\"box\">\n                <div className=\"box-header\">\n                  {!!this.props.do_filter_name && (\n                    <span\n                      className=\"reply-header-badge clickable\"\n                      onClick={() => {\n                        this.props.do_filter_name(DZ_NAME);\n                      }}\n                    >\n                      <span className=\"icon icon-locate\" />\n                    </span>\n                  )}\n                  <code className=\"box-id\">#{this.props.info.pid}</code>\n                  &nbsp;\n                  {this.props.info.author_title && (\n                    <span className=\"box-header-name author-title\">{`\"${this.props.info.author_title}\"`}</span>\n                  )}\n                  {this.props.info.is_tmp && (\n                    <span className=\"box-header-name tmp-title\">临时账号</span>\n                  )}\n                  {this.props.info.cw !== null && (\n                    <span className=\"box-header-cw\">{this.props.info.cw}</span>\n                  )}\n                  <Time stamp={this.props.info.timestamp} short={true} />\n                  <span className=\"box-header-badge\">\n                    {this.needFold ? '已折叠' : '已屏蔽'}\n                  </span>\n                  <div style={{ clear: 'both' }} />\n                </div>\n              </div>\n            </div>\n          </div>\n        )\n      );\n    }\n\n    return quote_id ? (\n      <div>\n        {res}\n        <FlowItemQuote\n          pid={quote_id}\n          show_sidebar={this.props.show_sidebar}\n          token={this.props.token}\n          deletion_detect={this.props.deletion_detect}\n        />\n      </div>\n    ) : (\n      res\n    );\n  }\n}\n\nclass FlowItemQuote extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading_status: 'empty',\n      error_msg: null,\n      info: null,\n    };\n  }\n\n  componentDidMount() {\n    this.load();\n  }\n\n  load() {\n    this.setState(\n      {\n        loading_status: 'loading',\n      },\n      () => {\n        API.get_single(this.props.pid, this.props.token)\n          .then((json) => {\n            this.setState({\n              loading_status: 'done',\n              info: json.data,\n            });\n          })\n          .catch((err) => {\n            if (('' + err).indexOf('没有这条树洞') !== -1)\n              this.setState({\n                loading_status: 'empty',\n              });\n            else\n              this.setState({\n                loading_status: 'error',\n                error_msg: '' + err,\n              });\n          });\n      },\n    );\n  }\n\n  render() {\n    if (this.state.loading_status === 'empty') return null;\n    else if (this.state.loading_status === 'loading')\n      return (\n        <div className=\"aux-margin\">\n          <div className=\"box box-tip\">\n            <span className=\"icon icon-loading\" />\n            提到了 #{this.props.pid}\n          </div>\n        </div>\n      );\n    else if (this.state.loading_status === 'error')\n      return (\n        <div className=\"aux-margin\">\n          <div className=\"box box-tip\">\n            <p>\n              <a onClick={this.load.bind(this)}>重新加载</a>\n            </p>\n            <p>{this.state.error_msg}</p>\n          </div>\n        </div>\n      );\n    // 'done'\n    else\n      return (\n        <FlowItemRow\n          info={this.state.info}\n          mode={this.props.mode}\n          show_sidebar={this.props.show_sidebar}\n          token={this.props.token}\n          is_quote={true}\n          deletion_detect={this.props.deletion_detect}\n        />\n      );\n  }\n}\n\nfunction FlowChunk(props) {\n  return (\n    <TokenCtx.Consumer>\n      {({ value: token }) => (\n        <div className=\"flow-chunk\">\n          {!!props.title && <TitleLine text={props.title} />}\n          {props.list.map(\n            (info, ind) =>\n              (info.can_del || !info.is_blocked) && (\n                <LazyLoad\n                  key={info.key || info.pid}\n                  offset={500}\n                  height=\"15em\"\n                  hiddenIfInvisible={false}\n                >\n                  <div>\n                    {!!(\n                      props.deletion_detect &&\n                      props.mode === 'list' &&\n                      ind &&\n                      props.list[ind - 1].pid - info.pid > 1\n                    ) && (\n                      <div className=\"flow-item-row\">\n                        <div className=\"box box-tip flow-item box-danger\">\n                          {props.list[ind - 1].pid - info.pid - 1} 条被删除\n                        </div>\n                      </div>\n                    )}\n                    <FlowItemRow\n                      info={info}\n                      mode={props.mode}\n                      show_sidebar={props.show_sidebar}\n                      token={token}\n                      deletion_detect={props.deletion_detect}\n                      search_param={props.search_param}\n                    />\n                  </div>\n                </LazyLoad>\n              ),\n          )}\n        </div>\n      )}\n    </TokenCtx.Consumer>\n  );\n}\n\nexport class Flow extends PureComponent {\n  constructor(props) {\n    super(props);\n    let submode = window[props.mode.toUpperCase() + '_SUBMODE_BACKUP'];\n    if (submode === undefined) {\n      submode = props.mode === 'list' ? (window.config.by_c ? 1 : 0) : 0;\n    }\n    this.state = {\n      submode: submode,\n    };\n  }\n\n  get_submode_names(mode) {\n    switch (mode) {\n      case 'list':\n        return ['最新', '最近回复', '近期热门', '随机'];\n      case 'attention':\n        return ['线上关注', '本地收藏'];\n      case 'search':\n        return ['Tag搜索', '全文搜索', '头衔'];\n    }\n    return [];\n  }\n\n  set_submode(submode) {\n    window[this.props.mode.toUpperCase() + '_SUBMODE_BACKUP'] = submode;\n    this.setState({\n      submode: submode,\n    });\n  }\n\n  render() {\n    const { submode } = this.state;\n    const submode_names = this.get_submode_names(this.props.mode);\n    return (\n      <>\n        <div className=\"aux-margin flow-submode-choice\">\n          {submode_names.map((name, idx) => (\n            <a\n              key={idx}\n              className={submode === idx ? 'choiced' : ''}\n              onClick={this.set_submode.bind(this, idx)}\n            >\n              {name}\n            </a>\n          ))}\n        </div>\n\n        <SubFlow\n          key={submode}\n          show_sidebar={this.props.show_sidebar}\n          mode={this.props.mode}\n          submode={submode}\n          search_text={this.props.search_text}\n          token={this.props.token}\n        />\n      </>\n    );\n  }\n}\n\nclass SubFlow extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      mode: props.mode,\n      search_param: props.search_text,\n      loaded_pages: 0,\n      chunks: {\n        title: '',\n        data: [],\n      },\n      local_attention_text: null,\n      loading_status: 'done',\n      error_msg: null,\n    };\n    this.on_scroll_bound = this.on_scroll.bind(this);\n    window.LATEST_POST_ID = parseInt(localStorage['_LATEST_POST_ID'], 10) || 0;\n  }\n\n  load_page(page) {\n    const failed = (err) => {\n      console.error(err);\n      this.setState((prev, props) => ({\n        loaded_pages: prev.loaded_pages - 1,\n        loading_status: 'failed',\n        error_msg: '' + err,\n      }));\n    };\n\n    if (page > this.state.loaded_pages + 1) throw new Error('bad page');\n    if (page === this.state.loaded_pages + 1) {\n      const { mode, search_param } = this.state;\n      const { token, submode } = this.props;\n      console.log('fetching page', page);\n      cache();\n      if (mode === 'list') {\n        API.get_list(page, token, submode)\n          .then((json) => {\n            if (page === 1 && json.data.length) {\n              // update latest_post_id\n              let max_id = window.LATEST_POST_ID || -1;\n              json.data.forEach((x) => {\n                if (parseInt(x.pid, 10) > max_id) max_id = parseInt(x.pid, 10);\n              });\n              localStorage['_LATEST_POST_ID'] = '' + max_id;\n            }\n            window.TITLE = json.custom_title;\n            window.AUTO_BLCOK = json.auto_block_rank;\n            json.data.forEach((x) => {\n              if (x.comments) {\n                let comment_json = {\n                  code: 0,\n                  attention: x.attention,\n                  data: x.comments,\n                };\n                //console.log('My cache', comment_json, x.pid, x.reply)\n                cache().put(x.pid, parseInt(x.reply, 10), comment_json);\n              }\n            });\n            this.setState((prev, props) => ({\n              chunks: {\n                title: 'News Feed',\n                data: prev.chunks.data.concat(\n                  json.data.filter(\n                    (x) =>\n                      prev.chunks.data.length === 0 ||\n                      !prev.chunks.data\n                        .slice(-100)\n                        .some((p) => p.pid === x.pid),\n                  ),\n                ),\n              },\n              loading_status: 'done',\n            }));\n          })\n          .catch(failed);\n      } else if (mode === 'search' && search_param) {\n        API.get_search(page, search_param, token, submode)\n          .then((json) => {\n            const finished = json.data.length === 0;\n            this.setState((prev, props) => ({\n              chunks: {\n                title: 'Result for \"' + search_param + '\"',\n                data: prev.chunks.data.concat(json.data),\n              },\n              mode: finished ? 'search_finished' : 'search',\n              loading_status: 'done',\n            }));\n          })\n          .catch(failed);\n      } else if (mode === 'single') {\n        const pid = parseInt(this.state.search_param.substr(1), 10);\n        API.get_single(pid, this.props.token)\n          .then((json) => {\n            let x = json.data;\n            if (x.comments) {\n              let comment_json = {\n                code: 0,\n                attention: x.attention,\n                data: x.comments,\n              };\n              //console.log('My cache', comment_json, x.pid, x.reply)\n              cache().put(x.pid, parseInt(x.reply, 10), comment_json);\n            }\n\n            this.setState({\n              chunks: {\n                title: 'PID = ' + pid,\n                data: [json.data],\n              },\n              mode: 'single_finished',\n              loading_status: 'done',\n            });\n          })\n          .catch(failed);\n      } else if (mode === 'attention') {\n        let use_search = !!this.state.search_param;\n        let use_regex = use_search && !!this.state.search_param.match(/\\/.+\\//);\n        let regex_search = /.+/;\n        if (use_regex) {\n          try {\n            regex_search = new RegExp(this.state.search_param.slice(1, -1));\n          } catch (e) {\n            alert(`请检查正则表达式合法性！\\n${e}`);\n            regex_search = /.+/;\n          }\n        }\n        console.log(use_search, use_regex);\n\n        if (this.props.submode === 0) {\n          API.get_attention(this.props.token)\n            .then((json) => {\n              this.setState({\n                chunks: {\n                  title: `${\n                    use_search\n                      ? use_regex\n                        ? `Result for RegEx ${regex_search.toString()} in `\n                        : `Result for \"${this.state.search_param}\" in `\n                      : ''\n                  }Attention List`,\n                  data: !use_search\n                    ? json.data\n                    : !use_regex\n                    ? json.data.filter((post) => {\n                        return this.state.search_param\n                          .split(' ')\n                          .every((keyword) => post.text.includes(keyword));\n                      }) // Not using regex\n                    : json.data.filter(\n                        (post) => !!post.text.match(regex_search),\n                      ), // Using regex\n                },\n                mode: 'attention_finished',\n                loading_status: 'done',\n              });\n              if (!use_search) {\n                window.saved_attentions = Array.from(\n                  new Set([\n                    ...window.saved_attentions,\n                    ...json.data.map((post) => post.pid),\n                  ]),\n                ).sort((a, b) => b - a);\n                save_attentions();\n              }\n            })\n            .catch(failed);\n        } else if (this.props.submode === 1) {\n          const PERPAGE = 50;\n          let pids = window.saved_attentions\n            .sort((a, b) => b - a)\n            .slice((page - 1) * PERPAGE, page * PERPAGE);\n          if (pids.length) {\n            API.get_multi(pids, this.props.token)\n              .then((json) => {\n                json.data.forEach((x) => {\n                  if (x.comments) {\n                    let comment_json = {\n                      code: 0,\n                      attention: x.attention,\n                      data: x.comments,\n                    };\n                    //console.log('My cache', comment_json, x.pid, x.reply)\n                    cache().put(x.pid, parseInt(x.reply, 10), comment_json);\n                  }\n                });\n                this.setState((prev, props) => ({\n                  chunks: {\n                    title: 'Attention List: Local',\n                    data: prev.chunks.data.concat(json.data),\n                  },\n                  loading_status: 'done',\n                }));\n              })\n              .catch(failed);\n          } else {\n            console.log('local attention finished');\n            this.setState({\n              loading_status: 'done',\n              mode: 'attention_finished',\n            });\n            return;\n          }\n        }\n      } else {\n        console.log('nothing to load');\n        return;\n      }\n\n      this.setState((prev, props) => ({\n        loaded_pages: prev.loaded_pages + 1,\n        loading_status: 'loading',\n        error_msg: null,\n      }));\n    }\n  }\n\n  on_scroll(event) {\n    if (event.target === document) {\n      const avail =\n        document.body.scrollHeight - window.scrollY - window.innerHeight;\n      if (avail < window.innerHeight && this.state.loading_status === 'done')\n        this.load_page(this.state.loaded_pages + 1);\n    }\n  }\n\n  componentDidMount() {\n    this.load_page(1);\n    window.addEventListener('scroll', this.on_scroll_bound);\n    window.addEventListener('resize', this.on_scroll_bound);\n  }\n  componentWillUnmount() {\n    window.removeEventListener('scroll', this.on_scroll_bound);\n    window.removeEventListener('resize', this.on_scroll_bound);\n  }\n\n  trunc_string(s, max_len) {\n    return s.substr(0, max_len) + (s.length > max_len ? '...' : '');\n  }\n\n  gen_export() {\n    this.setState({\n      can_export: false,\n      local_attention_text: JSON.parse(localStorage['saved_attentions'] || '[]')\n        .map((pid) => `#${pid}`)\n        .join(' '),\n    });\n  }\n\n  render() {\n    const should_deletion_detect = localStorage['DELETION_DETECT'] === 'on';\n    const { mode, chunks, local_attention_text, search_param } = this.state;\n    return (\n      <div className=\"flow-container\">\n        {mode === 'attention' &&\n          this.props.submode === 1 &&\n          local_attention_text === null && (\n            <button\n              className=\"export-btn\"\n              type=\"button\"\n              onClick={this.gen_export.bind(this)}\n            >\n              导出/导入\n            </button>\n          )}\n\n        {local_attention_text && (\n          <LocalAttentionEditer init_text={local_attention_text} />\n        )}\n\n        <FlowChunk\n          title={chunks.title}\n          list={chunks.data}\n          mode={mode}\n          search_param={search_param || null}\n          show_sidebar={this.props.show_sidebar}\n          deletion_detect={should_deletion_detect}\n        />\n        {this.state.loading_status === 'failed' && (\n          <div className=\"aux-margin\">\n            <div className=\"box box-tip\">\n              <p>\n                <a\n                  onClick={() => {\n                    this.load_page(this.state.loaded_pages + 1);\n                  }}\n                >\n                  重新加载\n                </a>\n              </p>\n              <p>{this.state.error_msg}</p>\n            </div>\n          </div>\n        )}\n        <TitleLine\n          text={\n            this.state.loading_status === 'loading' ? (\n              <span>\n                <span className=\"icon icon-loading\" />\n                &nbsp;Loading...\n              </span>\n            ) : (\n              '🄯 2020 copyleft: hole_thu'\n            )\n          }\n        />\n      </div>\n    );\n  }\n}\n\nfunction LocalAttentionEditer(props) {\n  const [text, setText] = useState(props.init_text);\n  const PID_RE = /#(\\d+)/g;\n\n  const save = () => {\n    let pids = [...text.matchAll(PID_RE)]\n      .map((m) => parseInt(m[1]))\n      .sort((a, b) => b - a);\n    console.log(pids);\n    window.saved_attentions = pids;\n    save_attentions();\n    setText(pids.map((pid) => `#${pid}`).join(' '));\n  };\n\n  return (\n    <div className=\"box\">\n      <textarea\n        className=\"export-textarea\"\n        value={text}\n        onChange={(event) => setText(event.target.value)}\n      />\n      <button className=\"export-btn\" type=\"button\" onClick={save}>\n        保存\n      </button>\n    </div>\n  );\n}\n","import React, { PureComponent } from 'react';\n// import {AppSwitcher} from './infrastructure/widgets';\nimport { InfoSidebar, PostForm } from './UserAction';\nimport { TokenCtx } from './UserAction';\n\nimport './Title.css';\n\nconst flag_re = /^\\/\\/setflag ([a-zA-Z0-9_]+)=(.*)$/;\n\nclass ControlBar extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      search_text: '',\n    };\n    this.set_mode = props.set_mode;\n\n    this.on_change_bound = this.on_change.bind(this);\n    this.on_keypress_bound = this.on_keypress.bind(this);\n    this.do_refresh_bound = this.do_refresh.bind(this);\n    this.do_attention_bound = this.do_attention.bind(this);\n  }\n\n  componentDidMount() {\n    if (window.location.hash) {\n      let text = decodeURIComponent(window.location.hash).substr(1);\n      if (text.lastIndexOf('?') !== -1)\n        text = text.substr(0, text.lastIndexOf('?')); // fuck wechat '#param?nsukey=...'\n      this.setState(\n        {\n          search_text: text,\n        },\n        () => {\n          this.on_keypress({ key: 'Enter' });\n        },\n      );\n    }\n\n    window.addEventListener(\n      'hashchange',\n      () => {\n        let text = decodeURIComponent(window.location.hash).substr(1);\n        if (text && text[0] != '#') {\n          console.log('search', text);\n          this.setState(\n            {\n              search_text: text,\n            },\n            () => {\n              this.on_keypress({ key: 'Enter' });\n            },\n          );\n        }\n      },\n      false,\n    );\n  }\n\n  on_change(event) {\n    this.setState({\n      search_text: event.target.value,\n    });\n  }\n\n  on_keypress(event) {\n    if (event.key === 'Enter') {\n      let flag_res = flag_re.exec(this.state.search_text);\n      if (flag_res) {\n        if (flag_res[2]) {\n          localStorage[flag_res[1]] = flag_res[2];\n          alert(\n            'Set Flag ' +\n              flag_res[1] +\n              '=' +\n              flag_res[2] +\n              '\\nYou may need to refresh this webpage.',\n          );\n        } else {\n          delete localStorage[flag_res[1]];\n          alert(\n            'Clear Flag ' +\n              flag_res[1] +\n              '\\nYou may need to refresh this webpage.',\n          );\n        }\n        return;\n      }\n\n      const mode = this.state.search_text.startsWith('#')\n        ? 'single'\n        : this.props.mode !== 'attention'\n        ? 'search'\n        : 'attention';\n      this.set_mode(mode, this.state.search_text || '');\n    }\n  }\n\n  do_refresh() {\n    window.scrollTo(0, 0);\n    this.setState({\n      search_text: '',\n    });\n    this.set_mode('list', null);\n    window.location.hash = '';\n  }\n\n  do_attention() {\n    window.scrollTo(0, 0);\n    this.setState({\n      search_text: '',\n    });\n    this.set_mode('attention', null);\n  }\n\n  render() {\n    return (\n      <TokenCtx.Consumer>\n        {({ value: token }) => (\n          <div className=\"control-bar\">\n            <a\n              className=\"no-underline control-btn\"\n              onClick={this.do_refresh_bound}\n            >\n              <span className=\"icon icon-refresh\" />\n              <span className=\"control-btn-label\">刷新</span>\n            </a>\n            {!!token && (\n              <a\n                className=\"no-underline control-btn\"\n                onClick={this.do_attention_bound}\n              >\n                <span className=\"icon icon-attention\" />\n                <span className=\"control-btn-label\">关注</span>\n              </a>\n            )}\n            <input\n              className=\"control-search\"\n              value={this.state.search_text}\n              placeholder={\n                this.props.mode === 'attention'\n                  ? '在关注列表中搜索'\n                  : '关键词 / tag / #树洞号'\n              }\n              onChange={this.on_change_bound}\n              onKeyPress={this.on_keypress_bound}\n            />\n            <a\n              className=\"no-underline control-btn\"\n              onClick={() => {\n                this.props.show_sidebar(\n                  '新T树洞',\n                  <InfoSidebar show_sidebar={this.props.show_sidebar} />,\n                );\n              }}\n            >\n              <span className={'icon icon-' + (token ? 'about' : 'login')} />\n              <span className=\"control-btn-label\">\n                {token ? '账户' : '登录'}\n              </span>\n            </a>\n            {!!token && (\n              <a\n                className=\"no-underline control-btn\"\n                onClick={() => {\n                  this.props.show_sidebar(\n                    '发表树洞',\n                    <PostForm\n                      token={token}\n                      on_complete={() => {\n                        this.props.show_sidebar(null, null, 'clear');\n                        this.do_refresh();\n                      }}\n                    />,\n                  );\n                }}\n              >\n                <span className=\"icon icon-plus\" />\n                <span className=\"control-btn-label\">发表</span>\n              </a>\n            )}\n          </div>\n        )}\n      </TokenCtx.Consumer>\n    );\n  }\n}\n\nexport function Title(props) {\n  return (\n    <div className=\"title-bar\">\n      {/* <AppSwitcher appid=\"hole\" /> */}\n      <div className=\"aux-margin\">\n        <div className=\"title\">\n          <p className=\"centered-line\">\n            <span\n              onClick={() =>\n                props.show_sidebar(\n                  '新T树洞',\n                  <InfoSidebar show_sidebar={props.show_sidebar} />,\n                )\n              }\n            >\n              新T树洞\n            </span>\n          </p>\n        </div>\n        <ControlBar\n          show_sidebar={props.show_sidebar}\n          set_mode={props.set_mode}\n          mode={props.mode}\n        />\n      </div>\n    </div>\n  );\n}\n","import React, { PureComponent } from 'react';\nimport './Sidebar.css';\n\nexport class Sidebar extends PureComponent {\n  constructor(props) {\n    super(props);\n    // this.sidebar_ref = React.createRef();\n    this.do_close_bound = this.do_close.bind(this);\n    this.do_back_bound = this.do_back.bind(this);\n  }\n\n  do_close() {\n    this.props.show_sidebar(null, null, 'clear');\n  }\n  do_back() {\n    this.props.show_sidebar(null, null, 'pop');\n  }\n\n  render() {\n    // hide old contents to remember state\n    let contents = this.props.stack.map(\n      ({ 1: content }, i) =>\n        content && (\n          <div\n            key={i}\n            className={\n              'sidebar-content ' +\n              (i === this.props.stack.length - 1\n                ? 'sidebar-content-show'\n                : 'sidebar-content-hide')\n            }\n          >\n            {content}\n          </div>\n        ),\n    );\n    let cur_title = this.props.stack[this.props.stack.length - 1][0];\n    return (\n      <div\n        className={\n          'sidebar-container ' +\n          (cur_title !== null ? 'sidebar-on' : 'sidebar-off')\n        }\n      >\n        <div\n          className=\"sidebar-shadow\"\n          onClick={this.do_back_bound}\n          onTouchEnd={(e) => {\n            e.preventDefault();\n            e.target.click();\n          }}\n        />\n        <div className=\"sidebar\">{contents}</div>\n        <div className=\"sidebar-title\">\n          <a className=\"no-underline\" onClick={this.do_close_bound}>\n            &nbsp;\n            <span className=\"icon icon-close\" />\n            &nbsp;\n          </a>\n          {this.props.stack.length > 2 && (\n            <a className=\"no-underline\" onClick={this.do_back_bound}>\n              &nbsp;\n              <span className=\"icon icon-back\" />\n              &nbsp;\n            </a>\n          )}\n          {cur_title}\n        </div>\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport Pressure from 'pressure';\n\nimport './PressureHelper.css';\n\nconst THRESHOLD = 0.4;\nconst MULTIPLIER = 25;\nconst BORDER_WIDTH = 500; // also change css!\n\nexport class PressureHelper extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      level: 0,\n      fired: false,\n    };\n    this.callback = props.callback;\n    this.esc_interval = null;\n  }\n\n  do_fire() {\n    if (this.esc_interval) {\n      clearInterval(this.esc_interval);\n      this.esc_interval = null;\n    }\n    this.setState({\n      level: 1,\n      fired: true,\n    });\n    this.callback();\n    window.setTimeout(() => {\n      this.setState({\n        level: 0,\n        fired: false,\n      });\n    }, 300);\n  }\n\n  componentDidMount() {\n    if (window.config.pressure) {\n      Pressure.set(\n        document.body,\n        {\n          change: (force) => {\n            if (!this.state.fired) {\n              if (force >= 0.999) {\n                this.do_fire();\n              } else\n                this.setState({\n                  level: force,\n                });\n            }\n          },\n          end: () => {\n            this.setState({\n              level: 0,\n              fired: false,\n            });\n          },\n        },\n        {\n          polyfill: false,\n          only: 'touch',\n          preventSelect: false,\n        },\n      );\n\n      document.addEventListener('keydown', (e) => {\n        if (!e.repeat && e.key === 'Escape') {\n          if (this.esc_interval) clearInterval(this.esc_interval);\n          this.setState(\n            {\n              level: THRESHOLD / 2,\n            },\n            () => {\n              this.esc_interval = setInterval(() => {\n                let new_level = this.state.level + 0.1;\n                if (new_level >= 0.999) this.do_fire();\n                else\n                  this.setState({\n                    level: new_level,\n                  });\n              }, 30);\n            },\n          );\n        }\n      });\n      document.addEventListener('keyup', (e) => {\n        if (e.key === 'Escape') {\n          if (this.esc_interval) {\n            clearInterval(this.esc_interval);\n            this.esc_interval = null;\n          }\n          this.setState({\n            level: 0,\n          });\n        }\n      });\n    }\n  }\n\n  render() {\n    const pad = MULTIPLIER * (this.state.level - THRESHOLD) - BORDER_WIDTH;\n    return (\n      <div\n        className={\n          'pressure-box' +\n          (this.state.fired ? ' pressure-box-fired' : '') +\n          (this.state.level <= 0.0001 ? ' pressure-box-empty' : '')\n        }\n        style={{\n          left: pad,\n          right: pad,\n          top: pad,\n          bottom: pad,\n        }}\n      />\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport { Flow } from './Flows';\nimport { Title } from './Title';\nimport { Sidebar } from './Sidebar';\nimport { PressureHelper } from './PressureHelper';\nimport { TokenCtx } from './UserAction';\nimport { load_config, bgimg_style } from './Config';\nimport { load_attentions } from './Attention.js';\nimport { listen_darkmode } from './infrastructure/functions';\nimport { LoginPopup, TitleLine } from './infrastructure/widgets';\n\nconst MAX_SIDEBAR_STACK_SIZE = 10;\n\nfunction DeprecatedAlert(props) {\n  return <div id=\"global-hint-container\" style={{ display: 'none' }} />;\n}\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    load_config();\n    load_attentions();\n    window.AS_BACKUP = localStorage['DEFAULT_ALLOW_SEARCH'] ? true : false;\n    listen_darkmode(\n      { default: undefined, light: false, dark: true }[\n        window.config.color_scheme\n      ],\n    );\n    this.state = {\n      sidebar_stack: [[null, null]], // list of [status, content]\n      mode: 'list', // list, single, search, attention\n      search_text: null,\n      flow_render_key: +new Date(),\n      token: localStorage['TOKEN'] || null,\n    };\n    this.show_sidebar_bound = this.show_sidebar.bind(this);\n    this.set_mode_bound = this.set_mode.bind(this);\n    this.on_pressure_bound = this.on_pressure.bind(this);\n  }\n\n  static is_darkmode() {\n    if (window.config.color_scheme === 'dark') return true;\n    if (window.config.color_scheme === 'light') return false;\n    else {\n      // 'default'\n      return window.matchMedia('(prefers-color-scheme: dark)').matches;\n    }\n  }\n\n  on_pressure() {\n    if (this.state.sidebar_stack.length > 1)\n      this.show_sidebar(null, null, 'clear');\n    else this.set_mode('list', null);\n  }\n\n  show_sidebar(title, content, mode = 'push') {\n    this.setState((prevState) => {\n      let ns = prevState.sidebar_stack.slice();\n      if (mode === 'push') {\n        if (ns.length === 1) {\n          document.body.style.top = `-${window.scrollY}px`;\n          document.body.style.position = 'fixed';\n          document.body.style.width = '100vw'; // Be responsive with fixed position\n        }\n        if (ns.length > MAX_SIDEBAR_STACK_SIZE) ns.splice(1, 1);\n        ns = ns.concat([[title, content]]);\n      } else if (mode === 'pop') {\n        if (ns.length === 1) return;\n        if (ns.length === 2) {\n          const scrollY = document.body.style.top;\n          document.body.style.position = '';\n          document.body.style.top = '';\n          document.body.style.width = '';\n          window.scrollTo(0, parseInt(scrollY || '0') * -1);\n        }\n        ns.pop();\n      } else if (mode === 'replace') {\n        ns.pop();\n        ns = ns.concat([[title, content]]);\n      } else if (mode === 'clear') {\n        const scrollY = document.body.style.top;\n        document.body.style.position = '';\n        document.body.style.top = '';\n        document.body.style.width = '';\n        window.scrollTo(0, parseInt(scrollY || '0') * -1);\n        ns = [[null, null]];\n      } else throw new Error('bad show_sidebar mode');\n      return {\n        sidebar_stack: ns,\n      };\n    });\n  }\n\n  set_mode(mode, search_text) {\n    this.setState({\n      mode: mode,\n      search_text: search_text,\n      flow_render_key: +new Date(),\n    });\n  }\n\n  render() {\n    return (\n      <TokenCtx.Provider\n        value={{\n          value: this.state.token,\n          set_value: (x) => {\n            localStorage['TOKEN'] = x || '';\n            this.setState({\n              token: x,\n            });\n          },\n        }}\n      >\n        <PressureHelper callback={this.on_pressure_bound} />\n        <div className=\"bg-img\" style={bgimg_style()} />\n        <Title\n          show_sidebar={this.show_sidebar_bound}\n          set_mode={this.set_mode_bound}\n          mode={this.state.mode}\n        />\n        <TokenCtx.Consumer>\n          {(token) => (\n            <div className=\"left-container\">\n              <DeprecatedAlert token={token.value} />\n              {!token.value && (\n                <div className=\"flow-item-row aux-margin\">\n                  <div className=\"box box-tip\">\n                    <LoginPopup token_callback={token.set_value}>\n                      {(do_popup) => (\n                        <a onClick={do_popup}>\n                          <span className=\"icon icon-login\" />\n                          &nbsp;登录到 新T树洞\n                        </a>\n                      )}\n                    </LoginPopup>\n                  </div>\n                </div>\n              )}\n              {token.value ? (\n                <Flow\n                  key={this.state.flow_render_key}\n                  show_sidebar={this.show_sidebar_bound}\n                  mode={this.state.mode}\n                  search_text={this.state.search_text}\n                  token={token.value}\n                />\n              ) : (\n                <TitleLine text=\"请登录后查看内容\" />\n              )}\n              <br />\n            </div>\n          )}\n        </TokenCtx.Consumer>\n        <Sidebar\n          show_sidebar={this.show_sidebar_bound}\n          stack={this.state.sidebar_stack}\n        />\n      </TokenCtx.Provider>\n    );\n  }\n}\n\nexport default App;\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    // const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    // if (publicUrl.origin !== window.location.origin) {\n    // Our service worker won't work if PUBLIC_URL is on a different origin\n    // from what our page is served on. This might happen if a CDN is used to\n    // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n    // return;\n    // }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ',\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.',\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport './fonts_7/icomoon.css';\nimport App from './App';\n//import {elevate} from './infrastructure/elevator';\nimport registerServiceWorker from './registerServiceWorker';\n\n//elevate();\n\nReactDOM.render(<App />, document.getElementById('root'));\nregisterServiceWorker();\n"],"sourceRoot":""}